import{d as Z,e as O,P as oe,A as Q,w as ne,Q as ie,R as de,x as ue,b as me,a as ge,G as ce,S as pe,l as fe,m as ye,o as xe}from"./element-plus-T7eq0npu.js";import{aP as be,r as D,aX as ee,c as te,q as Y,x as w,y,z as e,R as d,u as i,L as A,J as c,O as f,P as $,aT as H,K as S,aq as P,C as M,o as K,I as F,Q as R,ac as W,Z as ve,aV as J,al as z,Y as q,a5 as ke,f as we}from"./vue-vendor-R8HMg95E.js";import{c as E,s as U,_ as he}from"./index-CYC8e9-T.js";import"./vendor-DTV-MYIR.js";const ae=be("settings",()=>{const p=D({siteName:"AI Relay Service",siteIcon:"",siteIconData:"",showAdminButton:!0,copyInfoTemplate:"",tutorialUrl:"",updatedAt:null}),m=D(!1),n=D(!1),h=D({plans:[],updatedAt:null}),a=async()=>{m.value=!0;try{const r=await E.get("/admin/oem-settings");return r&&r.success&&(p.value={...p.value,...r.data},_()),r}catch(r){throw console.error("Failed to load OEM settings:",r),r}finally{m.value=!1}},T=async r=>{n.value=!0;try{const l=await E.put("/admin/oem-settings",r);return l&&l.success&&(p.value={...p.value,...l.data},_()),l}catch(l){throw console.error("Failed to save OEM settings:",l),l}finally{n.value=!1}},C=async()=>{const r={siteName:"AI Relay Service",siteIcon:"",siteIconData:"",showAdminButton:!0,copyInfoTemplate:"",tutorialUrl:"",updatedAt:null};return p.value={...r},await T(r)},I=async()=>{var r,l;m.value=!0;try{const k=await E.get("/admin/product-settings");return k&&k.success&&(h.value={plans:Array.isArray((r=k.data)==null?void 0:r.plans)?k.data.plans:[],updatedAt:((l=k.data)==null?void 0:l.updatedAt)||null}),k}catch(k){throw console.error("Failed to load product settings:",k),k}finally{m.value=!1}},N=async r=>{var l,k;n.value=!0;try{const V={plans:Array.isArray(r==null?void 0:r.plans)?r.plans:h.value.plans},B=await E.put("/admin/product-settings",V);return B&&B.success&&(h.value={plans:((l=B.data)==null?void 0:l.plans)||[],updatedAt:((k=B.data)==null?void 0:k.updatedAt)||new Date().toISOString()}),B}catch(V){throw console.error("Failed to save product settings:",V),V}finally{n.value=!1}},_=()=>{if(p.value.siteName&&(document.title=`${p.value.siteName} - 管理后台`),p.value.siteIconData||p.value.siteIcon){const r=document.querySelector('link[rel="icon"]')||document.createElement("link");r.rel="icon",r.href=p.value.siteIconData||p.value.siteIcon,document.querySelector('link[rel="icon"]')||document.head.appendChild(r)}};return{oemSettings:p,loading:m,saving:n,productSettings:h,loadOemSettings:a,saveOemSettings:T,resetOemSettings:C,loadProductSettings:I,saveProductSettings:N,applyOemSettings:_,formatDateTime:r=>r?new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"",validateIconFile:r=>{const l=[];return r.size>350*1024&&l.push("图标文件大小不能超过 350KB"),["image/x-icon","image/png","image/jpeg","image/jpg","image/svg+xml"].includes(r.type)||l.push("不支持的文件类型，请选择 .ico, .png, .jpg 或 .svg 文件"),{isValid:l.length===0,errors:l}},fileToBase64:r=>new Promise((l,k)=>{const V=new FileReader;V.onload=B=>l(B.target.result),V.onerror=k,V.readAsDataURL(r)})}}),_e={class:"table-container hidden sm:block"},Ve={class:"min-w-full"},$e={class:"divide-y divide-gray-200/50 dark:divide-gray-600/50"},Ie={class:"table-row"},Se={class:"px-6 py-4"},Te={class:"table-row"},Ue={class:"px-6 py-4"},Ce={class:"space-y-3"},Pe={key:0,class:"inline-flex items-center gap-3 rounded-lg bg-gray-50 p-3 dark:bg-gray-700"},Ae=["src"],De={class:"table-row"},Ne={class:"px-6 py-4"},Be={class:"table-row"},Ee={class:"px-6 py-4"},je={class:"table-row"},Le={class:"px-6 py-4"},Fe={class:"flex items-center"},Me={class:"px-6 py-6",colspan:"2"},Ke={class:"flex items-center justify-between"},Re={class:"flex gap-3"},We={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},Oe={class:"space-y-4 sm:hidden"},ze={class:"glass-card p-4"},qe={class:"glass-card p-4"},Qe={class:"space-y-3"},Ye={key:0,class:"inline-flex items-center gap-3 rounded-lg bg-gray-50 p-3 dark:bg-gray-700"},Ge=["src"],He={class:"glass-card p-4"},Je={class:"flex flex-col gap-3"},Xe=["disabled"],Ze={key:0,class:"loading-spinner mr-2"},et={key:1,class:"fas fa-save mr-2"},tt=["disabled"],at={__name:"BrandingSection",setup(p){const m=ae(),{oemSettings:n,saving:h}=ee(m),a=D(),T=te({get(){return!n.value.showAdminButton},set(r){n.value.showAdminButton=!r}}),C=m.formatDateTime,I=async r=>{if(!r)return;const l=m.validateIconFile(r);if(!l.isValid){l.errors.forEach(k=>U(k,"error"));return}try{const k=await m.fileToBase64(r);n.value.siteIconData=k}catch{U("文件读取失败","error")}};function N(r){const l=(r==null?void 0:r.raw)||r;I(l)}const _=()=>{n.value.siteIcon="",n.value.siteIconData=""},t=()=>{},s=async()=>{try{const r={siteName:n.value.siteName,siteIcon:n.value.siteIcon,siteIconData:n.value.siteIconData,showAdminButton:n.value.showAdminButton,tutorialUrl:n.value.tutorialUrl,copyInfoTemplate:n.value.copyInfoTemplate},l=await m.saveOemSettings(r);l&&l.success&&U("OEM设置保存成功","success")}catch{U("保存OEM设置失败","error")}},v=async()=>{if(confirm(`确定要重置为默认设置吗？

这将清除所有自定义的网站名称和图标设置。`))try{const r=await m.resetOemSettings();r&&r.success&&U("已重置为默认设置","success")}catch{U("重置失败","error")}};return Y(()=>{n.value.siteName||m.loadOemSettings().catch(()=>{})}),(r,l)=>{const k=Z,V=O,B=oe,o=Q;return y(),w("div",null,[e("div",_e,[e("table",Ve,[e("tbody",$e,[e("tr",Ie,[l[7]||(l[7]=e("td",{class:"w-48 whitespace-nowrap px-6 py-4"},[e("div",{class:"flex items-center"},[e("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-font text-xs text-white"})]),e("div",null,[e("div",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},"网站名称"),e("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"品牌标识")])])],-1)),e("td",Se,[d(k,{modelValue:i(n).siteName,"onUpdate:modelValue":l[0]||(l[0]=u=>i(n).siteName=u),maxlength:"100","show-word-limit":"",placeholder:"AI Relay Service",clearable:"",class:"max-w-md"},null,8,["modelValue"]),l[6]||(l[6]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 将显示在浏览器标题和页面头部 ",-1))])]),e("tr",Te,[l[12]||(l[12]=e("td",{class:"w-48 whitespace-nowrap px-6 py-4"},[e("div",{class:"flex items-center"},[e("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-purple-500 to-purple-600"},[e("i",{class:"fas fa-image text-xs text-white"})]),e("div",null,[e("div",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},"网站图标"),e("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"Favicon")])])],-1)),e("td",Ue,[e("div",Ce,[i(n).siteIconData||i(n).siteIcon?(y(),w("div",Pe,[e("img",{alt:"图标预览",class:"h-8 w-8",src:i(n).siteIconData||i(n).siteIcon,onError:t},null,40,Ae),l[9]||(l[9]=e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"当前图标",-1)),d(V,{type:"danger",link:"",onClick:_},{default:c(()=>l[8]||(l[8]=[e("i",{class:"fas fa-trash mr-1"},null,-1),f("删除",-1)])),_:1,__:[8]})])):A("",!0),d(B,{"auto-upload":!1,"show-file-list":!1,accept:".ico,.png,.jpg,.jpeg,.svg","on-change":N},{tip:c(()=>l[11]||(l[11]=[e("div",{class:"ml-3 text-xs text-gray-500 dark:text-gray-400"}," 支持 .ico, .png, .jpg, .svg 格式，最大 350KB ",-1)])),default:c(()=>[d(V,{type:"success"},{default:c(()=>l[10]||(l[10]=[e("i",{class:"fas fa-upload mr-2"},null,-1),f(" 上传图标",-1)])),_:1,__:[10]})]),_:1})])])]),e("tr",De,[l[14]||(l[14]=e("td",{class:"w-48 whitespace-nowrap px-6 py-4"},[e("div",{class:"flex items-center"},[e("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-emerald-500 to-green-600"},[e("i",{class:"fas fa-book-open text-xs text-white"})]),e("div",null,[e("div",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},"教程链接"),e("div",{class:"text-xs text-gray-500 dark:text-gray-400"}," 用于引导用户查看使用教程 ")])])],-1)),e("td",Ne,[d(k,{modelValue:i(n).tutorialUrl,"onUpdate:modelValue":l[1]||(l[1]=u=>i(n).tutorialUrl=u),maxlength:"1000",placeholder:"例如：https://your-domain.com",clearable:"",class:"max-w-md"},null,8,["modelValue"]),l[13]||(l[13]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 留空则默认使用当前站点地址 ",-1))])]),e("tr",Be,[l[16]||(l[16]=e("td",{class:"w-48 whitespace-nowrap px-6 py-4 align-top"},[e("div",{class:"flex items-start"},[e("div",{class:"mr-3 mt-0.5 flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-cyan-500 to-blue-600"},[e("i",{class:"fas fa-copy text-xs text-white"})]),e("div",null,[e("div",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"}," 复制内容模板 "),e("div",{class:"text-xs text-gray-500 dark:text-gray-400"}," 支持占位符 {siteUrl}、{apiKey} ")])])],-1)),e("td",Ee,[d(k,{modelValue:i(n).copyInfoTemplate,"onUpdate:modelValue":l[2]||(l[2]=u=>i(n).copyInfoTemplate=u),type:"textarea",rows:5,maxlength:"2000","show-word-limit":"",placeholder:"例如：您可以通过访问 {siteUrl} 查看使用教程和查看您的使用情况。\\n您的API Key是：{apiKey}",class:"max-w-2xl"},null,8,["modelValue"]),l[15]||(l[15]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 留空将使用默认文案；将 {siteUrl} 替换为教程链接（或当前站点地址），{apiKey} 替换为用户的 API Key ",-1))])]),e("tr",je,[l[18]||(l[18]=e("td",{class:"w-48 whitespace-nowrap px-6 py-4"},[e("div",{class:"flex items-center"},[e("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600"},[e("i",{class:"fas fa-eye-slash text-xs text-white"})]),e("div",null,[e("div",{class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},"管理入口"),e("div",{class:"text-xs text-gray-500 dark:text-gray-400"},"登录按钮显示")])])],-1)),e("td",Le,[e("div",Fe,[d(o,{modelValue:T.value,"onUpdate:modelValue":l[3]||(l[3]=u=>T.value=u),"active-text":"隐藏登录按钮","inactive-text":"显示登录按钮"},null,8,["modelValue"])]),l[17]||(l[17]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 隐藏后，用户需要直接访问 /admin/login 页面登录 ",-1))])]),e("tr",null,[e("td",Me,[e("div",Ke,[e("div",Re,[d(V,{type:"primary",loading:i(h),onClick:s},{default:c(()=>[l[19]||(l[19]=e("i",{class:"fas fa-save mr-2"},null,-1)),f(" "+$(i(h)?"保存中...":"保存设置"),1)]),_:1,__:[19]},8,["loading"]),d(V,{disabled:i(h),onClick:v},{default:c(()=>l[20]||(l[20]=[e("i",{class:"fas fa-undo mr-2"},null,-1),f(" 重置为默认 ",-1)])),_:1,__:[20]},8,["disabled"])]),i(n).updatedAt?(y(),w("div",We,[l[21]||(l[21]=e("i",{class:"fas fa-clock mr-1"},null,-1)),f(" 最后更新："+$(i(C)(i(n).updatedAt)),1)])):A("",!0)])])])])])]),e("div",Oe,[e("div",ze,[l[22]||(l[22]=H('<div class="mb-3 flex items-center gap-3"><div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl bg-gradient-to-br from-blue-500 to-cyan-600 text-white shadow-md"><i class="fas fa-tag"></i></div><div><h3 class="text-base font-semibold text-gray-900 dark:text-gray-100">站点名称</h3><p class="text-sm text-gray-500 dark:text-gray-400">自定义您的站点品牌名称</p></div></div>',1)),S(e("input",{"onUpdate:modelValue":l[4]||(l[4]=u=>i(n).siteName=u),class:"form-input w-full dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",maxlength:"100",placeholder:"AI Relay Service",type:"text"},null,512),[[P,i(n).siteName]])]),e("div",qe,[l[25]||(l[25]=H('<div class="mb-3 flex items-center gap-3"><div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl bg-gradient-to-br from-purple-500 to-pink-600 text-white shadow-md"><i class="fas fa-image"></i></div><div><h3 class="text-base font-semibold text-gray-900 dark:text-gray-100">站点图标</h3><p class="text-sm text-gray-500 dark:text-gray-400">Favicon</p></div></div>',1)),e("div",Qe,[i(n).siteIconData||i(n).siteIcon?(y(),w("div",Ye,[e("img",{alt:"图标预览",class:"h-8 w-8",src:i(n).siteIconData||i(n).siteIcon,onError:t},null,40,Ge),e("button",{class:"rounded-lg px-3 py-1 font-medium text-red-600 transition-colors hover:bg-red-50 hover:text-red-900",onClick:_},l[23]||(l[23]=[e("i",{class:"fas fa-trash mr-1"},null,-1),f("删除 ",-1)]))])):A("",!0),e("div",null,[e("input",{ref_key:"iconFileInput",ref:a,accept:".ico,.png,.jpg,.jpeg,.svg",class:"hidden",type:"file",onChange:I},null,544),e("button",{class:"btn btn-success px-4 py-2",onClick:l[5]||(l[5]=u=>{var g;return(g=a.value)==null?void 0:g.click()})},l[24]||(l[24]=[e("i",{class:"fas fa-upload mr-2"},null,-1),f(" 上传图标 ",-1)]))])])]),e("div",He,[e("div",Je,[e("button",{class:M(["btn btn-primary w-full px-6 py-3",{"cursor-not-allowed opacity-50":i(h)}]),disabled:i(h),onClick:s},[i(h)?(y(),w("div",Ze)):(y(),w("i",et)),f(" "+$(i(h)?"保存中...":"保存设置"),1)],10,Xe),e("button",{class:"btn w-full bg-gray-100 px-6 py-3 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",disabled:i(h),onClick:v},l[26]||(l[26]=[e("i",{class:"fas fa-undo mr-2"},null,-1),f(" 重置为默认 ",-1)]),8,tt)])])])])}}},lt={__name:"ProductPlanModal",props:{modelValue:{type:Boolean,default:!1},plan:{type:Object,default:()=>({})},editing:{type:Boolean,default:!1}},emits:["update:modelValue","save"],setup(p,{emit:m}){const n=p,h=m,a=D({id:"",name:"",description:"",price:"",priceNote:"",durationDesc:"",dailyLimit:0,tag:"",apiKeyTemplateId:"",active:!0,order:1}),T=(t={})=>{a.value={id:t.id||"",name:t.name||"",description:t.description||"",price:t.price||"",priceNote:t.priceNote||"",durationDesc:t.durationDesc||"",dailyLimit:Number.isFinite(t.dailyLimit)?t.dailyLimit:0,tag:t.tag||"",apiKeyTemplateId:t.apiKeyTemplateId||"",active:t.active!==!1,order:Number.isFinite(t.order)?t.order:1}};K(()=>n.plan,t=>T(t),{immediate:!0});const C=()=>h("update:modelValue",!1),I=()=>{const t={id:(a.value.id||"").trim().slice(0,64),name:(a.value.name||"").trim().slice(0,64),description:(a.value.description||"").trim().slice(0,200),price:(a.value.price||"").trim().slice(0,32),priceNote:(a.value.priceNote||"").trim().slice(0,64),durationDesc:(a.value.durationDesc||"").trim().slice(0,64),dailyLimit:Math.max(0,parseInt(a.value.dailyLimit,10)||0),tag:(a.value.tag||"").trim().slice(0,32),apiKeyTemplateId:(a.value.apiKeyTemplateId||"").trim().slice(0,64),active:a.value.active!==!1,order:Number.isFinite(a.value.order)?a.value.order:1};h("save",t),C()},N=D([]),_=D(!1);return K(()=>n.modelValue,async t=>{if(t)try{_.value=!0;const s=await E.get("/admin/api-key-templates");s!=null&&s.success?N.value=Array.isArray(s.data)?s.data:[]:N.value=[]}catch{N.value=[],U("加载模版失败","error")}finally{_.value=!1}},{immediate:!1}),(t,s)=>{const v=Z,r=ue,l=de,k=ge,V=me,B=ie,o=Q,u=ne,g=O,j=ce;return y(),F(j,{"model-value":p.modelValue,title:p.editing?"编辑套餐":"添加套餐",width:"560px",onClose:C},{footer:c(()=>[d(g,{onClick:C},{default:c(()=>s[11]||(s[11]=[f("取消",-1)])),_:1,__:[11]}),d(g,{type:"primary",onClick:I},{default:c(()=>s[12]||(s[12]=[f("保存",-1)])),_:1,__:[12]})]),default:c(()=>[d(u,{"label-width":"100px","label-position":"left"},{default:c(()=>[d(B,{gutter:12},{default:c(()=>[d(l,{span:12},{default:c(()=>[d(r,{label:"排序"},{default:c(()=>[d(v,{modelValue:a.value.order,"onUpdate:modelValue":s[0]||(s[0]=x=>a.value.order=x),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"])]),_:1})]),_:1}),d(l,{span:12},{default:c(()=>[d(r,{label:"ID"},{default:c(()=>[d(v,{modelValue:a.value.id,"onUpdate:modelValue":s[1]||(s[1]=x=>a.value.id=x),"show-word-limit":"",maxlength:"64"},null,8,["modelValue"])]),_:1})]),_:1}),d(l,{span:12},{default:c(()=>[d(r,{label:"名称"},{default:c(()=>[d(v,{modelValue:a.value.name,"onUpdate:modelValue":s[2]||(s[2]=x=>a.value.name=x),"show-word-limit":"",maxlength:"64"},null,8,["modelValue"])]),_:1})]),_:1}),d(l,{span:12},{default:c(()=>[d(r,{label:"标签"},{default:c(()=>[d(v,{modelValue:a.value.tag,"onUpdate:modelValue":s[3]||(s[3]=x=>a.value.tag=x),"show-word-limit":"",maxlength:"32"},null,8,["modelValue"])]),_:1})]),_:1}),d(l,{span:12},{default:c(()=>[d(r,{label:"价格"},{default:c(()=>[d(v,{modelValue:a.value.price,"onUpdate:modelValue":s[4]||(s[4]=x=>a.value.price=x),maxlength:"32"},null,8,["modelValue"])]),_:1})]),_:1}),d(l,{span:12},{default:c(()=>[d(r,{label:"价格说明"},{default:c(()=>[d(v,{modelValue:a.value.priceNote,"onUpdate:modelValue":s[5]||(s[5]=x=>a.value.priceNote=x),maxlength:"64"},null,8,["modelValue"])]),_:1})]),_:1}),d(l,{span:12},{default:c(()=>[d(r,{label:"时长"},{default:c(()=>[d(v,{modelValue:a.value.durationDesc,"onUpdate:modelValue":s[6]||(s[6]=x=>a.value.durationDesc=x),maxlength:"64"},null,8,["modelValue"])]),_:1})]),_:1}),d(l,{span:12},{default:c(()=>[d(r,{label:"日配额"},{default:c(()=>[d(v,{modelValue:a.value.dailyLimit,"onUpdate:modelValue":s[7]||(s[7]=x=>a.value.dailyLimit=x),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"])]),_:1})]),_:1}),d(l,{span:24},{default:c(()=>[d(r,{label:"API Key 模版"},{default:c(()=>[d(V,{modelValue:a.value.apiKeyTemplateId,"onUpdate:modelValue":s[8]||(s[8]=x=>a.value.apiKeyTemplateId=x),clearable:"",filterable:"",placeholder:"选择用于开通的模版（可选）",loading:_.value,style:{width:"100%"}},{default:c(()=>[(y(!0),w(R,null,W(N.value,x=>(y(),F(k,{key:x.id,label:x.name,value:x.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1}),d(r,{label:"描述"},{default:c(()=>[d(v,{modelValue:a.value.description,"onUpdate:modelValue":s[9]||(s[9]=x=>a.value.description=x),type:"textarea",rows:4,maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),d(r,{label:"启用"},{default:c(()=>[d(o,{modelValue:a.value.active,"onUpdate:modelValue":s[10]||(s[10]=x=>a.value.active=x)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["model-value","title"])}}},st={class:"mb-4 flex items-center justify-between px-6"},rt={class:"space-y-4 sm:hidden"},ot={class:"mb-3 flex items-center justify-between"},nt={class:"text-base font-semibold text-gray-900 dark:text-gray-100"},it={class:"flex items-center gap-2"},dt=["onClick"],ut=["onClick"],mt={class:"grid grid-cols-2 gap-3 text-sm text-gray-700 dark:text-gray-300"},gt={class:"ml-1 text-xs text-gray-500"},ct={key:0},pt={key:0,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},ft={__name:"ProductsSection",setup(p){const m=ae(),{productSettings:n}=ee(m),h=m.formatDateTime,a=D(!1),T=D(!1),C=D(-1),I=D({}),N=v=>{typeof v=="number"&&v>=0?(T.value=!0,C.value=v,I.value={...n.value.plans[v]}):(T.value=!1,C.value=-1,I.value={id:`plan_${n.value.plans.length+1}`,name:"新套餐",description:"",price:"",priceNote:"",durationDesc:"",dailyLimit:0,tag:"",apiKeyTemplateId:"",active:!0,order:n.value.plans.length+1}),a.value=!0},_=async v=>{T.value&&C.value>=0?n.value.plans.splice(C.value,1,v):n.value.plans.push(v),await s()},t=async v=>{n.value.plans.splice(v,1),await s()},s=async()=>{try{const v=await m.saveProductSettings({plans:n.value.plans});v&&v.success?U("产品配置保存成功","success"):U((v==null?void 0:v.message)||"保存失败","error")}catch{U("保存失败","error")}};return Y(()=>{(!n.value.plans||n.value.plans.length===0)&&m.loadProductSettings().catch(()=>{})}),(v,r)=>{const l=pe,k=O,V=fe,B=ye,o=xe;return y(),w("div",null,[e("div",st,[i(n).updatedAt?(y(),F(l,{key:0,type:"info"},{default:c(()=>[r[2]||(r[2]=e("i",{class:"fas fa-clock mr-1"},null,-1)),f(" 最后更新："+$(i(h)(i(n).updatedAt)),1)]),_:1,__:[2]})):A("",!0),d(k,{type:"success",onClick:r[0]||(r[0]=u=>N(-1))},{default:c(()=>r[3]||(r[3]=[e("i",{class:"fas fa-plus mr-2"},null,-1),f(" 添加套餐 ",-1)])),_:1,__:[3]})]),d(o,{data:i(n).plans,class:"hidden sm:block",stripe:""},{default:c(()=>[d(V,{label:"排序",prop:"order",width:"80",fixed:"left"}),d(V,{label:"ID",prop:"id",width:"200"},{default:c(({row:u})=>[d(l,{type:"info"},{default:c(()=>[f($(u.id),1)]),_:2},1024)]),_:1}),d(V,{label:"名称",prop:"name",width:"160"}),d(V,{label:"描述",prop:"description",width:"160","show-overflow-tooltip":""}),d(V,{label:"价格",width:"120"},{default:c(({row:u})=>[f("¥"+$(u.price),1)]),_:1}),d(V,{label:"价格说明",prop:"priceNote",width:"120"}),d(V,{label:"时长",prop:"durationDesc",width:"120"}),d(V,{label:"日配额",prop:"dailyLimit",width:"100"}),d(V,{label:"标签",width:"120"},{default:c(({row:u})=>[u.tag?(y(),F(B,{key:0,type:"primary",effect:"light"},{default:c(()=>[f($(u.tag),1)]),_:2},1024)):A("",!0)]),_:1}),d(V,{label:"操作",width:"180",fixed:"right"},{default:c(({$index:u})=>[d(k,{size:"small",type:"primary",onClick:g=>N(u)},{default:c(()=>r[4]||(r[4]=[f("详情",-1)])),_:2,__:[4]},1032,["onClick"]),d(k,{size:"small",type:"danger",onClick:g=>t(u)},{default:c(()=>r[5]||(r[5]=[f("删除",-1)])),_:2,__:[5]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e("div",rt,[(y(!0),w(R,null,W(i(n).plans,(u,g)=>(y(),w("div",{key:u.id||g,class:"glass-card p-4"},[e("div",ot,[e("h3",nt,$(u.name||"套餐 "+(g+1)),1),e("div",it,[e("button",{class:"btn btn-primary px-3 py-1",onClick:j=>N(g)},r[6]||(r[6]=[e("i",{class:"fas fa-edit mr-1"},null,-1),f(" 编辑 ",-1)]),8,dt),e("button",{class:"btn bg-red-50 px-3 py-1 text-red-600 hover:bg-red-100",onClick:j=>t(g)},r[7]||(r[7]=[e("i",{class:"fas fa-trash mr-1"},null,-1),f(" 删除 ",-1)]),8,ut)])]),e("div",mt,[e("div",null,"ID："+$(u.id),1),e("div",null,[f(" 价格：¥"+$(u.price)+" ",1),e("span",gt,$(u.priceNote),1)]),e("div",null,"时长："+$(u.durationDesc),1),e("div",null,"日配额："+$(u.dailyLimit),1),u.tag?(y(),w("div",ct,"标签："+$(u.tag),1)):A("",!0),e("div",null,"排序："+$(u.order),1)]),u.description?(y(),w("p",pt,$(u.description),1)):A("",!0)]))),128))]),d(lt,{modelValue:a.value,"onUpdate:modelValue":r[1]||(r[1]=u=>a.value=u),editing:T.value,plan:I.value,onSave:_},null,8,["modelValue","editing","plan"])])}}},le={accountAnomaly:{name:"账号异常",desc:"账号状态异常、认证失败等"},quotaWarning:{name:"配额警告",desc:"API调用配额不足警告"},systemError:{name:"系统错误",desc:"系统运行错误和故障"},securityAlert:{name:"安全警报",desc:"安全相关的警报通知"},rateLimitRecovery:{name:"限流恢复",desc:"限流状态恢复时发送提醒"},test:{name:"测试通知",desc:"用于测试Webhook连接是否正常"}},X={accountAnomaly:!0,quotaWarning:!0,systemError:!0,securityAlert:!0,rateLimitRecovery:!0},G={wechat_work:{name:"企业微信",icon:"fab fa-weixin text-green-600",hint:"请在企业微信群机器人设置中获取Webhook地址"},dingtalk:{name:"钉钉",icon:"fas fa-bell text-blue-600",hint:"请在钉钉群机器人设置中获取Webhook地址"},feishu:{name:"飞书",icon:"fas fa-paper-plane text-indigo-600",hint:"请在飞书群机器人设置中获取Webhook地址"},slack:{name:"Slack",icon:"fab fa-slack text-purple-600",hint:"请在 Slack App 的 Incoming Webhook 中获取 URL"},discord:{name:"Discord",icon:"fab fa-discord text-indigo-500",hint:"请在 Discord 频道的 Integrations -> Webhooks 中获取 URL"},telegram:{name:"Telegram",icon:"fab fa-telegram text-sky-500",hint:"需要 Bot Token 与 Chat ID，可选 API 基础地址与代理"},bark:{name:"Bark",icon:"fas fa-bell text-emerald-600",hint:"在 Bark App 中查看您的设备密钥，可选服务器地址"},smtp:{name:"邮件通知",icon:"fas fa-envelope text-orange-600",hint:"请配置 SMTP 服务器信息，支持Gmail、QQ邮箱等"},custom:{name:"自定义",icon:"fas fa-cog text-gray-600",hint:"请输入完整的Webhook接收地址"}};function yt(p){var m;return((m=le[p])==null?void 0:m.name)||p}function xt(p){var m;return((m=le[p])==null?void 0:m.desc)||""}function bt(p){var m;return((m=G[p])==null?void 0:m.name)||p}function vt(p){var m;return((m=G[p])==null?void 0:m.icon)||"fas fa-bell"}function se(p){var m;return((m=G[p])==null?void 0:m.hint)||""}function kt(){const p=D({enabled:!1,platforms:[],notificationTypes:{...X},retrySettings:{maxRetries:3,retryDelay:1e3,timeout:1e4}}),m=D(!1),n=D(null),h=D(C()),a=D(!1),T=D(!1);function C(){return{type:"wechat_work",name:"",url:"",enableSign:!1,secret:"",botToken:"",chatId:"",apiBaseUrl:"",proxyUrl:"",deviceKey:"",serverUrl:"",level:"",sound:"",group:"",host:"",port:null,secure:!1,user:"",pass:"",from:"",to:"",timeout:null,ignoreTLS:!1}}async function I(){var u,g,j;const o=await E.get("/admin/webhook/config");if(o&&o.success){const x=o.data||{};p.value={enabled:!!x.enabled,platforms:Array.isArray(x.platforms)?x.platforms:[],notificationTypes:{...X,...x.notificationTypes||{}},retrySettings:{maxRetries:((u=x.retrySettings)==null?void 0:u.maxRetries)??3,retryDelay:((g=x.retrySettings)==null?void 0:g.retryDelay)??1e3,timeout:((j=x.retrySettings)==null?void 0:j.timeout)??1e4}}}return o}async function N(){const o={...p.value},u=await E.post("/admin/webhook/config",o);return u&&u.success&&U("通知设置已保存","success"),u}function _(){n.value=null,h.value=C(),m.value=!0}function t(o){n.value=o,h.value={type:o.type,name:o.name||"",url:o.url||"",enableSign:o.enableSign||!1,secret:o.secret||"",botToken:o.botToken||"",chatId:o.chatId||"",apiBaseUrl:o.apiBaseUrl||"",proxyUrl:o.proxyUrl||"",deviceKey:o.deviceKey||"",serverUrl:o.serverUrl||"",level:o.level||"",sound:o.sound||"",group:o.group||"",host:o.host||"",port:o.port??null,secure:o.secure||!1,user:o.user||"",pass:o.pass||"",from:o.from||"",to:Array.isArray(o.to)?o.to.join(", "):o.to||"",timeout:o.timeout??null,ignoreTLS:o.ignoreTLS||!1},m.value=!0}async function s(o){if(!confirm("确定要删除这个平台吗？"))return;const u=await E.delete(`/admin/webhook/platforms/${o}`);u&&u.success&&(U("平台已删除","success"),await I())}async function v(o){const u=await E.post(`/admin/webhook/platforms/${o}/toggle`);u&&u.success&&(U(u.message||"已切换平台状态","success"),await I())}function r(){const o=h.value;if(o.type==="custom"||o.type==="wechat_work"||o.type==="dingtalk"||o.type==="feishu"||o.type==="slack"||o.type==="discord"){if(!o.url||o.url.length<5)return U("请填写有效的 Webhook URL","error"),!1}else if(o.type==="telegram"){if(!o.botToken||!o.chatId)return U("请填写 Telegram BotToken 与 Chat ID","error"),!1}else if(o.type==="bark"){if(!o.deviceKey)return U("请填写 Bark 设备密钥","error"),!1}else if(o.type==="smtp"&&(!o.host||!o.user||!o.pass||!o.to))return U("请完善 SMTP 主机/账号/密码/收件人","error"),!1;return!0}async function l(){if(r())try{a.value=!0;const o=B(h.value),u=await E.post("/admin/webhook/test",o);u&&u.success&&U("测试成功","success")}catch{U("测试失败","error")}finally{a.value=!1}}async function k(){if(r())try{T.value=!0;const o=B(h.value);let u;n.value&&n.value.id?u=await E.put(`/admin/webhook/platforms/${n.value.id}`,o):u=await E.post("/admin/webhook/platforms",o),u&&u.success&&(U("平台已保存","success"),m.value=!1,await I())}catch{U("保存失败","error")}finally{T.value=!1}}async function V(){try{const o=await E.post("/admin/webhook/test-notification");o&&o.success&&U("测试通知已发送","success")}catch{U("发送失败","error")}}function B(o){const u={...o};return u.type==="smtp"&&typeof u.to=="string"&&(u.to=u.to.split(",").map(g=>g.trim()).filter(Boolean)),u}return{webhookConfig:p,showPlatformModal:m,editingPlatform:n,platformForm:h,testingConnection:a,savingPlatform:T,loadWebhookConfig:I,saveWebhookConfig:N,openAddPlatform:_,editPlatform:t,deletePlatform:s,togglePlatform:v,testPlatformForm:l,savePlatform:k,sendTestNotification:V,getNotificationTypeName:yt,getNotificationTypeDescription:xt,getPlatformIcon:vt,getPlatformName:bt,getWebhookHint:se}}const wt={class:"relative border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-5 dark:border-gray-700 dark:from-gray-800"},ht={class:"flex items-center justify-between"},_t={class:"flex items-center space-x-3"},Vt={class:"text-xl font-semibold text-gray-900 dark:text-white"},$t={class:"mt-0.5 text-sm text-gray-600 dark:text-gray-400"},It={class:"p-6"},St={class:"space-y-5"},Tt={class:"relative"},Ut=["disabled"],Ct={key:0,class:"mt-1 text-xs text-amber-600 dark:text-amber-400"},Pt={key:0},At={class:"relative"},Dt={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Nt={key:1,class:"space-y-5"},Bt={key:2,class:"space-y-5"},Et={key:3,class:"space-y-5"},jt={class:"flex items-center justify-between"},Lt={class:"flex cursor-pointer items-center"},Ft={class:"flex items-center justify-between"},Mt={class:"flex cursor-pointer items-center"},Kt={key:4,class:"rounded-xl border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-900/50"},Rt={class:"space-y-4"},Wt={class:"flex items-center justify-between"},Ot={class:"flex cursor-pointer items-center"},zt={key:0,class:"rounded-full bg-green-100 px-2 py-1 text-xs font-medium text-green-700 dark:bg-green-900/50 dark:text-green-400"},qt={key:0},Qt={class:"border-t border-gray-200 bg-gray-50 px-6 py-4 dark:border-gray-700 dark:bg-gray-900/50"},Yt={class:"flex items-center justify-between"},Gt={class:"space-x-3"},Ht=["disabled"],Jt={__name:"WebhookPlatformModal",props:{modelValue:{type:Boolean,default:!1},platform:{type:Object,default:()=>({})},editing:{type:Boolean,default:!1},testing:{type:Boolean,default:!1}},emits:["update:modelValue","save","test"],setup(p,{emit:m}){const n=p,h=m,a=D({});K(()=>n.platform,_=>{a.value={..._||{}}},{immediate:!0});const T=te(()=>se(a.value.type));function C(){h("update:modelValue",!1)}function I(){const _={...a.value||{}};return _.type==="smtp"&&typeof _.to=="string"&&(_.to=_.to.split(",").map(t=>t.trim()).filter(Boolean)),_}const N=_=>{try{document.documentElement.style.overflow=_?"hidden":"",document.body.style.overflow=_?"hidden":""}catch{}};return K(()=>n.modelValue,_=>N(_),{immediate:!0}),ve(()=>N(!1)),(_,t)=>(y(),F(ke,{to:"body"},[p.modelValue?(y(),w("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm transition-all duration-300 ease-out",onClick:C,onTouchmove:t[25]||(t[25]=q(()=>{},["prevent"])),onWheel:t[26]||(t[26]=q(()=>{},["prevent"]))},[e("div",{class:"relative mx-4 w-full max-w-2xl overflow-hidden rounded-2xl bg-white shadow-2xl transition-all duration-300 ease-out dark:bg-gray-800",onClick:t[24]||(t[24]=q(()=>{},["stop"]))},[e("div",wt,[e("div",ht,[e("div",_t,[t[27]||(t[27]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 text-white shadow-lg"},[e("i",{class:"fas fa-bell"})],-1)),e("div",null,[e("h3",Vt,$(p.editing?"编辑":"添加")+"通知平台 ",1),e("p",$t," 配置"+$(p.editing?"并更新":"新的")+"Webhook通知渠道 ",1)])]),e("button",{class:"rounded-lg p-2 text-gray-400 transition-colors hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-700 dark:hover:text-gray-300",onClick:C},t[28]||(t[28]=[e("i",{class:"fas fa-times text-lg"},null,-1)]))])]),e("div",It,[e("div",St,[e("div",null,[t[32]||(t[32]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-layer-group mr-2 text-gray-400"}),f(" 平台类型 ")],-1)),e("div",Tt,[S(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>a.value.type=s),class:"w-full appearance-none rounded-xl border border-gray-300 bg-white px-4 py-3 pr-10 text-gray-900 shadow-sm transition-all focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white",disabled:p.editing},t[29]||(t[29]=[e("option",{value:"wechat_work"},"🟢 企业微信",-1),e("option",{value:"dingtalk"},"🔵 钉钉",-1),e("option",{value:"feishu"},"🟦 飞书",-1),e("option",{value:"slack"},"🟣 Slack",-1),e("option",{value:"discord"},"🟪 Discord",-1),e("option",{value:"telegram"},"✈️ Telegram",-1),e("option",{value:"bark"},"🔔 Bark",-1),e("option",{value:"smtp"},"📧 邮件通知",-1),e("option",{value:"custom"},"⚙️ 自定义",-1)]),8,Ut),[[J,a.value.type]]),t[30]||(t[30]=e("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3"},[e("i",{class:"fas fa-chevron-down text-gray-400"})],-1))]),p.editing?(y(),w("p",Ct,t[31]||(t[31]=[e("i",{class:"fas fa-info-circle mr-1"},null,-1),f(" 编辑模式下不能更改平台类型 ",-1)]))):A("",!0)]),e("div",null,[t[33]||(t[33]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-tag mr-2 text-gray-400"}),f(" 名称 "),e("span",{class:"ml-2 text-xs text-gray-500"},"(可选)")],-1)),S(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.name=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"例如：运维群通知、开发测试群",type:"text"},null,512),[[P,a.value.name]])]),a.value.type!=="bark"&&a.value.type!=="smtp"&&a.value.type!=="telegram"?(y(),w("div",Pt,[t[35]||(t[35]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-link mr-2 text-gray-400"}),f(" Webhook URL "),e("span",{class:"ml-1 text-xs text-red-500"},"*")],-1)),e("div",At,[S(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.url=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 pr-10 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"https://...",type:"url"},null,512),[[P,a.value.url]]),t[34]||(t[34]=e("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3"},[e("i",{class:"fas fa-info-circle text-gray-300"})],-1))]),T.value?(y(),w("p",Dt,$(T.value),1)):A("",!0)])):A("",!0),a.value.type==="telegram"?(y(),w("div",Nt,[e("div",null,[t[36]||(t[36]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-robot mr-2 text-gray-400"}),f(" Bot Token "),e("span",{class:"ml-1 text-xs text-red-500"},"*")],-1)),S(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.botToken=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11",type:"text"},null,512),[[P,a.value.botToken]])]),e("div",null,[t[37]||(t[37]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-hashtag mr-2 text-gray-400"}),f(" Chat ID "),e("span",{class:"ml-1 text-xs text-red-500"},"*")],-1)),S(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.chatId=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"例如：-1001234567890",type:"text"},null,512),[[P,a.value.chatId]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-globe mr-2 text-gray-400"}),f(" API 基础地址 "),e("span",{class:"ml-2 text-xs text-gray-500"},"(可选)")],-1)),S(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>a.value.apiBaseUrl=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"默认: https://api.telegram.org",type:"url"},null,512),[[P,a.value.apiBaseUrl]])]),e("div",null,[t[39]||(t[39]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-route mr-2 text-gray-400"}),f(" 代理地址 "),e("span",{class:"ml-2 text-xs text-gray-500"},"(可选)")],-1)),S(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>a.value.proxyUrl=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"例如：socks5://user:pass@127.0.0.1:1080",type:"text"},null,512),[[P,a.value.proxyUrl]])])])):A("",!0),a.value.type==="bark"?(y(),w("div",Bt,[e("div",null,[t[40]||(t[40]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-key mr-2 text-gray-400"}),f(" 设备密钥 (Device Key) "),e("span",{class:"ml-1 text-xs text-red-500"},"*")],-1)),S(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>a.value.deviceKey=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"aBcDeFgHiJk...",type:"text"},null,512),[[P,a.value.deviceKey]])]),e("div",null,[t[41]||(t[41]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-server mr-2 text-gray-400"}),f(" 服务器地址 "),e("span",{class:"ml-2 text-xs text-gray-500"},"(可选)")],-1)),S(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>a.value.serverUrl=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"默认: https://api.day.app/push",type:"url"},null,512),[[P,a.value.serverUrl]])]),e("div",null,[t[43]||(t[43]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-flag mr-2 text-gray-400"}),f(" 通知级别 ")],-1)),S(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>a.value.level=s),class:"bg白色 w-full appearance-none rounded-xl border border-gray-300 px-4 py-3 pr-10 text-gray-900 shadow-sm transition-all focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white"},t[42]||(t[42]=[e("option",{value:""},"自动（根据通知类型）",-1),e("option",{value:"passive"},"被动",-1),e("option",{value:"active"},"默认",-1),e("option",{value:"timeSensitive"},"时效性",-1),e("option",{value:"critical"},"紧急",-1)]),512),[[J,a.value.level]])]),e("div",null,[t[44]||(t[44]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-music mr-2 text-gray-400"}),f(" 铃声 "),e("span",{class:"ml-2 text-xs text-gray-500"},"(可选)")],-1)),S(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>a.value.sound=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"默认系统提示音",type:"text"},null,512),[[P,a.value.sound]])]),e("div",null,[t[45]||(t[45]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-layer-group mr-2 text-gray-400"}),f(" 分组 "),e("span",{class:"ml-2 text-xs text-gray-500"},"(可选)")],-1)),S(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>a.value.group=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"自定义分组名称",type:"text"},null,512),[[P,a.value.group]])])])):A("",!0),a.value.type==="smtp"?(y(),w("div",Et,[e("div",null,[t[46]||(t[46]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-server mr-2 text-gray-400"}),f(" SMTP 主机 ")],-1)),S(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>a.value.host=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"smtp.example.com",type:"text"},null,512),[[P,a.value.host]])]),e("div",null,[t[47]||(t[47]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},"端口",-1)),S(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>a.value.port=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"465/587",type:"number"},null,512),[[P,a.value.port,void 0,{number:!0}]])]),e("div",jt,[e("label",Lt,[S(e("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>a.value.secure=s),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-0",type:"checkbox"},null,512),[[z,a.value.secure]]),t[48]||(t[48]=e("span",{class:"ml-3 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},"SSL/TLS",-1))])]),e("div",null,[t[49]||(t[49]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},"用户名",-1)),S(e("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>a.value.user=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",type:"text"},null,512),[[P,a.value.user]])]),e("div",null,[t[50]||(t[50]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},"密码/授权码",-1)),S(e("input",{"onUpdate:modelValue":t[16]||(t[16]=s=>a.value.pass=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",type:"password"},null,512),[[P,a.value.pass]])]),e("div",null,[t[51]||(t[51]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},"发件人",-1)),S(e("input",{"onUpdate:modelValue":t[17]||(t[17]=s=>a.value.from=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"sender@example.com",type:"email"},null,512),[[P,a.value.from]])]),e("div",null,[t[52]||(t[52]=e("label",{class:"mb-2 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},"收件人",-1)),S(e("input",{"onUpdate:modelValue":t[18]||(t[18]=s=>a.value.to=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder:text-gray-500",placeholder:"多个用逗号分隔",type:"text"},null,512),[[P,a.value.to]])]),e("div",Ft,[e("label",Mt,[S(e("input",{"onUpdate:modelValue":t[19]||(t[19]=s=>a.value.ignoreTLS=s),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-0",type:"checkbox"},null,512),[[z,a.value.ignoreTLS]]),t[53]||(t[53]=e("span",{class:"ml-3 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},"忽略TLS校验",-1))])])])):A("",!0),a.value.type==="dingtalk"||a.value.type==="feishu"?(y(),w("div",Kt,[e("div",Rt,[e("div",Wt,[e("label",Ot,[S(e("input",{"onUpdate:modelValue":t[20]||(t[20]=s=>a.value.enableSign=s),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-0",type:"checkbox"},null,512),[[z,a.value.enableSign]]),t[54]||(t[54]=e("span",{class:"ml-3 flex items-center text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-shield-alt mr-2 text-gray-400"}),f(" 启用签名验证 ")],-1))]),a.value.enableSign?(y(),w("span",zt,"已启用")):A("",!0)]),a.value.enableSign?(y(),w("div",qt,[t[55]||(t[55]=e("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"},"签名密钥",-1)),S(e("input",{"onUpdate:modelValue":t[21]||(t[21]=s=>a.value.secret=s),class:"w-full rounded-xl border border-gray-300 bg-white px-4 py-3 font-mono text-sm text-gray-900 shadow-sm transition-all placeholder:text-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20 dark:border-gray-600 dark:bg-gray-800 dark:text-white dark:placeholder:text-gray-500",placeholder:"SEC...",type:"text"},null,512),[[P,a.value.secret]])])):A("",!0)])])):A("",!0)])]),e("div",Qt,[e("div",Yt,[e("button",{class:"bg白色 group flex items-center rounded-xl border border-gray-300 px-4 py-2.5 text-sm font-medium text-gray-700 shadow-sm transition-all hover:bg-gray-50 hover:shadow-md dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",onClick:C},t[56]||(t[56]=[e("i",{class:"fas fa-times mr-2 transition-transform group-hover:scale-110"},null,-1),f(" 取消 ",-1)])),e("div",Gt,[e("button",{class:"group rounded-xl border border-blue-200 bg-blue-50 px-4 py-2.5 text-sm font-medium text-blue-700 shadow-sm transition-all hover:bg-blue-100 dark:border-blue-800 dark:bg-blue-900/50 dark:text-blue-300 dark:hover:bg-blue-900/70",disabled:p.testing,onClick:t[22]||(t[22]=s=>_.$emit("test",I()))},[e("i",{class:M(p.testing?"fas fa-spinner fa-spin mr-2":"fas fa-vial mr-2")},null,2),f(" "+$(p.testing?"测试中...":"测试连接"),1)],8,Ht),e("button",{class:"group rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 px-5 py-2.5 text-sm font-medium text-white shadow-md transition-all hover:from-blue-700 hover:to-indigo-700 hover:shadow-lg",onClick:t[23]||(t[23]=s=>_.$emit("save",I()))},t[57]||(t[57]=[e("i",{class:"fas fa-save mr-2"},null,-1),f(" 保存 ",-1)]))])])])])],32)):A("",!0)]))}},Xt={class:"mb-6 rounded-lg bg-white/80 p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},Zt={class:"flex items-center justify-between"},ea={class:"bg白色/80 mb-6 rounded-lg p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},ta={class:"space-y-3"},aa={class:"font-medium text-gray-700 dark:text-gray-300"},la={class:"ml-2 text-sm text-gray-500 dark:text-gray-400"},sa={class:"bg白色/80 mb-6 rounded-lg p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},ra={class:"mb-4 flex items-center justify-between"},oa={key:0,class:"space-y-4"},na={class:"flex items-start justify-between"},ia={class:"flex-1"},da={class:"flex items-center"},ua={class:"font-semibold text-gray-800 dark:text-gray-200"},ma={class:"text-sm text-gray-500 dark:text-gray-400"},ga={class:"mt-3 space-y-1 text-sm"},ca={key:0,class:"flex items-center text-gray-600 dark:text-gray-400"},pa={class:"truncate"},fa={key:1,class:"flex items-center text-gray-600 dark:text-gray-400"},ya={class:"truncate"},xa={key:2,class:"flex items-center text-gray-600 dark:text-gray-400"},ba={class:"truncate"},va={class:"ml-4 flex items-center gap-2"},ka={key:1,class:"py-8 text-center text-gray-500 dark:text-gray-400"},wa={class:"bg白色/80 rounded-lg p-6 shadow-lg backdrop-blur-sm dark:bg-gray-800/80"},ha={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},_a={class:"mt-6 text-center"},Va={__name:"WebhookSection",setup(p){const{webhookConfig:m,showPlatformModal:n,editingPlatform:h,platformForm:a,testingConnection:T,loadWebhookConfig:C,saveWebhookConfig:I,openAddPlatform:N,editPlatform:_,deletePlatform:t,togglePlatform:s,testPlatformForm:v,savePlatform:r,sendTestNotification:l,getNotificationTypeName:k,getNotificationTypeDescription:V,getPlatformIcon:B,getPlatformName:o}=kt();return Y(()=>{C().catch(()=>{})}),(u,g)=>{const j=Q,x=O;return y(),w("div",null,[e("div",Xt,[e("div",Zt,[g[8]||(g[8]=e("div",null,[e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"启用通知"),e("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," 开启后，系统将按配置发送通知到指定平台 ")],-1)),d(j,{modelValue:i(m).enabled,"onUpdate:modelValue":g[0]||(g[0]=b=>i(m).enabled=b),"active-text":"已启用","inactive-text":"未启用",onChange:i(I)},null,8,["modelValue","onChange"])])]),e("div",ea,[g[9]||(g[9]=e("h2",{class:"mb-4 text-lg font-semibold text-gray-800 dark:text-gray-200"},"通知类型",-1)),e("div",ta,[(y(!0),w(R,null,W(i(m).notificationTypes,(b,L)=>(y(),w("div",{key:L,class:"flex items-center justify-between"},[e("div",null,[e("span",aa,$(i(k)(L)),1),e("span",la,$(i(V)(L)),1)]),d(j,{modelValue:i(m).notificationTypes[L],"onUpdate:modelValue":re=>i(m).notificationTypes[L]=re,onChange:i(I)},null,8,["modelValue","onUpdate:modelValue","onChange"])]))),128))])]),e("div",sa,[e("div",ra,[g[11]||(g[11]=e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"通知平台",-1)),d(x,{type:"primary",onClick:i(N)},{default:c(()=>g[10]||(g[10]=[e("i",{class:"fas fa-plus mr-2"},null,-1),f(" 添加平台",-1)])),_:1,__:[10]},8,["onClick"])]),i(m).platforms&&i(m).platforms.length>0?(y(),w("div",oa,[(y(!0),w(R,null,W(i(m).platforms,b=>(y(),w("div",{key:b.id,class:"rounded-lg border border-gray-200 p-4 dark:border-gray-700"},[e("div",na,[e("div",ia,[e("div",da,[e("i",{class:M(["mr-3 text-xl",i(B)(b.type)])},null,2),e("div",null,[e("h3",ua,$(b.name||i(o)(b.type)),1),e("p",ma,$(i(o)(b.type)),1)])]),e("div",ga,[b.type!=="smtp"&&b.type!=="telegram"?(y(),w("div",ca,[g[12]||(g[12]=e("i",{class:"fas fa-link mr-2"},null,-1)),e("span",pa,$(b.url),1)])):A("",!0),b.type==="telegram"?(y(),w("div",fa,[g[13]||(g[13]=e("i",{class:"fas fa-robot mr-2"},null,-1)),e("span",ya,$(b.botToken),1)])):A("",!0),b.type==="smtp"?(y(),w("div",xa,[g[14]||(g[14]=e("i",{class:"fas fa-server mr-2"},null,-1)),e("span",ba,$(b.host)+":"+$(b.port)+" "+$(b.secure?"SSL":""),1)])):A("",!0)])]),e("div",va,[d(j,{"model-value":b.enabled!==!1,onChange:()=>i(s)(b.id)},null,8,["model-value","onChange"]),d(x,{circle:"",type:"primary",plain:"",onClick:L=>u.testPlatform(b)},{default:c(()=>g[15]||(g[15]=[e("i",{class:"fas fa-vial"},null,-1)])),_:2,__:[15]},1032,["onClick"]),d(x,{circle:"",plain:"",onClick:L=>i(_)(b)},{default:c(()=>g[16]||(g[16]=[e("i",{class:"fas fa-edit"},null,-1)])),_:2,__:[16]},1032,["onClick"]),d(x,{circle:"",type:"danger",plain:"",onClick:L=>i(t)(b.id)},{default:c(()=>g[17]||(g[17]=[e("i",{class:"fas fa-trash"},null,-1)])),_:2,__:[17]},1032,["onClick"])])])]))),128))])):(y(),w("div",ka,' 暂无配置的通知平台，请点击"添加平台"按钮添加 '))]),e("div",wa,[g[21]||(g[21]=e("h2",{class:"mb-4 text-lg font-semibold text-gray-800 dark:text-gray-200"},"高级设置",-1)),e("div",ha,[e("div",null,[g[18]||(g[18]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"最大重试次数",-1)),S(e("input",{"onUpdate:modelValue":g[1]||(g[1]=b=>i(m).retrySettings.maxRetries=b),class:"dark:text白色 mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 sm:text-sm",max:"10",min:"0",type:"number",onChange:g[2]||(g[2]=(...b)=>i(I)&&i(I)(...b))},null,544),[[P,i(m).retrySettings.maxRetries,void 0,{number:!0}]])]),e("div",null,[g[19]||(g[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"重试延迟 (毫秒)",-1)),S(e("input",{"onUpdate:modelValue":g[3]||(g[3]=b=>i(m).retrySettings.retryDelay=b),class:"dark:text白色 mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 sm:text-sm",max:"10000",min:"100",step:"100",type:"number",onChange:g[4]||(g[4]=(...b)=>i(I)&&i(I)(...b))},null,544),[[P,i(m).retrySettings.retryDelay,void 0,{number:!0}]])]),e("div",null,[g[20]||(g[20]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"超时时间 (毫秒)",-1)),S(e("input",{"onUpdate:modelValue":g[5]||(g[5]=b=>i(m).retrySettings.timeout=b),class:"dark:text白色 mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 sm:text-sm",max:"30000",min:"1000",step:"1000",type:"number",onChange:g[6]||(g[6]=(...b)=>i(I)&&i(I)(...b))},null,544),[[P,i(m).retrySettings.timeout,void 0,{number:!0}]])])])]),e("div",_a,[d(x,{type:"success",onClick:i(l)},{default:c(()=>g[22]||(g[22]=[e("i",{class:"fas fa-paper-plane mr-2"},null,-1),f("发送测试通知",-1)])),_:1,__:[22]},8,["onClick"])]),d(Jt,{modelValue:i(n),"onUpdate:modelValue":g[7]||(g[7]=b=>we(n)?n.value=b:null),editing:!!i(h),platform:i(a),testing:i(T),onSave:i(r),onTest:i(v)},null,8,["modelValue","editing","platform","testing","onSave","onTest"])])}}},$a={class:"settings-container"},Ia={class:"card p-4 sm:p-6"},Sa={class:"mb-6"},Ta={class:"flex space-x-8"},Ua={__name:"index",setup(p){const m=D("branding");function n(h){return["border-b-2 pb-2 text-sm font-medium transition-colors",m.value===h?"border-blue-500 text-blue-600 dark:border-blue-400 dark:text-blue-400":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"]}return(h,a)=>(y(),w("div",$a,[e("div",Ia,[a[6]||(a[6]=e("div",{class:"mb-4 sm:mb-6"},[e("h3",{class:"mb-1 text-lg font-bold text-gray-900 dark:text-gray-100 sm:mb-2 sm:text-xl"}," 系统设置 "),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 sm:text-base"},"网站定制和通知配置")],-1)),e("div",Sa,[e("nav",Ta,[e("button",{class:M(n("branding")),onClick:a[0]||(a[0]=T=>m.value="branding")},a[3]||(a[3]=[e("i",{class:"fas fa-palette mr-2"},null,-1),f(" 品牌设置 ",-1)]),2),e("button",{class:M(n("products")),onClick:a[1]||(a[1]=T=>m.value="products")},a[4]||(a[4]=[e("i",{class:"fas fa-store mr-2"},null,-1),f(" 产品配置 ",-1)]),2),e("button",{class:M(n("webhook")),onClick:a[2]||(a[2]=T=>m.value="webhook")},a[5]||(a[5]=[e("i",{class:"fas fa-bell mr-2"},null,-1),f(" 通知设置 ",-1)]),2)])]),e("div",null,[m.value==="branding"?(y(),F(at,{key:0})):m.value==="products"?(y(),F(ft,{key:1})):(y(),F(Va,{key:2}))])])]))}},Na=he(Ua,[["__scopeId","data-v-9458282e"]]);export{Na as default};
