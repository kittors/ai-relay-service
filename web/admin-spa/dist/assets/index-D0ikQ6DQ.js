import{a as Kt,b as Lt,E as jt,c as Dt,s as Gt,d as rt,r as Bt,e as $e,f as ea,g as ta,h as aa,j as sa,k as oa,p as la,v as it,l as Ne,u as ra,m as nt,n as _t,o as He,q as zt,t as dt,w as Vt,x as St,y as ia,A as na,B as Ft,C as da,D as ua,F as ca,G as Ye,H as pa,I as ma,J as ga,K as ya}from"./element-plus-T7eq0npu.js";import{_ as xe,c as oe,s as W,u as Wt}from"./index-CYC8e9-T.js";import{r as V,o as ce,x as y,y as r,z as e,R as c,I as J,L as F,J as w,Q as X,ac as ie,u as D,O as E,P as v,c as Q,C as ne,B as It,K as B,q as Ue,aP as Nt,V as fa,aq as le,T as ba,a5 as he,D as xa,_ as Pe,Y as De,an as ue,aa as We,aV as Ae,al as Se,f as Le}from"./vue-vendor-R8HMg95E.js";import{Q as lt}from"./vendor-DTV-MYIR.js";import{_ as va}from"./WindowCountdown-DF7xS2EZ.js";const ka={class:"mb-4 flex flex-col gap-3 lg:flex-col lg:items-start lg:justify-between"},wa={class:"flex flex-col gap-3 sm:flex-row sm:flex-wrap sm:items-center sm:gap-3"},Aa={class:"flex flex-col gap-3 sm:flex-row sm:flex-wrap sm:items-center sm:gap-3"},$a={__name:"ActiveKeysToolbar",props:{apiKeysLoading:Boolean,tagOptions:{type:Array,default:()=>[]},showCheckboxes:Boolean,selectedCount:{type:Number,default:0},globalDateFilter:{type:Object,required:!0},defaultTime:{type:Array,default:()=>[]},selectedTag:{type:String,default:""},searchKeyword:{type:String,default:""},searchMode:{type:String,default:"apiKey"},activationFilter:{type:String,default:""}},emits:["refresh","toggle-selection","export","open-create","open-email-search","open-batch-edit","open-packages","batch-delete","change-date-range","update:selectedTag","update:searchKeyword","update:searchMode","update-custom-range","update:activationFilter"],setup(m,{emit:O}){const o=m,S=O,I=V(o.selectedTag||""),p=V(o.searchKeyword||""),M=V(o.searchMode||"apiKey"),R=V(o.activationFilter||""),_=V(o.globalDateFilter.preset||"today");ce(()=>o.selectedTag,k=>I.value=k||""),ce(()=>o.searchKeyword,k=>p.value=k||""),ce(()=>o.searchMode,k=>M.value=k||"apiKey"),ce(()=>o.activationFilter,k=>R.value=k||""),ce(()=>o.globalDateFilter.preset,k=>_.value=k||"today");const K=k=>{S("change-date-range",k)};return(k,d)=>{const u=Kt,n=Lt,t=jt,b=Dt,g=rt,q=$e;return r(),y("div",ka,[e("div",wa,[c(n,{modelValue:_.value,"onUpdate:modelValue":d[0]||(d[0]=$=>_.value=$),placeholder:"选择时间范围",style:{width:"160px"},onChange:K},{default:w(()=>[c(u,{label:"今日",value:"today"}),c(u,{label:"最近7天",value:"7days"}),c(u,{label:"最近30天",value:"30days"}),c(u,{label:"全部时间",value:"all"}),c(u,{label:"自定义范围",value:"custom"})]),_:1},8,["modelValue"]),m.globalDateFilter.type==="custom"?(r(),J(t,{key:0,class:"api-key-date-picker",clearable:!0,"default-time":m.defaultTime,"end-placeholder":"结束日期",format:"YYYY-MM-DD HH:mm:ss","model-value":m.globalDateFilter.customRange,"range-separator":"至","start-placeholder":"开始日期",style:{width:"320px"},type:"datetimerange","unlink-panels":!1,"value-format":"YYYY-MM-DD HH:mm:ss","onUpdate:modelValue":d[1]||(d[1]=$=>k.$emit("update-custom-range",$))},null,8,["default-time","model-value"])):F("",!0),c(n,{modelValue:I.value,"onUpdate:modelValue":d[2]||(d[2]=$=>I.value=$),clearable:"",filterable:"",placeholder:"所有标签",style:{width:"160px"},onChange:d[3]||(d[3]=$=>k.$emit("update:selectedTag",I.value))},{default:w(()=>[(r(!0),y(X,null,ie(m.tagOptions,$=>(r(),J(u,{key:$.value,label:$.label,value:$.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),c(n,{modelValue:R.value,"onUpdate:modelValue":d[4]||(d[4]=$=>R.value=$),placeholder:"是否激活",clearable:"",style:{width:"140px"},onChange:d[5]||(d[5]=$=>k.$emit("update:activationFilter",R.value))},{default:w(()=>[c(u,{label:"全部",value:""}),c(u,{label:"已激活",value:"true"}),c(u,{label:"未激活",value:"false"})]),_:1},8,["modelValue"]),c(g,{modelValue:p.value,"onUpdate:modelValue":d[6]||(d[6]=$=>p.value=$),placeholder:"搜索名称或所属账号...",clearable:"",style:{width:"260px"},onInput:d[7]||(d[7]=$=>k.$emit("update:searchKeyword",p.value))},{prefix:w(()=>[c(b,null,{default:w(()=>[c(D(Gt))]),_:1})]),_:1},8,["modelValue"]),c(n,{modelValue:M.value,"onUpdate:modelValue":d[8]||(d[8]=$=>M.value=$),placeholder:"搜索模式",style:{width:"140px"},onChange:d[9]||(d[9]=$=>k.$emit("update:searchMode",M.value))},{default:w(()=>[c(u,{label:"按Key名称",value:"apiKey"}),c(u,{label:"按所属账号",value:"bindingAccount"})]),_:1},8,["modelValue"]),c(q,{loading:m.apiKeysLoading,onClick:d[10]||(d[10]=$=>k.$emit("refresh"))},{default:w(()=>[c(b,{class:"mr-1"},{default:w(()=>[c(D(Bt))]),_:1}),d[18]||(d[18]=E("刷新 ",-1))]),_:1,__:[18]},8,["loading"]),c(q,{onClick:d[11]||(d[11]=$=>k.$emit("toggle-selection"))},{default:w(()=>[c(b,{class:"mr-1"},{default:w(()=>[c(D(ea))]),_:1}),E(v(m.showCheckboxes?"取消选择":"选择"),1)]),_:1})]),e("div",Aa,[c(q,{type:"success",onClick:d[12]||(d[12]=$=>k.$emit("export"))},{default:w(()=>[c(b,{class:"mr-1"},{default:w(()=>[c(D(ta))]),_:1}),d[19]||(d[19]=E("导出数据 ",-1))]),_:1,__:[19]}),m.selectedCount>0?(r(),J(q,{key:0,type:"primary",plain:"",onClick:d[13]||(d[13]=$=>k.$emit("open-batch-edit"))},{default:w(()=>[c(b,{class:"mr-1"},{default:w(()=>[c(D(aa))]),_:1}),E("编辑选中 ("+v(m.selectedCount)+") ",1)]),_:1})):F("",!0),m.selectedCount>0?(r(),J(q,{key:1,type:"danger",plain:"",onClick:d[14]||(d[14]=$=>k.$emit("batch-delete"))},{default:w(()=>[c(b,{class:"mr-1"},{default:w(()=>[c(D(sa))]),_:1}),E("删除选中 ("+v(m.selectedCount)+") ",1)]),_:1})):F("",!0),c(q,{type:"warning",onClick:d[15]||(d[15]=$=>k.$emit("open-packages"))},{default:w(()=>[c(b,{class:"mr-1"},{default:w(()=>[c(D(oa))]),_:1}),d[20]||(d[20]=E("API Key 模版 ",-1))]),_:1,__:[20]}),c(q,{type:"primary",onClick:d[16]||(d[16]=$=>k.$emit("open-create"))},{default:w(()=>[c(b,{class:"mr-1"},{default:w(()=>[c(D(la))]),_:1}),d[21]||(d[21]=E("创建新 Key ",-1))]),_:1,__:[21]}),c(q,{type:"info",plain:"",onClick:d[17]||(d[17]=$=>k.$emit("open-email-search"))},{default:w(()=>[c(b,{class:"mr-1"},{default:w(()=>[c(D(Gt))]),_:1}),d[22]||(d[22]=E("邮箱查 Key ",-1))]),_:1,__:[22]})])])}}},ha=xe($a,[["__scopeId","data-v-c85b3ae9"]]),Ca={class:"w-full"},Ia={key:0,class:"flex items-center justify-center rounded-lg px-3 py-2 text-xs"},Ka={key:1,class:"space-y-1.5"},La={class:"flex items-center justify-between text-[11px] font-medium"},Da={class:"text-gray-700 dark:text-gray-200"},_a={class:"relative h-1.5 overflow-hidden rounded-full bg-gray-200/85 dark:bg-gray-700/70"},Va={class:"relative z-10 flex h-full items-center justify-between px-3"},Sa={class:"flex items-center gap-1.5"},Ma={class:"flex items-center gap-1.5"},Ra={key:0,class:"pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-700 group-hover:opacity-30",style:{background:"linear-gradient(105deg, transparent 35%, rgba(255,255,255,0.55) 48%, transparent 63%)",animation:"shine 2.8s infinite"}},Ea={__name:"LimitProgressBar",props:{type:{type:String,required:!0,validator:m=>["daily","opus","window","total"].includes(m)},variant:{type:String,default:"full",validator:m=>["full","compact"].includes(m)},label:{type:String,required:!0},current:{type:Number,default:0},limit:{type:Number,required:!0},showShine:{type:Boolean,default:!1}},setup(m){const O=m,o=Q(()=>O.variant==="compact"),S=Q(()=>{if(!O.limit||O.limit<=0)return 0;const u=O.current/O.limit*100;return Math.min(u,100)}),I=Q(()=>{switch(O.type){case"daily":return"border-emerald-200/80 bg-white/80 shadow-[0_10px_24px_rgba(16,185,129,0.18)] group-hover:shadow-[0_14px_30px_rgba(16,185,129,0.22)] dark:border-emerald-500/40 dark:bg-emerald-950/40 dark:shadow-[0_12px_28px_rgba(0,0,0,0.45)]";case"opus":return"border-violet-200/80 bg-white/80 shadow-[0_10px_24px_rgba(139,92,246,0.18)] group-hover:shadow-[0_14px_30px_rgba(139,92,246,0.22)] dark:border-violet-500/40 dark:bg-violet-950/40 dark:shadow-[0_12px_28px_rgba(0,0,0,0.45)]";case"window":return"border-sky-200/80 bg-white/80 shadow-[0_10px_24px_rgba(56,189,248,0.18)] group-hover:shadow-[0_14px_30px_rgba(56,189,248,0.22)] dark:border-sky-500/40 dark:bg-sky-950/40 dark:shadow-[0_12px_28px_rgba(0,0,0,0.45)]";case"total":return"border-blue-200/80 bg-white/80 shadow-[0_10px_24px_rgba(59,130,246,0.18)] group-hover:shadow-[0_14px_30px_rgba(59,130,246,0.22)] dark:border-blue-500/40 dark:bg-blue-950/40 dark:shadow-[0_12px_28px_rgba(0,0,0,0.45)]";default:return"border-gray-200/80 bg-white/80 shadow-[0_10px_24px_rgba(148,163,184,0.18)] group-hover:shadow-[0_14px_30px_rgba(148,163,184,0.22)] dark:border-gray-600/50 dark:bg-gray-900/50 dark:shadow-[0_12px_28px_rgba(0,0,0,0.45)]"}}),p=Q(()=>{switch(O.type){case"daily":return"bg-gradient-to-r from-emerald-50 via-green-50 to-emerald-100 dark:from-emerald-900/40 dark:via-emerald-900/20 dark:to-emerald-800/30";case"opus":return"bg-gradient-to-r from-violet-50 via-violet-100 to-fuchsia-100 dark:from-violet-900/40 dark:via-violet-900/20 dark:to-fuchsia-900/30";case"window":return"bg-gradient-to-r from-sky-50 via-sky-100 to-cyan-100 dark:from-sky-900/40 dark:via-sky-900/20 dark:to-cyan-900/30";case"total":return"bg-gradient-to-r from-blue-50 via-blue-100 to-sky-100 dark:from-blue-900/40 dark:via-blue-900/20 dark:to-sky-900/30";default:return"bg-gradient-to-r from-gray-100 via-gray-50 to-gray-200 dark:from-gray-900/30 dark:via-gray-900/10 dark:to-gray-800/30"}}),M=Q(()=>{const u=S.value;return O.type==="daily"?u>=90?"bg-gradient-to-r from-rose-500 via-red-500 to-rose-600 dark:from-rose-500 dark:via-red-500 dark:to-rose-600":u>=70?"bg-gradient-to-r from-amber-400 via-orange-400 to-amber-500 dark:from-amber-400 dark:via-orange-400 dark:to-amber-500":"bg-gradient-to-r from-emerald-400 via-emerald-500 to-teal-500 dark:from-emerald-400 dark:via-emerald-500 dark:to-teal-500":O.type==="opus"?u>=90?"bg-gradient-to-r from-rose-500 via-red-500 to-rose-600 dark:from-rose-500 dark:via-red-500 dark:to-rose-600":u>=70?"bg-gradient-to-r from-amber-400 via-orange-400 to-amber-500 dark:from-amber-400 dark:via-orange-400 dark:to-amber-500":"bg-gradient-to-r from-violet-400 via-purple-500 to-fuchsia-500 dark:from-violet-400 dark:via-purple-500 dark:to-fuchsia-500":O.type==="window"?u>=90?"bg-gradient-to-r from-rose-500 via-red-500 to-rose-600 dark:from-rose-500 dark:via-red-500 dark:to-rose-600":u>=70?"bg-gradient-to-r from-amber-400 via-orange-400 to-amber-500 dark:from-amber-400 dark:via-orange-400 dark:to-amber-500":"bg-gradient-to-r from-sky-400 via-cyan-400 to-blue-500 dark:from-sky-400 dark:via-cyan-400 dark:to-blue-500":O.type==="total"?u>=90?"bg-gradient-to-r from-rose-500 via-red-500 to-rose-600 dark:from-rose-500 dark:via-red-500 dark:to-rose-600":u>=70?"bg-gradient-to-r from-amber-400 via-orange-400 to-amber-500 dark:from-amber-400 dark:via-orange-400 dark:to-amber-500":"bg-gradient-to-r from-sky-500 via-blue-500 to-cyan-500 dark:from-sky-500 dark:via-blue-500 dark:to-cyan-500":"bg-gray-300 dark:bg-gray-400"}),R=Q(()=>{const u=S.value;if(u>=95)return"bg-rose-500 dark:bg-rose-400";if(u>=80)return"bg-amber-400 dark:bg-amber-300";switch(O.type){case"daily":return"bg-emerald-500 dark:bg-emerald-400";case"opus":return"bg-violet-500 dark:bg-violet-400";case"window":return"bg-sky-500 dark:bg-sky-400";case"total":return"bg-blue-500 dark:bg-blue-400";default:return"bg-slate-400 dark:bg-slate-500"}}),_=Q(()=>{const u=S.value;if(u>=95)return"text-rose-600 dark:text-rose-300";if(u>=80)return"text-amber-600 dark:text-amber-300";switch(O.type){case"daily":return"text-emerald-600 dark:text-emerald-300";case"opus":return"text-violet-600 dark:text-violet-300";case"window":return"text-sky-600 dark:text-sky-300";case"total":return"text-blue-600 dark:text-blue-300";default:return"text-gray-600 dark:text-gray-300"}}),K=Q(()=>{const u=S.value;let n="";if(u>=90)n="text-red-700 dark:text-red-400";else if(u>=70)n="text-orange-700 dark:text-orange-400";else switch(O.type){case"daily":n="text-green-700 dark:text-green-400";break;case"opus":n="text-purple-700 dark:text-purple-400";break;case"window":n="text-blue-700 dark:text-blue-400";break;default:n="text-gray-600 dark:text-gray-400"}let t="";switch(O.type){case"daily":t="fas fa-calendar-day";break;case"opus":t="fas fa-gem";break;case"window":t="fas fa-clock";break;case"total":t="fas fa-wallet";break;default:t="fas fa-infinity"}return`${t} ${n}`}),k=Q(()=>{if(S.value>40)return"text-white drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]";switch(O.type){case"daily":return"text-gray-900 dark:text-gray-100";case"opus":return"text-purple-900 dark:text-purple-100";case"window":return"text-blue-900 dark:text-blue-100";case"total":return"text-blue-900 dark:text-blue-100";default:return"text-gray-900 dark:text-gray-100"}}),d=Q(()=>{const u=S.value;if(u>70)return"text-white drop-shadow-[0_2px_4px_rgba(0,0,0,0.9)]";if(u>=90)return"text-red-700 dark:text-red-300";if(u>=70)return"text-orange-700 dark:text-orange-300";switch(O.type){case"daily":return"text-green-800 dark:text-green-200";case"opus":return"text-purple-800 dark:text-purple-200";case"window":return"text-blue-800 dark:text-blue-200";case"total":return"text-blue-800 dark:text-blue-200";default:return"text-gray-900 dark:text-gray-100"}});return(u,n)=>(r(),y("div",Ca,[!m.limit||m.limit<=0?(r(),y("div",Ia,n[0]||(n[0]=[e("div",{class:"flex items-center gap-1.5 text-gray-600 dark:text-gray-300"},[e("i",{class:"fas fa-infinity text-sm text-gray-500 dark:text-gray-400"}),e("span",{class:"font-medium"},"无限制")],-1)]))):o.value?(r(),y("div",Ka,[e("div",La,[e("div",{class:ne(["flex items-center gap-1.5",_.value])},[e("i",{class:ne(["text-[11px]",K.value])},null,2),e("span",null,v(m.label),1)],2),e("span",Da,"$"+v(m.current.toFixed(2))+" / $"+v(m.limit.toFixed(2)),1)]),e("div",_a,[e("div",{class:ne(["absolute inset-y-0 rounded-full transition-all duration-500 ease-out",R.value]),style:It({width:S.value+"%"})},null,6)])])):(r(),y("div",{key:2,class:ne(["group relative h-9 w-full overflow-hidden rounded-xl border transition-all duration-300 ease-out",I.value])},[e("div",{class:ne(["absolute inset-0",p.value])},null,2),e("div",{class:ne(["absolute inset-0 h-full transition-all duration-500 ease-out",M.value]),style:It({width:S.value+"%"})},null,6),n[1]||(n[1]=e("div",{class:"pointer-events-none absolute inset-0 rounded-xl border border-white/50 opacity-40 mix-blend-overlay dark:border-white/10"},null,-1)),e("div",Va,[e("div",Sa,[e("i",{class:ne(["text-xs",K.value])},null,2),e("span",{class:ne(["text-xs font-semibold",k.value])},v(m.label),3)]),e("div",Ma,[e("span",{class:ne(["text-xs font-bold tabular-nums",d.value])}," $"+v(m.current.toFixed(2))+" / $"+v(m.limit.toFixed(2)),3)])]),m.showShine&&S.value>0?(r(),y("div",Ra)):F("",!0)],2))]))}},Ct=xe(Ea,[["__scopeId","data-v-8a01dc56"]]);function Ta(m,O="YYYY-MM-DD HH:mm:ss"){if(!m)return"";const o=new Date(m),S=o.getFullYear(),I=String(o.getMonth()+1).padStart(2,"0"),p=String(o.getDate()).padStart(2,"0"),M=String(o.getHours()).padStart(2,"0"),R=String(o.getMinutes()).padStart(2,"0"),_=String(o.getSeconds()).padStart(2,"0");return O.replace("YYYY",S).replace("MM",I).replace("DD",p).replace("HH",M).replace("mm",R).replace("ss",_)}const Ua={class:"truncate font-semibold"},Pa={key:0,class:"mt-1 text-xs text-red-600"},Oa={class:"flex flex-wrap gap-4"},Ga={key:0,class:"text-xs text-gray-500"},qa={key:0},ja={key:1,class:"text-gray-400"},Ba=["onClick"],za=["onClick"],Fa=["onClick"],Wa={__name:"ActiveKeysTable",props:{data:{type:Array,default:()=>[]},isLdapEnabled:{type:Boolean,default:!1},showCheckboxes:{type:Boolean,default:!1},getBindingStrings:{type:Function,required:!0},selected:{type:Array,default:()=>[]},dateFilter:{type:Object,required:!0},loading:{type:Boolean,default:!1},tableHeight:{type:[Number,String],default:560}},emits:["update:selected","sort-change","edit","renew","delete","detail","edit-expiry"],setup(m,{emit:O}){const o=m,S=O,I=t=>{S("update:selected",t.map(b=>b.id))},p=t=>!t&&t!==0?"0":t.toLocaleString("zh-CN"),M=t=>!t&&t!==0?"0":t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":String(t),R=t=>{if(!t)return"-";try{return Ta(t,"YYYY-MM-DD HH:mm:ss")}catch{return String(t)}},_=t=>{var q,$;const b=t.usage||{};switch(((q=o.dateFilter)==null?void 0:q.type)==="custom"?"custom":(($=o.dateFilter)==null?void 0:$.preset)||"today"){case"today":return b.today||b.daily||b.total||{};case"7days":return b.weekly||b.daily||b.total||{};case"30days":return b.monthly||b.total||{};case"all":case"custom":default:return b.total||{}}},K=t=>R(t),k=t=>t?new Date(t)<new Date:!1,d=t=>!t||k(t)?!1:(new Date(t)-new Date)/(1e3*60*60*24)<=7,u=(t,b)=>{const g=(b||"days").toLowerCase();return!t||t<=0?"未设置":g==="hours"?`${t}小时`:g==="months"||g==="month"?`${t}月`:`${t}天`},n=async t=>{var b;try{const g=await oe.get(`/admin/api-keys/${t.id}/token`);if(!g.success){W(g.error||"复制失败","error");return}const q=(b=g.data)==null?void 0:b.key;if(!q){W("该 Key 的明文不可用，无法复制","error");return}await navigator.clipboard.writeText(q),W("访问令牌已复制","success")}catch{W("复制失败","error")}};return(t,b)=>{const g=Ne,q=Dt,$=nt,A=$e,l=_t,C=He,N=it;return B((r(),J(C,{data:m.data,border:"",style:{width:"100%"},height:m.tableHeight,onSelectionChange:I,"empty-text":m.loading?"":"暂无数据","element-loading-text":"加载中...","element-loading-background":"transparent"},{default:w(()=>[m.showCheckboxes?(r(),J(g,{key:0,type:"selection",width:"48"})):F("",!0),c(g,{label:"名称","min-width":"160"},{default:w(({row:T})=>[e("div",Ua,v(T.name),1),m.isLdapEnabled&&T.ownerDisplayName?(r(),y("div",Pa,[c(q,{class:"mr-1"},{default:w(()=>[c(D(ra))]),_:1}),E(v(T.ownerDisplayName),1)])):F("",!0)]),_:1}),c(g,{label:"所属账号","min-width":"220"},{default:w(({row:T})=>[e("div",Oa,[(r(!0),y(X,null,ie(m.getBindingStrings(T),(ee,se)=>(r(),J($,{key:se,size:"small",type:"info"},{default:w(()=>[E(v(ee),1)]),_:2},1024))),128)),m.getBindingStrings(T).length===0?(r(),y("span",Ga,"共享池")):F("",!0)])]),_:1}),c(g,{label:"是否激活","min-width":"100",align:"center"},{default:w(({row:T})=>[c($,{type:T.isActivated?"success":"info",size:"small"},{default:w(()=>[E(v(T.isActivated?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),c(g,{label:"每日请求上限 (次)","min-width":"160",align:"right"},{default:w(({row:T})=>[e("span",null,v(T.dailyRequestsLimit&&T.dailyRequestsLimit>0?T.dailyRequestsLimit:"无限"),1)]),_:1}),c(g,{label:"速率限制","min-width":"140"},{default:w(({row:T})=>[T.rateLimitWindow>0&&T.rateLimitRequests>0?(r(),y("span",qa,v(T.rateLimitRequests)+" 次 / "+v(T.rateLimitWindow)+" 分钟 ",1)):(r(),y("span",ja,"无限"))]),_:1}),c(g,{label:"Token","min-width":"120",align:"right"},{default:w(({row:T})=>[E(v(M(_(T).tokens||_(T).allTokens||0)),1)]),_:1}),c(g,{label:"请求数","min-width":"120",align:"right"},{default:w(({row:T})=>[E(v(p(_(T).requests||0)),1)]),_:1}),c(g,{label:"最后使用","min-width":"120"},{default:w(({row:T})=>[E(v(R(T.lastUsedAt)),1)]),_:1}),c(g,{label:"创建时间","min-width":"120"},{default:w(({row:T})=>[E(v(R(T.createdAt)),1)]),_:1}),c(g,{label:"过期时间","min-width":"180"},{default:w(({row:T})=>[T.expirationMode==="activation"&&!T.isActivated?(r(),y("span",{key:0,class:"text-gray-500 cursor-pointer",onClick:ee=>t.$emit("edit-expiry",T)}," 未激活（"+v(u(T.activationDays,T.activationUnit))+"） ",9,Ba)):(r(),y(X,{key:1},[T.expiresAt?(r(),y(X,{key:1},[k(T.expiresAt)?(r(),J($,{key:0,type:"danger",size:"small",onClick:ee=>t.$emit("edit-expiry",T)},{default:w(()=>b[0]||(b[0]=[E("已过期",-1)])),_:2,__:[0]},1032,["onClick"])):d(T.expiresAt)?(r(),J($,{key:1,type:"warning",size:"small",onClick:ee=>t.$emit("edit-expiry",T)},{default:w(()=>[E(v(K(T.expiresAt)),1)]),_:2},1032,["onClick"])):(r(),y("span",{key:2,class:"cursor-pointer",onClick:ee=>t.$emit("edit-expiry",T)},v(K(T.expiresAt)),9,Fa))],64)):(r(),y("span",{key:0,class:"text-gray-400 cursor-pointer",onClick:ee=>t.$emit("edit-expiry",T)},"永不过期",8,za))],64))]),_:1}),c(g,{fixed:"right",label:"操作","min-width":"240"},{default:w(({row:T})=>[c(A,{link:"",type:"success",onClick:ee=>n(T)},{default:w(()=>b[1]||(b[1]=[E("复制Token",-1)])),_:2,__:[1]},1032,["onClick"]),c(A,{link:"",type:"primary",onClick:ee=>t.$emit("detail",T)},{default:w(()=>b[2]||(b[2]=[E("详情",-1)])),_:2,__:[2]},1032,["onClick"]),c(A,{link:"",type:"primary",onClick:ee=>t.$emit("edit",T)},{default:w(()=>b[3]||(b[3]=[E("编辑",-1)])),_:2,__:[3]},1032,["onClick"]),T.expiresAt&&(k(T.expiresAt)||d(T.expiresAt))?(r(),J(A,{key:0,link:"",type:"primary",onClick:ee=>t.$emit("renew",T)},{default:w(()=>b[4]||(b[4]=[E("续期",-1)])),_:2,__:[4]},1032,["onClick"])):F("",!0),c(l,{title:"确定删除该 Key？","confirm-button-text":"删除","cancel-button-text":"取消",onConfirm:ee=>t.$emit("delete",T)},{reference:w(()=>[c(A,{link:"",type:"danger"},{default:w(()=>b[5]||(b[5]=[E("删除",-1)])),_:1,__:[5]})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data","height","empty-text"])),[[N,m.loading]])}}},Na={class:"mb-3 flex items-center justify-between"},Ha={class:"text-sm text-gray-600 dark:text-gray-400"},Ya={class:"flex items-center gap-8"},Qa={class:"font-semibold"},Ja={__name:"DeletedKeysTable",props:{data:{type:Array,default:()=>[]},total:{type:Number,default:0},loading:{type:Boolean,default:!1},tableHeight:{type:[Number,String],default:560}},emits:["restore","purge","clear-all","refresh"],setup(m){const O=o=>{if(!o)return"-";try{return new Date(o).toLocaleString("zh-CN")}catch{return String(o)}};return(o,S)=>{const I=Dt,p=$e,M=_t,R=Ne,_=nt,K=He,k=it;return r(),y("div",null,[e("div",Na,[e("div",Ha," 已删除 API Keys 共 "+v(m.total)+" 个 ",1),e("div",Ya,[c(p,{loading:m.loading,onClick:S[0]||(S[0]=d=>o.$emit("refresh"))},{default:w(()=>[c(I,{class:"mr-1"},{default:w(()=>[c(D(Bt))]),_:1}),S[2]||(S[2]=E("刷新 ",-1))]),_:1,__:[2]},8,["loading"]),c(M,{title:"确定清空全部已删除的 Keys？此操作不可恢复。","confirm-button-text":"清空","cancel-button-text":"取消",onConfirm:S[1]||(S[1]=d=>o.$emit("clear-all"))},{reference:w(()=>[c(p,{type:"danger",plain:""},{default:w(()=>S[3]||(S[3]=[E("清空所有已删除",-1)])),_:1,__:[3]})]),_:1})])]),B((r(),J(K,{data:m.data,border:"",style:{width:"100%"},height:m.tableHeight,"element-loading-text":"加载中...","element-loading-background":"transparent"},{default:w(()=>[c(R,{label:"名称","min-width":"200"},{default:w(({row:d})=>[e("div",Qa,v(d.name),1)]),_:1}),c(R,{label:"删除时间","min-width":"160"},{default:w(({row:d})=>[E(v(O(d.deletedAt)),1)]),_:1}),c(R,{label:"删除来源","min-width":"140"},{default:w(({row:d})=>[d.deletedByType==="admin"?(r(),J(_,{key:0,type:"info",size:"small"},{default:w(()=>S[4]||(S[4]=[E("管理员",-1)])),_:1,__:[4]})):d.deletedByType==="user"?(r(),J(_,{key:1,type:"success",size:"small"},{default:w(()=>S[5]||(S[5]=[E("用户",-1)])),_:1,__:[5]})):(r(),J(_,{key:2,type:"warning",size:"small"},{default:w(()=>S[6]||(S[6]=[E("系统",-1)])),_:1,__:[6]}))]),_:1}),c(R,{label:"操作者","min-width":"160"},{default:w(({row:d})=>[E(v(d.deletedBy||"-"),1)]),_:1}),c(R,{fixed:"right",label:"操作","min-width":"160"},{default:w(({row:d})=>[c(p,{link:"",type:"primary",onClick:u=>o.$emit("restore",d.id)},{default:w(()=>S[7]||(S[7]=[E("恢复",-1)])),_:2,__:[7]},1032,["onClick"]),c(M,{title:"确定彻底删除？此操作不可恢复。","confirm-button-text":"删除","cancel-button-text":"取消",onConfirm:u=>o.$emit("purge",d.id)},{reference:w(()=>[c(p,{link:"",type:"danger"},{default:w(()=>S[8]||(S[8]=[E("彻底删除",-1)])),_:1,__:[8]})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data","height"])),[[k,m.loading]])])}}},Za={class:"mb-3 flex items-center justify-between"},Xa={class:"font-semibold"},es={class:"text-xs text-gray-500"},ts={key:0},as={key:1},ss={class:"text-xs text-gray-700"},os={key:0},ls={key:1},rs={__name:"TemplateList",props:{templates:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["create","edit","delete","quick-create"],setup(m){return(O,o)=>{const S=$e,I=Ne,p=_t,M=He,R=zt,_=it;return r(),y("div",null,[e("div",Za,[o[2]||(o[2]=e("div",{class:"text-sm text-gray-600"},"定义可复用的 API Key 模版，快速创建",-1)),e("div",null,[c(S,{type:"primary",onClick:o[0]||(o[0]=K=>O.$emit("create"))},{default:w(()=>o[1]||(o[1]=[E("新建模版",-1)])),_:1,__:[1]})])]),B((r(),J(M,{data:m.templates,border:"",style:{width:"100%"}},{default:w(()=>[c(I,{label:"名称","min-width":"200"},{default:w(({row:K})=>[e("div",Xa,v(K.name),1),e("div",es,v(K.description),1)]),_:1}),c(I,{label:"权限",width:"100"},{default:w(()=>o[3]||(o[3]=[E("OpenAI",-1)])),_:1}),c(I,{label:"速率",width:"160"},{default:w(({row:K})=>[K.rateLimitWindow>0&&K.rateLimitRequests>0?(r(),y("span",ts,v(K.rateLimitRequests)+"次/"+v(K.rateLimitWindow)+"min ",1)):(r(),y("span",as,"不限"))]),_:1}),c(I,{label:"每日请求上限",width:"140"},{default:w(({row:K})=>[E(v(Number(K.dailyRequestsLimit||0)||"不限"),1)]),_:1}),c(I,{label:"绑定","min-width":"140"},{default:w(({row:K})=>[e("div",ss,[K.openaiAccountId?(r(),y("span",os,"OpenAI")):(r(),y("span",ls,"共享池"))])]),_:1}),c(I,{fixed:"right",label:"操作",width:"220"},{default:w(({row:K})=>[c(S,{link:"",type:"primary",onClick:k=>O.$emit("quick-create",K)},{default:w(()=>o[4]||(o[4]=[E("快速创建",-1)])),_:2,__:[4]},1032,["onClick"]),c(S,{link:"",type:"primary",onClick:k=>O.$emit("edit",K)},{default:w(()=>o[5]||(o[5]=[E("编辑",-1)])),_:2,__:[5]},1032,["onClick"]),c(p,{title:"删除该模版？",onConfirm:k=>O.$emit("delete",K)},{reference:w(()=>[c(S,{link:"",type:"danger"},{default:w(()=>o[6]||(o[6]=[E("删除",-1)])),_:1,__:[6]})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[_,m.loading]]),!m.loading&&(!m.templates||m.templates.length===0)?(r(),J(R,{key:0,description:"暂无模版",class:"mt-6"})):F("",!0)])}}},is={class:"section"},ns={class:"section"},ds={class:"section"},us={class:"section"},cs={class:"preview"},ps={class:"section"},ms={class:"inline-group"},gs={class:"section"},ys={__name:"TemplateEditDialog",props:{show:{type:Boolean,default:!1},template:{type:Object,default:null},accounts:{type:Object,required:!0},tagOptions:{type:Array,default:()=>[]}},emits:["close","saved"],setup(m,{emit:O}){const o=m,S=O,I=V(!1);ce(()=>o.show,d=>I.value=d,{immediate:!0}),ce(()=>I.value,d=>{d||S("close")});const p=V({id:"",name:"",description:"",rateLimitWindow:0,rateLimitRequests:0,rateLimitCost:0,dailyRequestsLimit:0,expirationMode:"activation",activationUnit:"days",activationDays:null,isActive:!0,openaiGroupId:"",tags:[]}),M=o.accounts,R=o.tagOptions;ce(()=>o.template,d=>{if(!d)p.value={id:"",name:"",description:"",rateLimitWindow:0,rateLimitRequests:0,rateLimitCost:0,dailyRequestsLimit:0,expirationMode:"activation",activationUnit:"days",activationDays:null,isActive:!0,openaiGroupId:"",tags:[]};else{const u=new Set(["hours","days","months"]);p.value={id:d.id||"",name:d.name||"",description:d.description||"",rateLimitWindow:d.rateLimitWindow||0,rateLimitRequests:d.rateLimitRequests||0,rateLimitCost:d.rateLimitCost||0,dailyRequestsLimit:d.dailyRequestsLimit||0,expirationMode:d.expirationMode||"activation",activationUnit:u.has(d.activationUnit)?d.activationUnit:"days",activationDays:d.activationDays||null,isActive:d.isActive!==!1,openaiGroupId:d.openaiAccountId&&d.openaiAccountId.startsWith("group:")?d.openaiAccountId.slice(6):"",tags:Array.isArray(d.tags)?d.tags:[]}}},{immediate:!0}),ce(()=>p.value.expirationMode,d=>{d==="fixed"?p.value.activationDays!==null&&(p.value.activationDays=null):p.value.activationUnit||(p.value.activationUnit="days")});const _=Q(()=>{const d=Number(p.value.rateLimitRequests||0),u=Number(p.value.rateLimitWindow||0);return d>0&&u>0?`${d} 次 / ${u} 分钟`:"不限制"});function K(){const d={...p.value};return d.openaiAccountId=p.value.openaiGroupId?`group:${p.value.openaiGroupId}`:"",delete d.openaiGroupId,d.permissions="openai",delete d.azureOpenaiAccountId,delete d.bedrockAccountId,delete d.claudeConsoleAccountId,d}async function k(){var d,u;try{if(!p.value.name)return W("请输入模版名称","warning");if(p.value.expirationMode==="activation"){const t=Number(p.value.activationDays);if(!t||t<=0)return W("请输入有效的周期值（> 0）","warning")}const n=K();p.value.id?(await oe.put(`/admin/api-key-templates/${p.value.id}`,n)).success&&W("已保存模版","success"):(await oe.post("/admin/api-key-templates",n)).success&&W("已创建模版","success"),S("saved"),I.value=!1}catch(n){W(((u=(d=n.response)==null?void 0:d.data)==null?void 0:u.error)||"保存失败","error")}}return(d,u)=>{const n=rt,t=St,b=ia,g=Kt,q=Lt,$=nt,A=na,l=Ft,C=da,N=ca,T=ua,ee=jt,se=Vt,x=dt,a=$e,L=Ye;return r(),J(L,{modelValue:I.value,"onUpdate:modelValue":u[14]||(u[14]=i=>I.value=i),title:p.value.id?"编辑模版":"新建模版",width:"840px","append-to-body":"",onClosed:u[15]||(u[15]=i=>d.$emit("close"))},{footer:w(()=>[c(a,{onClick:u[13]||(u[13]=i=>I.value=!1)},{default:w(()=>u[28]||(u[28]=[E("取消",-1)])),_:1,__:[28]}),c(a,{type:"primary",onClick:k},{default:w(()=>u[29]||(u[29]=[E("保存",-1)])),_:1,__:[29]})]),default:w(()=>[c(x,{class:"dialog-scroll",height:"60vh"},{default:w(()=>[c(se,{model:p.value,"label-width":"140px"},{default:w(()=>[e("div",is,[u[16]||(u[16]=e("div",{class:"section-title"},"基础信息",-1)),c(t,{label:"模版名称",required:""},{default:w(()=>[c(n,{modelValue:p.value.name,"onUpdate:modelValue":u[0]||(u[0]=i=>p.value.name=i),placeholder:"请输入模版名称"},null,8,["modelValue"])]),_:1}),c(t,{label:"描述"},{default:w(()=>[c(n,{modelValue:p.value.description,"onUpdate:modelValue":u[1]||(u[1]=i=>p.value.description=i),placeholder:"简要说明（可选）"},null,8,["modelValue"])]),_:1})]),c(b),e("div",ns,[u[18]||(u[18]=e("div",{class:"section-title"},"绑定与权限",-1)),c(t,{label:"OpenAI 分组"},{default:w(()=>[c(q,{modelValue:p.value.openaiGroupId,"onUpdate:modelValue":u[2]||(u[2]=i=>p.value.openaiGroupId=i),clearable:"",placeholder:"选择 OpenAI 分组"},{default:w(()=>[(r(!0),y(X,null,ie(D(M).openaiGroups||[],i=>(r(),J(g,{key:i.id,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),c(t,{label:"访问权限"},{default:w(()=>[c($,{type:"success"},{default:w(()=>u[17]||(u[17]=[E("OpenAI",-1)])),_:1,__:[17]})]),_:1}),c(t,{label:"启用状态"},{default:w(()=>[c(A,{modelValue:p.value.isActive,"onUpdate:modelValue":u[3]||(u[3]=i=>p.value.isActive=i)},null,8,["modelValue"])]),_:1})]),c(b),e("div",ds,[u[21]||(u[21]=e("div",{class:"section-title"},"限流与配额",-1)),c(t,{label:"每日请求上限 (次)"},{default:w(()=>[c(l,{modelValue:p.value.dailyRequestsLimit,"onUpdate:modelValue":u[4]||(u[4]=i=>p.value.dailyRequestsLimit=i),min:0,step:1},null,8,["modelValue"]),u[19]||(u[19]=e("div",{class:"help"},"0 表示不限",-1))]),_:1,__:[19]}),c(t,{label:"窗口费用上限 ($)"},{default:w(()=>[c(l,{modelValue:p.value.rateLimitCost,"onUpdate:modelValue":u[5]||(u[5]=i=>p.value.rateLimitCost=i),min:0,step:.01},null,8,["modelValue"]),u[20]||(u[20]=e("div",{class:"help"},"限制时间窗口内的总费用（可选）",-1))]),_:1,__:[20]})]),c(b),e("div",us,[u[23]||(u[23]=e("div",{class:"section-title"},"速率限制",-1)),c(C,{class:"rate-card",shadow:"never"},{default:w(()=>[c(t,{label:"时间窗口（分钟）"},{default:w(()=>[c(l,{modelValue:p.value.rateLimitWindow,"onUpdate:modelValue":u[6]||(u[6]=i=>p.value.rateLimitWindow=i),min:0,step:1},null,8,["modelValue"])]),_:1}),c(t,{label:"窗口内请求上限 (次)"},{default:w(()=>[c(l,{modelValue:p.value.rateLimitRequests,"onUpdate:modelValue":u[7]||(u[7]=i=>p.value.rateLimitRequests=i),min:0,step:1},null,8,["modelValue"])]),_:1}),e("div",cs,"预览："+v(_.value),1),u[22]||(u[22]=e("div",{class:"help"},"设置任一为 0 表示不限制速率",-1))]),_:1,__:[22]})]),c(b),e("div",ps,[u[26]||(u[26]=e("div",{class:"section-title"},"过期设置",-1)),c(t,{label:"过期模式"},{default:w(()=>[c(T,{modelValue:p.value.expirationMode,"onUpdate:modelValue":u[8]||(u[8]=i=>p.value.expirationMode=i)},{default:w(()=>[c(N,{label:"activation"},{default:w(()=>u[24]||(u[24]=[E("首次使用后",-1)])),_:1,__:[24]}),c(N,{label:"fixed"},{default:w(()=>u[25]||(u[25]=[E("固定时间",-1)])),_:1,__:[25]})]),_:1},8,["modelValue"])]),_:1}),p.value.expirationMode==="fixed"?(r(),J(t,{key:0,label:"固定过期时间"},{default:w(()=>[c(ee,{modelValue:p.value.expiresAt,"onUpdate:modelValue":u[9]||(u[9]=i=>p.value.expiresAt=i),type:"datetime",placeholder:"选择过期时间","value-format":"YYYY-MM-DDTHH:mm:ss.SSS[Z]"},null,8,["modelValue"])]),_:1})):(r(),J(t,{key:1,label:"有效周期"},{default:w(()=>[e("div",ms,[c(q,{modelValue:p.value.activationUnit,"onUpdate:modelValue":u[10]||(u[10]=i=>p.value.activationUnit=i),style:{"min-width":"120px"}},{default:w(()=>[c(g,{label:"小时",value:"hours"}),c(g,{label:"天",value:"days"}),c(g,{label:"月",value:"months"})]),_:1},8,["modelValue"]),c(l,{width:"140px",modelValue:p.value.activationDays,"onUpdate:modelValue":u[11]||(u[11]=i=>p.value.activationDays=i),min:1,step:1,placeholder:"周期值"},null,8,["modelValue"])])]),_:1}))]),c(b),e("div",gs,[u[27]||(u[27]=e("div",{class:"section-title"},"标签",-1)),c(t,{label:"标签（可选）"},{default:w(()=>[c(q,{modelValue:p.value.tags,"onUpdate:modelValue":u[12]||(u[12]=i=>p.value.tags=i),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"选择或输入标签"},{default:w(()=>[(r(!0),y(X,null,ie(D(R),i=>(r(),J(g,{key:i.value,label:i.label,value:i.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue","title"])}}},fs=xe(ys,[["__scopeId","data-v-9aad54db"]]),bs={__name:"TemplateQuickCreateDialog",props:{show:{type:Boolean,default:!1},templates:{type:Array,default:()=>[]},tagOptions:{type:Array,default:()=>[]},selectedTemplateId:{type:String,default:""}},emits:["close","created"],setup(m,{emit:O}){const o=m,S=O,I=V(!1);ce(()=>o.show,K=>I.value=K,{immediate:!0}),ce(()=>I.value,K=>{K||S("close")});const p=V({templateId:"",name:"",count:1,tags:[]}),M=o.tagOptions;function R(){var k,d;const K=o.selectedTemplateId||((d=(k=o.templates)==null?void 0:k[0])==null?void 0:d.id)||"";p.value={templateId:K,name:"",count:1,tags:[]}}ce(()=>o.show,K=>{K&&R()}),ce(()=>o.selectedTemplateId,K=>{I.value&&K&&K!==p.value.templateId&&(p.value.templateId=K)});async function _(){var K,k;try{if(!p.value.templateId)return W("请选择模版","warning");if(!p.value.name)return W("请输入名称/前缀","warning");const d=await oe.post("/admin/api-keys/from-template",p.value);d.success&&(W("创建成功","success"),S("created",Array.isArray(d.data)?d.data:[d.data]),I.value=!1)}catch(d){W(((k=(K=d.response)==null?void 0:K.data)==null?void 0:k.error)||"创建失败","error")}}return(K,k)=>{const d=Kt,u=Lt,n=St,t=rt,b=Ft,g=Vt,q=dt,$=$e,A=Ye;return r(),J(A,{modelValue:I.value,"onUpdate:modelValue":k[5]||(k[5]=l=>I.value=l),title:"通过模版快速创建",width:"520px","append-to-body":"",onClosed:k[6]||(k[6]=l=>K.$emit("close"))},{footer:w(()=>[c($,{onClick:k[4]||(k[4]=l=>I.value=!1)},{default:w(()=>k[7]||(k[7]=[E("取消",-1)])),_:1,__:[7]}),c($,{type:"primary",onClick:_},{default:w(()=>k[8]||(k[8]=[E("创建",-1)])),_:1,__:[8]})]),default:w(()=>[c(q,{class:"dialog-scroll",height:"60vh"},{default:w(()=>[c(g,{model:p.value,"label-width":"90px"},{default:w(()=>[c(n,{label:"模版"},{default:w(()=>[c(u,{modelValue:p.value.templateId,"onUpdate:modelValue":k[0]||(k[0]=l=>p.value.templateId=l),placeholder:"选择模版"},{default:w(()=>[(r(!0),y(X,null,ie(m.templates,l=>(r(),J(d,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),c(n,{label:"名称/前缀",required:""},{default:w(()=>[c(t,{modelValue:p.value.name,"onUpdate:modelValue":k[1]||(k[1]=l=>p.value.name=l),placeholder:"例如：我的Key 或 批量前缀"},null,8,["modelValue"])]),_:1}),c(n,{label:"数量"},{default:w(()=>[c(b,{modelValue:p.value.count,"onUpdate:modelValue":k[2]||(k[2]=l=>p.value.count=l),min:1,max:500,step:1},null,8,["modelValue"])]),_:1}),c(n,{label:"标签"},{default:w(()=>[c(u,{modelValue:p.value.tags,"onUpdate:modelValue":k[3]||(k[3]=l=>p.value.tags=l),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"选择或输入标签"},{default:w(()=>[(r(!0),y(X,null,ie(D(M),l=>(r(),J(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])}}},xs=xe(bs,[["__scopeId","data-v-58dd019b"]]),vs={class:"mb-3 text-sm text-gray-600"},ks={__name:"TemplateCreateResultDialog",props:{show:{type:Boolean,default:!1},items:{type:Array,default:()=>[]},accounts:{type:Object,required:!0}},emits:["close"],setup(m,{emit:O}){const o=m,S=O,I=V(!1);ce(()=>o.show,K=>I.value=K,{immediate:!0}),ce(()=>I.value,K=>{K||S("close")});function p(K){var u;const k=(u=K.openaiAccountId)!=null&&u.startsWith("group:")?K.openaiAccountId.slice(6):"";if(!k)return"共享池";const d=(o.accounts.openaiGroups||[]).find(n=>n.id===k);return d?d.name:`分组:${k.slice(0,8)}`}function M(K){const k=Number(K.rateLimitRequests||0),d=Number(K.rateLimitWindow||0);return k>0&&d>0?`${k}次/${d}min`:"不限"}function R(K){if(K.expirationMode==="activation"){const k=Number(K.activationDays||0),d=K.activationUnit||"days";return d==="months"?`${k}个月（首次使用后）`:d==="hours"?`${k}小时（首次使用后）`:`${k}天（首次使用后）`}return K.expiresAt?new Date(K.expiresAt).toLocaleString("zh-CN"):"未设置"}function _(){try{const K=(o.items||[]).map(u=>({"API Key名称":u.name||"",使用的分组:p(u),APIKEY:u.apiKey||"",速率:M(u),每日请求上限:Number(u.dailyRequestsLimit||0)||"不限",过期:R(u)})),k=lt.utils.json_to_sheet(K),d=lt.utils.book_new();lt.utils.book_append_sheet(d,k,"创建结果"),lt.writeFile(d,"api-keys-模板创建结果.xlsx")}catch{}}return(K,k)=>{const d=Ne,u=He,n=dt,t=$e,b=Ye;return r(),J(b,{modelValue:I.value,"onUpdate:modelValue":k[1]||(k[1]=g=>I.value=g),title:"创建结果",width:"900px","append-to-body":"",onClosed:k[2]||(k[2]=g=>K.$emit("close"))},{footer:w(()=>[c(t,{onClick:k[0]||(k[0]=g=>I.value=!1)},{default:w(()=>k[3]||(k[3]=[E("关闭",-1)])),_:1,__:[3]}),c(t,{type:"primary",onClick:_},{default:w(()=>k[4]||(k[4]=[E("导出表格",-1)])),_:1,__:[4]})]),default:w(()=>[c(n,{class:"dialog-scroll",height:"60vh"},{default:w(()=>[e("div",vs,"成功创建 "+v(m.items.length)+" 个 API Key",1),c(u,{data:m.items,border:"",style:{width:"100%"}},{default:w(()=>[c(d,{label:"API Key名称","min-width":"160",prop:"name"}),c(d,{label:"使用的分组","min-width":"160"},{default:w(({row:g})=>[E(v(p(g)),1)]),_:1}),c(d,{label:"API KEY","min-width":"240",prop:"apiKey"}),c(d,{label:"速率",width:"160"},{default:w(({row:g})=>[E(v(M(g)),1)]),_:1}),c(d,{label:"每日请求上限",width:"160"},{default:w(({row:g})=>[E(v(Number(g.dailyRequestsLimit||0)||"不限"),1)]),_:1}),c(d,{label:"过期周期/时间","min-width":"200"},{default:w(({row:g})=>[E(v(R(g)),1)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["modelValue"])}}},ws=xe(ks,[["__scopeId","data-v-d6f81e91"]]),As={__name:"PackagesManagerModal",props:{show:{type:Boolean,default:!1},accounts:{type:Object,required:!0},tagOptions:{type:Array,default:()=>[]}},emits:["close","created"],setup(m,{emit:O}){const o=m,S=O,I=V(!1);ce(()=>o.show,N=>I.value=N,{immediate:!0}),ce(()=>I.value,N=>{N===!1&&S("close")});const p=V([]),M=V(!1),R=V(!1),_=V(null),K=V(!1),k=V(!1),d=V([]),u=V(""),n=o.accounts;async function t(){M.value=!0;try{const N=await oe.get("/admin/api-key-templates");N.success&&(p.value=N.data||[])}catch{W("加载模版失败","error")}finally{M.value=!1}}function b(){_.value=null,R.value=!0}function g(N){_.value=N,R.value=!0}function q(){R.value=!1,t()}async function $(N){try{await oe.delete(`/admin/api-key-templates/${N.id}`),W("已删除模版","success"),await t()}catch{W("删除失败","error")}}function A(N){u.value=(N==null?void 0:N.id)||"",K.value=!0}function l(N){d.value=N||[],k.value=!0,t(),S("created")}function C(){S("close")}return Ue(()=>{o.show&&(I.value=!0),t()}),(N,T)=>{const ee=dt,se=$e,x=Ye;return r(),y(X,null,[c(x,{modelValue:I.value,"onUpdate:modelValue":T[0]||(T[0]=a=>I.value=a),title:"API Key 模版",width:"860px","append-to-body":""},{default:w(()=>[c(ee,{class:"dialog-scroll",height:"60vh"},{default:w(()=>[c(rs,{templates:p.value,loading:M.value,onCreate:b,onEdit:g,onDelete:$,onQuickCreate:A},null,8,["templates","loading"])]),_:1})]),footer:w(()=>[c(se,{onClick:C},{default:w(()=>T[4]||(T[4]=[E("关闭",-1)])),_:1,__:[4]})]),_:1},8,["modelValue"]),c(fs,{show:R.value,template:_.value,accounts:D(n),"tag-options":m.tagOptions,onClose:T[1]||(T[1]=a=>R.value=!1),onSaved:q},null,8,["show","template","accounts","tag-options"]),c(xs,{show:K.value,templates:p.value,"tag-options":m.tagOptions,"selected-template-id":u.value,onClose:T[2]||(T[2]=a=>K.value=!1),onCreated:l},null,8,["show","templates","tag-options","selected-template-id"]),c(ws,{show:k.value,items:d.value,accounts:D(n),onClose:T[3]||(T[3]=a=>k.value=!1)},null,8,["show","items","accounts"])],64)}}},$s=xe(As,[["__scopeId","data-v-a3ada8e0"]]),hs={class:"space-y-3"},Cs={class:"text-right"},Is={class:"text-xs text-gray-500"},Ks={class:"text-xs text-gray-400"},Ls={key:0,class:"flex items-center gap-2"},Ds={class:"flex-1 truncate rounded bg-gray-50 p-1.5 text-xs font-mono dark:bg-gray-900"},_s={key:1,class:"flex items-center gap-2 text-xs text-gray-400"},Vs={__name:"EmailKeySearchDialog",props:{show:{type:Boolean,default:!1}},emits:["close"],setup(m,{emit:O}){const o=m,S=O,I=V(!1);ce(()=>o.show,b=>I.value=b,{immediate:!0}),ce(()=>I.value,b=>{b||S("close")});const p=V(),M=V({email:""}),R={email:[{validator:(b,g,q)=>{const $=String(g||"").trim();if(!$)return q(new Error("请输入邮箱"));if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($))return q(new Error("请输入有效邮箱"));q()},trigger:["blur","change"]}]},_=V([]),K=V(!1),k=V(!1);function d(b){if(!b)return"";try{return new Date(b).toLocaleString("zh-CN")}catch{return b}}async function u(){var b,g;try{if(!await((g=(b=p.value)==null?void 0:b.validate)==null?void 0:g.call(b)))return;K.value=!0,_.value=[];const $=await oe.get("/admin/orders/search",{params:{email:M.value.email.trim()}});$!=null&&$.success?(_.value=Array.isArray($.data)?$.data:[],k.value=!0):W(($==null?void 0:$.message)||"查询失败","error")}catch(q){W(q.message||"查询失败","error")}finally{K.value=!1}}function n(){I.value=!1}function t(b){try{navigator.clipboard.writeText(b),W("已复制到剪贴板","success")}catch{W("复制失败，请手动复制","error")}}return(b,g)=>{const q=rt,$=St,A=Vt,l=$e,C=zt,N=Ne,T=nt,ee=He,se=Ye;return r(),J(se,{modelValue:I.value,"onUpdate:modelValue":g[1]||(g[1]=x=>I.value=x),title:"按邮箱查询 API Key",width:"700px","append-to-body":"",onClosed:g[2]||(g[2]=x=>b.$emit("close"))},{default:w(()=>[e("div",hs,[c(A,{model:M.value,rules:R,ref_key:"formRef",ref:p,"label-width":"100px"},{default:w(()=>[c($,{label:"邮箱",prop:"email"},{default:w(()=>[c(q,{modelValue:M.value.email,"onUpdate:modelValue":g[0]||(g[0]=x=>M.value.email=x),placeholder:"请输入订购者邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),e("div",Cs,[c(l,{onClick:n},{default:w(()=>g[3]||(g[3]=[E("取消",-1)])),_:1,__:[3]}),c(l,{type:"primary",loading:K.value,onClick:u},{default:w(()=>g[4]||(g[4]=[E("查询",-1)])),_:1,__:[4]},8,["loading"])]),!K.value&&_.value.length===0&&k.value?(r(),J(C,{key:0,description:"未找到相关记录"})):F("",!0),_.value.length?(r(),J(ee,{key:1,data:_.value,border:"",height:"400px"},{default:w(()=>[c(N,{label:"订单","min-width":"180"},{default:w(({row:x})=>[e("div",Is,v(x.order.id),1),e("div",Ks,v(d(x.order.updatedAt)),1)]),_:1}),c(N,{label:"状态",width:"100"},{default:w(({row:x})=>[c(T,{type:x.order.status==="OD"?"success":"info"},{default:w(()=>[E(v(x.order.status||"INIT"),1)]),_:2},1032,["type"])]),_:1}),c(N,{label:"套餐",width:"120",prop:"order.planId"}),c(N,{label:"API Key","min-width":"260"},{default:w(({row:x})=>[x.order.apiKeyPlain?(r(),y("div",Ls,[e("code",Ds,v(x.order.apiKeyPlain),1),c(l,{size:"small",onClick:a=>t(x.order.apiKeyPlain)},{default:w(()=>g[5]||(g[5]=[E("复制",-1)])),_:2,__:[5]},1032,["onClick"]),x.apiKey&&x.apiKey.isDeleted?(r(),J(T,{key:0,type:"danger",effect:"plain"},{default:w(()=>g[6]||(g[6]=[E("已删除",-1)])),_:1,__:[6]})):F("",!0)])):(r(),y("div",_s,[g[8]||(g[8]=e("span",null,"未出卡或已过期",-1)),x.apiKey&&x.apiKey.isDeleted?(r(),J(T,{key:0,type:"danger",effect:"plain"},{default:w(()=>g[7]||(g[7]=[E("已删除",-1)])),_:1,__:[7]})):F("",!0)]))]),_:1})]),_:1},8,["data"])):F("",!0)])]),_:1},8,["modelValue"])}}},Ht=Nt("clients",{state:()=>({supportedClients:[],loading:!1,error:null}),actions:{async loadSupportedClients(){if(this.supportedClients.length>0)return this.supportedClients;this.loading=!0,this.error=null;try{const m=await oe.get("/admin/supported-clients");return m.success?this.supportedClients=m.data||[]:(this.error=m.message||"加载支持的客户端失败",console.error("Failed to load supported clients:",this.error)),this.supportedClients}catch(m){return this.error=m.message||"加载支持的客户端失败",console.error("Error loading supported clients:",m),[]}finally{this.loading=!1}}}}),Yt=Nt("apiKeys",()=>{const m=V([]),O=V(!1),o=V(null),S=V("all"),I=V(""),p=V("asc"),M=async()=>{O.value=!0,o.value=null;try{const g=await oe.get("/admin/api-keys");if(g.success)m.value=g.data||[];else throw new Error(g.message||"获取API Keys失败")}catch(g){throw o.value=g.message,g}finally{O.value=!1}};return{apiKeys:m,loading:O,error:o,statsTimeRange:S,sortBy:I,sortOrder:p,fetchApiKeys:M,createApiKey:async g=>{O.value=!0,o.value=null;try{const q=await oe.post("/admin/api-keys",g);if(q.success)return await M(),q.data;throw new Error(q.message||"创建API Key失败")}catch(q){throw o.value=q.message,q}finally{O.value=!1}},updateApiKey:async(g,q)=>{O.value=!0,o.value=null;try{const $=await oe.put(`/admin/api-keys/${g}`,q);if($.success)return await M(),$;throw new Error($.message||"更新API Key失败")}catch($){throw o.value=$.message,$}finally{O.value=!1}},toggleApiKey:async g=>{O.value=!0,o.value=null;try{const q=await oe.put(`/admin/api-keys/${g}/toggle`);if(q.success)return await M(),q;throw new Error(q.message||"切换状态失败")}catch(q){throw o.value=q.message,q}finally{O.value=!1}},renewApiKey:async(g,q)=>{O.value=!0,o.value=null;try{const $=await oe.put(`/admin/api-keys/${g}`,q);if($.success)return await M(),$;throw new Error($.message||"续期失败")}catch($){throw o.value=$.message,$}finally{O.value=!1}},deleteApiKey:async g=>{O.value=!0,o.value=null;try{const q=await oe.delete(`/admin/api-keys/${g}`);if(q.success)return await M(),q;throw new Error(q.message||"删除失败")}catch(q){throw o.value=q.message,q}finally{O.value=!1}},fetchApiKeyStats:async(g,q="all")=>{try{const $=await oe.get(`/admin/api-keys/${g}/stats`,{params:{timeRange:q}});if($.success)return $.stats;throw new Error($.message||"获取统计失败")}catch($){return console.error("获取API Key统计失败:",$),null}},fetchTags:async()=>{try{const g=await oe.get("/admin/api-keys/tags");if(g.success)return g.data||[];throw new Error(g.message||"获取标签失败")}catch(g){return console.error("获取标签失败:",g),[]}},sortApiKeys:g=>{I.value===g?p.value=p.value==="asc"?"desc":"asc":(I.value=g,p.value="asc")},reset:()=>{m.value=[],O.value=!1,o.value=null,S.value="all",I.value="",p.value="asc"}}}),Ss={class:"flex-shrink-0 border-b border-gray-200 p-3 dark:border-gray-600"},Ms={class:"relative"},Rs={class:"custom-scrollbar flex-1 overflow-y-auto"},Es={class:"text-gray-700 dark:text-gray-300"},Ts={key:0},Us=["onClick"],Ps={class:"flex items-center justify-between"},Os={class:"text-gray-700 dark:text-gray-300"},Gs={class:"text-xs text-gray-500 dark:text-gray-400"},qs={key:1},js={class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500 dark:bg-gray-700 dark:text-gray-400"},Bs=["onClick"],zs={class:"flex items-center justify-between"},Fs={class:"text-gray-700 dark:text-gray-300"},Ws={class:"text-xs text-gray-400 dark:text-gray-500"},Ns={key:2},Hs=["onClick"],Ys={class:"flex items-center justify-between"},Qs={class:"text-gray-700 dark:text-gray-300"},Js={class:"text-xs text-gray-400 dark:text-gray-500"},Zs={key:3},Xs=["onClick"],eo={class:"flex items-center justify-between"},to={class:"text-gray-700 dark:text-gray-300"},ao={class:"text-xs text-gray-400 dark:text-gray-500"},so={key:4,class:"px-4 py-8 text-center text-gray-500 dark:text-gray-400"},oo={__name:"AccountSelector",props:{modelValue:{type:String,default:""},platform:{type:String,required:!0,validator:m=>["claude","gemini","openai","bedrock","droid"].includes(m)},accounts:{type:Array,default:()=>[]},groups:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择账号"},defaultOptionText:{type:String,default:"使用共享账号池"}},emits:["update:modelValue"],setup(m,{emit:O}){const o=m,S=O,I=V(!1),p=V(""),M=V(null),R=V(null),_=V({}),K=V(null),k=V(""),d=Q(()=>{if(!o.modelValue)return o.defaultOptionText;if(o.modelValue.startsWith("group:")){const L=o.modelValue.substring(6),i=o.groups.find(Z=>Z.id===L);return i?`${i.name} (${i.memberCount||0} 个成员)`:""}if(o.modelValue.startsWith("console:")){const L=o.modelValue.substring(8),i=o.accounts.find(Z=>Z.id===L&&Z.platform==="claude-console");return i?`${i.name} (${u(i)})`:""}if(o.modelValue.startsWith("responses:")){const L=o.modelValue.substring(10),i=o.accounts.find(Z=>Z.id===L&&Z.platform==="openai-responses");return i?`${i.name} (${u(i)})`:""}const a=o.accounts.find(L=>L.id===o.modelValue);return a?`${a.name} (${u(a)})`:""}),u=a=>{if(!a)return"未知";if(!(a.isActive==="true"||a.isActive===!0))switch(a.status){case"unauthorized":return"未授权";case"error":return"Token错误";case"created":return"待验证";case"rate_limited":return"限流中";case"quota_exceeded":return"额度超限";default:return"异常"}return a.status==="rate_limited"?"限流中":"正常"},n=Q(()=>[...o.accounts].sort((a,L)=>{const i=new Date(a.createdAt||0);return new Date(L.createdAt||0)-i})),t=Q(()=>{let a=o.groups.filter(L=>L.platform?L.platform===o.platform:!0);if(p.value){const L=p.value.toLowerCase();a=a.filter(i=>i.name.toLowerCase().includes(L))}return a}),b=Q(()=>{let a=[];if(o.platform==="claude"?a=n.value.filter(L=>L.platform==="claude-oauth"):o.platform==="openai"?a=n.value.filter(L=>L.platform==="openai"):o.platform==="droid"?a=n.value.filter(L=>L.platform==="droid"):a=n.value.filter(L=>!["claude-oauth","claude-console","openai-responses"].includes(L.platform)),p.value){const L=p.value.toLowerCase();a=a.filter(i=>i.name.toLowerCase().includes(L))}return a}),g=Q(()=>{if(o.platform!=="claude")return[];let a=n.value.filter(L=>L.platform==="claude-console");if(p.value){const L=p.value.toLowerCase();a=a.filter(i=>i.name.toLowerCase().includes(L))}return a}),q=Q(()=>{if(o.platform!=="openai")return[];let a=n.value.filter(L=>L.platform==="openai-responses");if(p.value){const L=p.value.toLowerCase();a=a.filter(i=>i.name.toLowerCase().includes(L))}return a}),$=Q(()=>t.value.length>0||b.value.length>0||g.value.length>0||q.value.length>0),A=a=>{if(!a)return"";const L=new Date(a),Z=(new Date-L)/(1e3*60*60);return Z<24?"今天创建":Z<48?"昨天创建":Z<168?`${Math.floor(Z/24)} 天前`:L.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})},l=()=>{if(!I.value||!R.value||!K.value)return;const a=K.value;if(!a)return;const L=a.getBoundingClientRect(),i=window.innerHeight,Z=window.innerWidth,U=i-L.bottom,s=L.top,f=8,te=U-f,me=s-f;let ae=!1,ye=te;k.value==="above"&&me>=150?(ae=!0,ye=me):k.value==="below"&&te>=150?(ae=!1,ye=te):me>te&&te<200&&(ae=!0,ye=me),k.value=ae?"above":"below";let ge=L.left;const H=L.width;ge+H>Z-f&&(ge=Z-H-f),ge<f&&(ge=f),_.value={position:"fixed",left:`${ge}px`,width:`${L.width}px`,maxHeight:`${Math.min(ye,400)}px`,...ae?{bottom:`${i-L.top}px`}:{top:`${L.bottom}px`}}},C=()=>{if(!I.value&&K.value){const a=K.value.getBoundingClientRect(),i=window.innerHeight-a.bottom,Z=8;_.value={position:"fixed",left:`${a.left}px`,width:`${a.width}px`,maxHeight:`${Math.min(i-Z,400)}px`,top:`${a.bottom}px`}}I.value=!I.value,I.value&&xa(()=>{var a;l(),(a=M.value)==null||a.focus()})},N=a=>{S("update:modelValue",a||""),I.value=!1,p.value=""},T=()=>{},ee=()=>{var a;p.value="",(a=M.value)==null||a.focus()},se=a=>{var L,i;!((L=K.value)!=null&&L.contains(a.target))&&!((i=R.value)!=null&&i.contains(a.target))&&(I.value=!1)},x=()=>{I.value&&l()};return Ue(()=>{document.addEventListener("click",se),window.addEventListener("scroll",x,!0),window.addEventListener("resize",l)}),fa(()=>{document.removeEventListener("click",se),window.removeEventListener("scroll",x,!0),window.removeEventListener("resize",l)}),ce(I,a=>{a||(p.value="",k.value="")}),(a,L)=>(r(),y("div",{ref_key:"triggerRef",ref:K,class:"relative"},[e("div",{class:ne(["form-input flex w-full cursor-pointer items-center justify-between border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",{"opacity-50":m.disabled}]),onClick:L[0]||(L[0]=i=>!m.disabled&&C())},[e("span",{class:ne(m.modelValue?"text-gray-900 dark:text-gray-200":"text-gray-500 dark:text-gray-400")},v(d.value),3),e("i",{class:ne(["fas fa-chevron-down text-gray-400 transition-transform duration-200 dark:text-gray-500",{"rotate-180":I.value}])},null,2)],2),(r(),J(he,{to:"body"},[c(ba,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:w(()=>[I.value?(r(),y("div",{key:0,ref_key:"dropdownRef",ref:R,class:"absolute z-50 flex flex-col rounded-lg border border-gray-200 bg-white shadow-lg dark:border-gray-600 dark:bg-gray-800",style:It(_.value)},[e("div",Ss,[e("div",Ms,[B(e("input",{ref_key:"searchInput",ref:M,"onUpdate:modelValue":L[1]||(L[1]=i=>p.value=i),class:"form-input w-full border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"搜索账号名称...",style:{"padding-left":"40px","padding-right":"36px"},type:"text",onInput:T},null,544),[[le,p.value]]),L[4]||(L[4]=e("i",{class:"fas fa-search pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-sm text-gray-400 dark:text-gray-500"},null,-1)),p.value?(r(),y("button",{key:0,class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-400",type:"button",onClick:ee},L[3]||(L[3]=[e("i",{class:"fas fa-times text-sm"},null,-1)]))):F("",!0)])]),e("div",Rs,[e("div",{class:ne(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":!m.modelValue}]),onClick:L[2]||(L[2]=i=>N(null))},[e("span",Es,v(m.defaultOptionText),1)],2),t.value.length>0?(r(),y("div",Ts,[L[5]||(L[5]=e("div",{class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500 dark:bg-gray-700 dark:text-gray-400"}," 调度分组 ",-1)),(r(!0),y(X,null,ie(t.value,i=>(r(),y("div",{key:`group:${i.id}`,class:ne(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":m.modelValue===`group:${i.id}`}]),onClick:Z=>N(`group:${i.id}`)},[e("div",Ps,[e("span",Os,v(i.name),1),e("span",Gs,v(i.memberCount||0)+" 个成员",1)])],10,Us))),128))])):F("",!0),b.value.length>0?(r(),y("div",qs,[e("div",js,v(m.platform==="claude"?"Claude OAuth 专属账号":m.platform==="openai"?"OpenAI 专属账号":m.platform==="droid"?"Droid 专属账号":"OAuth 专属账号"),1),(r(!0),y(X,null,ie(b.value,i=>(r(),y("div",{key:i.id,class:ne(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":m.modelValue===i.id}]),onClick:Z=>N(i.id)},[e("div",zs,[e("div",null,[e("span",Fs,v(i.name),1),e("span",{class:ne(["ml-2 rounded-full px-2 py-0.5 text-xs",i.isActive?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":i.status==="unauthorized"?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"])},v(u(i)),3)]),e("span",Ws,v(A(i.createdAt)),1)])],10,Bs))),128))])):F("",!0),m.platform==="claude"&&g.value.length>0?(r(),y("div",Ns,[L[6]||(L[6]=e("div",{class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500 dark:bg-gray-700 dark:text-gray-400"}," Claude Console 专属账号 ",-1)),(r(!0),y(X,null,ie(g.value,i=>(r(),y("div",{key:i.id,class:ne(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":m.modelValue===`console:${i.id}`}]),onClick:Z=>N(`console:${i.id}`)},[e("div",Ys,[e("div",null,[e("span",Qs,v(i.name),1),e("span",{class:ne(["ml-2 rounded-full px-2 py-0.5 text-xs",i.isActive?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":i.status==="unauthorized"?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"])},v(u(i)),3)]),e("span",Js,v(A(i.createdAt)),1)])],10,Hs))),128))])):F("",!0),m.platform==="openai"&&q.value.length>0?(r(),y("div",Zs,[L[7]||(L[7]=e("div",{class:"bg-gray-50 px-4 py-2 text-xs font-semibold text-gray-500 dark:bg-gray-700 dark:text-gray-400"}," OpenAI-Responses 专属账号 ",-1)),(r(!0),y(X,null,ie(q.value,i=>(r(),y("div",{key:i.id,class:ne(["cursor-pointer px-4 py-2 transition-colors hover:bg-gray-50 dark:hover:bg-gray-700",{"bg-blue-50 dark:bg-blue-900/20":m.modelValue===`responses:${i.id}`}]),onClick:Z=>N(`responses:${i.id}`)},[e("div",eo,[e("div",null,[e("span",to,v(i.name),1),e("span",{class:ne(["ml-2 rounded-full px-2 py-0.5 text-xs",i.isActive==="true"||i.isActive===!0?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":i.status==="rate_limited"?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"])},v(u(i)),3)]),e("span",ao,v(A(i.createdAt)),1)])],10,Xs))),128))])):F("",!0),p.value&&!$.value?(r(),y("div",so,L[8]||(L[8]=[e("i",{class:"fas fa-search mb-2 text-2xl"},null,-1),e("p",{class:"text-sm"},"没有找到匹配的账号",-1)]))):F("",!0)])],4)):F("",!0)]),_:1})]))],512))}},ke=xe(oo,[["__scopeId","data-v-442d3713"]]),lo={class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},ro={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-4xl flex-col p-4 sm:p-6"},io={class:"mb-4 flex items-center justify-between"},no={class:"rounded-lg border border-blue-200 bg-gradient-to-r from-blue-50 to-indigo-50 p-3 dark:border-blue-700 dark:from-blue-900/20 dark:to-indigo-900/20 sm:p-4"},uo={class:"flex items-center gap-3 sm:gap-4"},co={class:"flex cursor-pointer items-center"},po={class:"flex cursor-pointer items-center"},mo={key:0,class:"mt-3"},go={class:"flex items-center gap-4"},yo={class:"flex-1"},fo={class:"flex items-center gap-2"},bo={class:"mt-2 flex items-start text-xs text-amber-600 dark:text-amber-400"},xo=["placeholder"],vo={key:0,class:"mt-1 text-xs text-red-500 dark:text-red-400"},ko={class:"space-y-4"},wo={key:0},Ao={class:"flex flex-wrap gap-2"},$o=["onClick"],ho={key:1},Co={class:"flex flex-wrap gap-2"},Io=["onClick"],Ko={class:"flex gap-2"},Lo=["onKeypress"],Do={class:"rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-700 dark:bg-blue-900/20"},_o={class:"space-y-2"},Vo={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},So={class:"space-y-2"},Mo={class:"flex gap-2"},Ro={class:"space-y-2"},Eo={class:"flex gap-2"},To={class:"space-y-2"},Uo={class:"flex gap-2"},Po={class:"mb-3 rounded-lg border border-gray-200 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-800"},Oo={class:"flex items-center gap-4"},Go={class:"flex cursor-pointer items-center"},qo={class:"flex cursor-pointer items-center"},jo={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Bo={key:0},zo={key:1},Fo={key:0},Wo={key:0,class:"mt-3"},No=["min"],Ho={key:1,class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Yo={key:1},Qo={class:"flex items-center gap-2"},Jo=["max","placeholder"],Zo={class:"mt-2 flex flex-wrap gap-2"},Xo=["onClick"],el={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},tl={class:"flex gap-4"},al={class:"flex cursor-pointer items-center"},sl={class:"flex cursor-pointer items-center"},ol={class:"flex cursor-pointer items-center"},ll={class:"flex cursor-pointer items-center"},rl={class:"flex cursor-pointer items-center"},il={class:"mb-2 flex items-center justify-between"},nl=["disabled"],dl={class:"grid grid-cols-1 gap-3"},ul={class:"mb-2 flex items-center"},cl={key:0,class:"space-y-3"},pl={class:"mb-3 flex min-h-[32px] flex-wrap gap-2 rounded-lg border border-gray-200 bg-gray-50 p-2"},ml=["onClick"],gl={key:0,class:"text-sm text-gray-400"},yl={class:"space-y-3"},fl={class:"flex flex-wrap gap-2"},bl=["onClick"],xl={key:0,class:"text-sm italic text-gray-400"},vl={class:"flex gap-2"},kl=["onKeydown"],wl={class:"mb-2 flex items-center"},Al={key:0,class:"rounded-lg border border-green-200 bg-green-50 p-3 dark:border-green-700 dark:bg-green-900/20"},$l={class:"space-y-1"},hl=["id","value"],Cl=["for"],Il={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},Kl={class:"block text-xs text-gray-500 dark:text-gray-400"},Ll={class:"flex gap-3 pt-2"},Dl=["disabled"],_l={key:0,class:"loading-spinner mr-2"},Vl={key:1,class:"fas fa-plus mr-2"},Sl={__name:"CreateApiKeyModal",props:{accounts:{type:Object,default:()=>({claude:[],gemini:[],openai:[],bedrock:[],droid:[],claudeGroups:[],geminiGroups:[],openaiGroups:[],droidGroups:[]})}},emits:["close","success","batch-success"],setup(m,{emit:O}){const o=m,S=O,I=Ht(),p=Yt(),M=V(!1),R=V(!1),_=V({claude:[],gemini:[],openai:[],bedrock:[],droid:[],claudeGroups:[],geminiGroups:[],openaiGroups:[],droidGroups:[]}),K=V({name:""}),k=V(""),d=V([]),u=Q(()=>d.value.filter(U=>!t.tags.includes(U))),n=V([]),t=Pe({createType:"single",batchCount:10,name:"",description:"",rateLimitWindow:"",rateLimitRequests:"",rateLimitCost:"",concurrencyLimit:"",dailyCostLimit:"",totalCostLimit:"",weeklyOpusCostLimit:"",expireDuration:"",customExpireDate:"",expiresAt:null,expirationMode:"fixed",activationDays:30,activationUnit:"days",permissions:"all",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",droidAccountId:"",enableModelRestriction:!1,restrictedModels:[],modelInput:"",enableClientRestriction:!1,allowedClients:[],tags:[]});Ue(async()=>{var s,f,te,me,ae,ye,ge,H,fe,ve;if(n.value=await I.loadSupportedClients(),d.value=await p.fetchTags(),o.accounts){const re=[];o.accounts.openai&&o.accounts.openai.forEach(be=>{re.push({...be,platform:"openai"})}),o.accounts.openaiResponses&&o.accounts.openaiResponses.forEach(be=>{re.push({...be,platform:"openai-responses"})}),_.value={claude:o.accounts.claude||[],gemini:o.accounts.gemini||[],openai:re,bedrock:o.accounts.bedrock||[],droid:(o.accounts.droid||[]).map(be=>({...be,platform:"droid"})),claudeGroups:o.accounts.claudeGroups||[],geminiGroups:o.accounts.geminiGroups||[],openaiGroups:o.accounts.openaiGroups||[],droidGroups:o.accounts.droidGroups||[]}}(((f=(s=_.value)==null?void 0:s.claude)==null?void 0:f.length)||0)+(((me=(te=_.value)==null?void 0:te.gemini)==null?void 0:me.length)||0)+(((ye=(ae=_.value)==null?void 0:ae.openai)==null?void 0:ye.length)||0)+(((H=(ge=_.value)==null?void 0:ge.bedrock)==null?void 0:H.length)||0)+(((ve=(fe=_.value)==null?void 0:fe.droid)==null?void 0:ve.length)||0)||await b()});const b=async()=>{var U,s,f,te,me,ae,ye,ge;R.value=!0;try{const H=await oe.get("/admin/accounts/aggregated",{params:{fields:"summary",compact:"true"}});if(!(H!=null&&H.success))throw new Error("failed");const fe=[];(U=H.data)!=null&&U.claudeAccounts&&H.data.claudeAccounts.forEach(re=>{fe.push({...re,platform:"claude-oauth",isDedicated:re.accountType==="dedicated"})}),(s=H.data)!=null&&s.claudeConsoleAccounts&&H.data.claudeConsoleAccounts.forEach(re=>{fe.push({...re,platform:"claude-console",isDedicated:re.accountType==="dedicated"})}),_.value.claude=fe,(f=H.data)!=null&&f.geminiAccounts&&(_.value.gemini=(H.data.geminiAccounts||[]).map(re=>({...re,isDedicated:re.accountType==="dedicated"})));const ve=[];if((te=H.data)!=null&&te.openaiAccounts&&(H.data.openaiAccounts||[]).forEach(re=>{ve.push({...re,platform:"openai",isDedicated:re.accountType==="dedicated"})}),(me=H.data)!=null&&me.openaiResponsesAccounts&&(H.data.openaiResponsesAccounts||[]).forEach(re=>{ve.push({...re,platform:"openai-responses",isDedicated:re.accountType==="dedicated"})}),_.value.openai=ve,(ae=H.data)!=null&&ae.bedrockAccounts&&(_.value.bedrock=(H.data.bedrockAccounts||[]).map(re=>({...re,isDedicated:re.accountType==="dedicated"}))),(ye=H.data)!=null&&ye.droidAccounts&&(_.value.droid=(H.data.droidAccounts||[]).map(re=>({...re,platform:"droid",isDedicated:re.accountType==="dedicated"}))),(ge=H.data)!=null&&ge.accountGroups){const re=H.data.accountGroups||[];_.value.claudeGroups=re.filter(be=>be.platform==="claude"),_.value.geminiGroups=re.filter(be=>be.platform==="gemini"),_.value.openaiGroups=re.filter(be=>be.platform==="openai"),_.value.droidGroups=re.filter(be=>be.platform==="droid")}W("账号列表已刷新","success")}catch{W("刷新账号列表失败","error")}finally{R.value=!1}},g=Q(()=>{const U=new Date;return U.setMinutes(U.getMinutes()+1),U.toISOString().slice(0,16)}),q=()=>{if(!t.expireDuration){t.expiresAt=null;return}if(t.expireDuration==="custom")return;const U=new Date,f=t.expireDuration.match(/(\d+)([dhmy])/);if(f){const[,te,me]=f,ae=parseInt(te);switch(me){case"d":U.setDate(U.getDate()+ae);break;case"h":U.setHours(U.getHours()+ae);break;case"m":U.setMonth(U.getMonth()+ae);break;case"y":U.setFullYear(U.getFullYear()+ae);break}t.expiresAt=U.toISOString()}},$=()=>{t.customExpireDate&&(t.expiresAt=new Date(t.customExpireDate).toISOString())},A=U=>new Date(U).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),l=()=>{t.modelInput&&!t.restrictedModels.includes(t.modelInput)&&(t.restrictedModels.push(t.modelInput),t.modelInput="")},C=U=>{t.restrictedModels.splice(U,1)},N=V(["claude-opus-4-20250514","claude-opus-4-1-20250805"]),T=Q(()=>N.value.filter(U=>!t.restrictedModels.includes(U))),ee=U=>{t.restrictedModels.includes(U)||t.restrictedModels.push(U)},se=()=>{if(k.value&&k.value.trim()){const U=k.value.trim();t.tags.includes(U)||t.tags.push(U),k.value=""}},x=U=>{t.tags.includes(U)||t.tags.push(U)},a=U=>{t.tags.splice(U,1)},L=()=>t.activationUnit==="hours"?[{value:1,label:"1小时"},{value:3,label:"3小时"},{value:6,label:"6小时"},{value:12,label:"12小时"}]:[{value:30,label:"30天"},{value:90,label:"90天"},{value:180,label:"180天"},{value:365,label:"365天"}],i=()=>{t.activationUnit==="hours"?t.activationDays>24&&(t.activationDays=24):t.activationDays<1&&(t.activationDays=1)},Z=async()=>{if(K.value.name="",!t.name||!t.name.trim()){K.value.name="请输入API Key名称";return}if(t.createType==="batch"&&(!t.batchCount||t.batchCount<2||t.batchCount>500)){W("批量创建数量必须在 2-500 之间","error");return}if(t.rateLimitWindow&&(!t.rateLimitCost||parseFloat(t.rateLimitCost)===0)){let U=!1;if(window.showConfirm?U=await window.showConfirm("费用限制提醒",`您设置了时间窗口但费用限制为0，这意味着不会有费用限制。

是否继续？`,"继续创建","返回修改"):U=confirm(`您设置了时间窗口但费用限制为0，这意味着不会有费用限制。
是否继续？`),!U)return}M.value=!0;try{const U={description:t.description||void 0,tokenLimit:0,rateLimitWindow:t.rateLimitWindow!==""&&t.rateLimitWindow!==null?parseInt(t.rateLimitWindow):null,rateLimitRequests:t.rateLimitRequests!==""&&t.rateLimitRequests!==null?parseInt(t.rateLimitRequests):null,rateLimitCost:t.rateLimitCost!==""&&t.rateLimitCost!==null?parseFloat(t.rateLimitCost):null,concurrencyLimit:t.concurrencyLimit!==""&&t.concurrencyLimit!==null?parseInt(t.concurrencyLimit):0,dailyCostLimit:t.dailyCostLimit!==""&&t.dailyCostLimit!==null?parseFloat(t.dailyCostLimit):0,totalCostLimit:t.totalCostLimit!==""&&t.totalCostLimit!==null?parseFloat(t.totalCostLimit):0,weeklyOpusCostLimit:t.weeklyOpusCostLimit!==""&&t.weeklyOpusCostLimit!==null?parseFloat(t.weeklyOpusCostLimit):0,expiresAt:t.expirationMode==="fixed"&&t.expiresAt||void 0,expirationMode:t.expirationMode,activationDays:t.expirationMode==="activation"?t.activationDays:void 0,activationUnit:t.expirationMode==="activation"?t.activationUnit:void 0,permissions:t.permissions,tags:t.tags.length>0?t.tags:void 0,enableModelRestriction:t.enableModelRestriction,restrictedModels:t.restrictedModels,enableClientRestriction:t.enableClientRestriction,allowedClients:t.allowedClients};if(t.claudeAccountId&&(t.claudeAccountId.startsWith("console:")?(U.claudeConsoleAccountId=t.claudeAccountId.substring(8),delete U.claudeAccountId):(U.claudeAccountId=t.claudeAccountId,delete U.claudeConsoleAccountId)),t.geminiAccountId&&(U.geminiAccountId=t.geminiAccountId),t.openaiAccountId&&(U.openaiAccountId=t.openaiAccountId),t.bedrockAccountId&&(U.bedrockAccountId=t.bedrockAccountId),t.droidAccountId&&(U.droidAccountId=t.droidAccountId),t.createType==="single"){const s={...U,name:t.name},f=await oe.post("/admin/api-keys",s);f.success?(W("API Key 创建成功","success"),S("success",f.data),S("close")):W(f.message||"创建失败","error")}else{const s={...U,createType:"batch",baseName:t.name,count:t.batchCount},f=await oe.post("/admin/api-keys/batch",s);f.success?(W(`成功创建 ${f.data.length} 个 API Key`,"success"),S("batch-success",f.data),S("close")):W(f.message||"批量创建失败","error")}}catch{W("创建失败","error")}finally{M.value=!1}};return(U,s)=>(r(),J(he,{to:"body"},[e("div",lo,[e("div",ro,[e("div",io,[s[49]||(s[49]=e("div",{class:"flex items-center gap-2 sm:gap-3"},[e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-key text-sm text-white sm:text-base"})]),e("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"}," 创建新的 API Key ")],-1)),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",onClick:s[0]||(s[0]=f=>U.$emit("close"))},s[48]||(s[48]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)]))]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-4",onSubmit:De(Z,["prevent"])},[e("div",no,[e("div",{class:ne(["flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",t.createType==="batch"?"mb-3":""])},[s[52]||(s[52]=e("label",{class:"flex h-full items-center text-xs font-semibold text-gray-700 dark:text-gray-300 sm:text-sm"},"创建类型",-1)),e("div",uo,[e("label",co,[B(e("input",{"onUpdate:modelValue":s[1]||(s[1]=f=>t.createType=f),class:"mr-1.5 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 sm:mr-2",type:"radio",value:"single"},null,512),[[ue,t.createType]]),s[50]||(s[50]=e("span",{class:"flex items-center text-xs text-gray-700 dark:text-gray-300 sm:text-sm"},[e("i",{class:"fas fa-key mr-1 text-xs"}),E(" 单个创建 ")],-1))]),e("label",po,[B(e("input",{"onUpdate:modelValue":s[2]||(s[2]=f=>t.createType=f),class:"mr-1.5 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700 sm:mr-2",type:"radio",value:"batch"},null,512),[[ue,t.createType]]),s[51]||(s[51]=e("span",{class:"flex items-center text-xs text-gray-700 dark:text-gray-300 sm:text-sm"},[e("i",{class:"fas fa-layer-group mr-1 text-xs"}),E(" 批量创建 ")],-1))])])],2),t.createType==="batch"?(r(),y("div",mo,[e("div",go,[e("div",yo,[s[54]||(s[54]=e("label",{class:"mb-1 block text-xs font-medium text-gray-600 dark:text-gray-400"},"创建数量",-1)),e("div",fo,[B(e("input",{"onUpdate:modelValue":s[3]||(s[3]=f=>t.batchCount=f),class:"form-input w-full border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",max:"500",min:"2",placeholder:"输入数量 (2-500)",required:"",type:"number"},null,512),[[le,t.batchCount,void 0,{number:!0}]]),s[53]||(s[53]=e("div",{class:"whitespace-nowrap text-xs text-gray-500 dark:text-gray-400"}," 最大支持 500 个 ",-1))])])]),e("p",bo,[s[55]||(s[55]=e("i",{class:"fas fa-info-circle mr-1 mt-0.5 flex-shrink-0"},null,-1)),e("span",null,"批量创建时，每个 Key 的名称会自动添加序号后缀，例如："+v(t.name||"MyKey")+"_1, "+v(t.name||"MyKey")+"_2 ...",1)])])):F("",!0)]),e("div",null,[s[56]||(s[56]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-2 sm:text-sm"},[E("名称 "),e("span",{class:"text-red-500"},"*")],-1)),e("div",null,[B(e("input",{"onUpdate:modelValue":s[4]||(s[4]=f=>t.name=f),class:ne(["form-input flex-1 border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",{"border-red-500":K.value.name}]),placeholder:t.createType==="batch"?"输入基础名称（将自动添加序号）":"为您的 API Key 取一个名称",required:"",type:"text",onInput:s[5]||(s[5]=f=>K.value.name="")},null,42,xo),[[le,t.name]])]),K.value.name?(r(),y("p",vo,v(K.value.name),1)):F("",!0)]),e("div",null,[s[64]||(s[64]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"标签",-1)),e("div",ko,[t.tags.length>0?(r(),y("div",wo,[s[58]||(s[58]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 已选择的标签: ",-1)),e("div",Ao,[(r(!0),y(X,null,ie(t.tags,(f,te)=>(r(),y("span",{key:"selected-"+te,class:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"},[E(v(f)+" ",1),e("button",{class:"ml-1 hover:text-blue-900 dark:hover:text-blue-300",type:"button",onClick:me=>a(te)},s[57]||(s[57]=[e("i",{class:"fas fa-times text-xs"},null,-1)]),8,$o)]))),128))])])):F("",!0),u.value.length>0?(r(),y("div",ho,[s[60]||(s[60]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 点击选择已有标签: ",-1)),e("div",Co,[(r(!0),y(X,null,ie(u.value,f=>(r(),y("button",{key:"available-"+f,class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 transition-colors hover:bg-blue-100 hover:text-blue-700 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-blue-900/30 dark:hover:text-blue-400",type:"button",onClick:te=>x(f)},[s[59]||(s[59]=e("i",{class:"fas fa-tag text-xs text-gray-500 dark:text-gray-400"},null,-1)),E(" "+v(f),1)],8,Io))),128))])])):F("",!0),e("div",null,[s[62]||(s[62]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 创建新标签: ",-1)),e("div",Ko,[B(e("input",{"onUpdate:modelValue":s[6]||(s[6]=f=>k.value=f),class:"form-input flex-1 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"输入新标签名称",type:"text",onKeypress:We(De(se,["prevent"]),["enter"])},null,40,Lo),[[le,k.value]]),e("button",{class:"rounded-lg bg-green-500 px-4 py-2 text-white transition-colors hover:bg-green-600",type:"button",onClick:se},s[61]||(s[61]=[e("i",{class:"fas fa-plus"},null,-1)]))])]),s[63]||(s[63]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 用于标记不同团队或用途，方便筛选管理 ",-1))])]),e("div",Do,[s[72]||(s[72]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-blue-500"},[e("i",{class:"fas fa-tachometer-alt text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"}," 速率限制设置 (可选) ")],-1)),e("div",_o,[e("div",Vo,[e("div",null,[s[65]||(s[65]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"时间窗口 (分钟)",-1)),B(e("input",{"onUpdate:modelValue":s[7]||(s[7]=f=>t.rateLimitWindow=f),class:"form-input w-full border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"1",placeholder:"无限制",type:"number"},null,512),[[le,t.rateLimitWindow]]),s[66]||(s[66]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"时间段单位",-1))]),e("div",null,[s[67]||(s[67]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"请求次数限制",-1)),B(e("input",{"onUpdate:modelValue":s[8]||(s[8]=f=>t.rateLimitRequests=f),class:"form-input w-full border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"1",placeholder:"无限制",type:"number"},null,512),[[le,t.rateLimitRequests]]),s[68]||(s[68]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"窗口内最大请求",-1))]),e("div",null,[s[69]||(s[69]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"费用限制 (美元)",-1)),B(e("input",{"onUpdate:modelValue":s[9]||(s[9]=f=>t.rateLimitCost=f),class:"form-input w-full border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"无限制",step:"0.01",type:"number"},null,512),[[le,t.rateLimitCost]]),s[70]||(s[70]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"窗口内最大费用",-1))])]),s[71]||(s[71]=e("div",{class:"rounded-lg bg-blue-100 p-2 dark:bg-blue-900/30"},[e("h5",{class:"mb-1 text-xs font-semibold text-blue-800 dark:text-blue-400"}," 💡 使用示例 "),e("div",{class:"space-y-0.5 text-xs text-blue-700 dark:text-blue-300"},[e("div",null,[e("strong",null,"示例1:"),E(" 时间窗口=60，请求次数=1000 → 每60分钟最多1000次请求 ")]),e("div",null,[e("strong",null,"示例2:"),E(" 时间窗口=1，费用=0.1 → 每分钟最多$0.1费用")]),e("div",null,[e("strong",null,"示例3:"),E(" 窗口=30，请求=50，费用=5 → 每30分钟50次请求且不超$5费用 ")])])],-1))])]),e("div",null,[s[74]||(s[74]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"每日费用限制 (美元)",-1)),e("div",So,[e("div",Mo,[e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[10]||(s[10]=f=>t.dailyCostLimit="50")}," $50 "),e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[11]||(s[11]=f=>t.dailyCostLimit="100")}," $100 "),e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[12]||(s[12]=f=>t.dailyCostLimit="200")}," $200 "),e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[13]||(s[13]=f=>t.dailyCostLimit="")}," 自定义 ")]),B(e("input",{"onUpdate:modelValue":s[14]||(s[14]=f=>t.dailyCostLimit=f),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示无限制",step:"0.01",type:"number"},null,512),[[le,t.dailyCostLimit]]),s[73]||(s[73]=e("p",{class:"dark:text灰-400 text-xs text-gray-500"}," 设置此 API Key 每日的费用限制，超过限制将拒绝请求，0 或留空表示无限制 ",-1))])]),e("div",null,[s[76]||(s[76]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"总费用限制 (美元)",-1)),e("div",Ro,[e("div",Eo,[e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[15]||(s[15]=f=>t.totalCostLimit="100")}," $100 "),e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[16]||(s[16]=f=>t.totalCostLimit="500")}," $500 "),e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[17]||(s[17]=f=>t.totalCostLimit="1000")}," $1000 "),e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[18]||(s[18]=f=>t.totalCostLimit="")}," 自定义 ")]),B(e("input",{"onUpdate:modelValue":s[19]||(s[19]=f=>t.totalCostLimit=f),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示无限制",step:"0.01",type:"number"},null,512),[[le,t.totalCostLimit]]),s[75]||(s[75]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 设置此 API Key 的累计总费用限制，达到限制后将拒绝所有后续请求，0 或留空表示无限制 ",-1))])]),e("div",null,[s[78]||(s[78]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"Opus 模型周费用限制 (美元)",-1)),e("div",To,[e("div",Uo,[e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[20]||(s[20]=f=>t.weeklyOpusCostLimit="100")}," $100 "),e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[21]||(s[21]=f=>t.weeklyOpusCostLimit="500")}," $500 "),e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[22]||(s[22]=f=>t.weeklyOpusCostLimit="1000")}," $1000 "),e("button",{class:"rounded bg-gray-100 px-2 py-1 text-xs font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[23]||(s[23]=f=>t.weeklyOpusCostLimit="")}," 自定义 ")]),B(e("input",{"onUpdate:modelValue":s[24]||(s[24]=f=>t.weeklyOpusCostLimit=f),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示无限制",step:"0.01",type:"number"},null,512),[[le,t.weeklyOpusCostLimit]]),s[77]||(s[77]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 设置 Opus 模型的周费用限制（周一到周日），仅限 Claude 官方账户，0 或留空表示无限制 ",-1))])]),e("div",null,[s[79]||(s[79]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"并发限制 (可选)",-1)),B(e("input",{"onUpdate:modelValue":s[25]||(s[25]=f=>t.concurrencyLimit=f),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示无限制",type:"number"},null,512),[[le,t.concurrencyLimit]]),s[80]||(s[80]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 设置此 API Key 可同时处理的最大请求数，0 或留空表示无限制 ",-1))]),e("div",null,[s[81]||(s[81]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"备注 (可选)",-1)),B(e("textarea",{"onUpdate:modelValue":s[26]||(s[26]=f=>t.description=f),class:"form-input w-full resize-none border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"描述此 API Key 的用途...",rows:"2"},null,512),[[le,t.description]])]),e("div",null,[s[89]||(s[89]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"过期设置",-1)),e("div",Po,[e("div",Oo,[e("label",Go,[B(e("input",{"onUpdate:modelValue":s[27]||(s[27]=f=>t.expirationMode=f),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"fixed"},null,512),[[ue,t.expirationMode]]),s[82]||(s[82]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"固定时间过期",-1))]),e("label",qo,[B(e("input",{"onUpdate:modelValue":s[28]||(s[28]=f=>t.expirationMode=f),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"activation"},null,512),[[ue,t.expirationMode]]),s[83]||(s[83]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"首次使用后激活",-1))])]),e("p",jo,[t.expirationMode==="fixed"?(r(),y("span",Bo,s[84]||(s[84]=[e("i",{class:"fas fa-info-circle mr-1"},null,-1),E(" 固定时间模式：Key 创建后立即生效，按设定时间过期（支持小时和天数） ",-1)]))):(r(),y("span",zo,s[85]||(s[85]=[e("i",{class:"fas fa-info-circle mr-1"},null,-1),E(" 激活模式：Key 首次使用时激活，激活后按设定时间过期（支持小时和天数，适合批量销售） ",-1)])))])]),t.expirationMode==="fixed"?(r(),y("div",Fo,[B(e("select",{"onUpdate:modelValue":s[29]||(s[29]=f=>t.expireDuration=f),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",onChange:q},s[86]||(s[86]=[e("option",{value:""},"永不过期",-1),e("option",{value:"1h"},"1 小时",-1),e("option",{value:"3h"},"3 小时",-1),e("option",{value:"6h"},"6 小时",-1),e("option",{value:"12h"},"12 小时",-1),e("option",{value:"1d"},"1 天",-1),e("option",{value:"7d"},"7 天",-1),e("option",{value:"30d"},"30 天",-1),e("option",{value:"90d"},"90 天",-1),e("option",{value:"180d"},"180 天",-1),e("option",{value:"365d"},"365 天",-1),e("option",{value:"custom"},"自定义日期",-1)]),544),[[Ae,t.expireDuration]]),t.expireDuration==="custom"?(r(),y("div",Wo,[B(e("input",{"onUpdate:modelValue":s[30]||(s[30]=f=>t.customExpireDate=f),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",min:g.value,type:"datetime-local",onChange:$},null,40,No),[[le,t.customExpireDate]])])):F("",!0),t.expiresAt?(r(),y("p",Ho," 将于 "+v(A(t.expiresAt))+" 过期 ",1)):F("",!0)])):(r(),y("div",Yo,[e("div",Qo,[B(e("input",{"onUpdate:modelValue":s[31]||(s[31]=f=>t.activationDays=f),class:"form-input flex-1 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",max:t.activationUnit==="hours"?8760:3650,min:"1",placeholder:t.activationUnit==="hours"?"输入小时数":"输入天数",type:"number"},null,8,Jo),[[le,t.activationDays,void 0,{number:!0}]]),B(e("select",{"onUpdate:modelValue":s[32]||(s[32]=f=>t.activationUnit=f),class:"form-input w-20 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",onChange:i},s[87]||(s[87]=[e("option",{value:"hours"},"小时",-1),e("option",{value:"days"},"天",-1)]),544),[[Ae,t.activationUnit]])]),e("div",Zo,[(r(!0),y(X,null,ie(L(),f=>(r(),y("button",{key:f.value,class:"rounded-md border border-gray-300 px-3 py-1 text-xs hover:bg-gray-100 dark:border-gray-600 dark:hover:bg-gray-700",type:"button",onClick:te=>t.activationDays=f.value},v(f.label),9,Xo))),128))]),e("p",el,[s[88]||(s[88]=e("i",{class:"fas fa-clock mr-1"},null,-1)),E(" Key 将在首次使用后激活，激活后 "+v(t.activationDays||(t.activationUnit==="hours"?24:30))+" "+v(t.activationUnit==="hours"?"小时":"天")+"过期 ",1)])]))]),e("div",null,[s[95]||(s[95]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"服务权限",-1)),e("div",tl,[e("label",al,[B(e("input",{"onUpdate:modelValue":s[33]||(s[33]=f=>t.permissions=f),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"all"},null,512),[[ue,t.permissions]]),s[90]||(s[90]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"全部服务",-1))]),e("label",sl,[B(e("input",{"onUpdate:modelValue":s[34]||(s[34]=f=>t.permissions=f),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"claude"},null,512),[[ue,t.permissions]]),s[91]||(s[91]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Claude",-1))]),e("label",ol,[B(e("input",{"onUpdate:modelValue":s[35]||(s[35]=f=>t.permissions=f),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"gemini"},null,512),[[ue,t.permissions]]),s[92]||(s[92]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Gemini",-1))]),e("label",ll,[B(e("input",{"onUpdate:modelValue":s[36]||(s[36]=f=>t.permissions=f),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"openai"},null,512),[[ue,t.permissions]]),s[93]||(s[93]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 OpenAI",-1))]),e("label",rl,[B(e("input",{"onUpdate:modelValue":s[37]||(s[37]=f=>t.permissions=f),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"droid"},null,512),[[ue,t.permissions]]),s[94]||(s[94]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Droid",-1))])]),s[96]||(s[96]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 控制此 API Key 可以访问哪些服务 ",-1))]),e("div",null,[e("div",il,[s[97]||(s[97]=e("label",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"专属账号绑定 (可选)",-1)),e("button",{class:"flex items-center gap-1 text-sm text-blue-600 transition-colors hover:text-blue-800 disabled:cursor-not-allowed disabled:opacity-50 dark:text-blue-400 dark:hover:text-blue-300",disabled:R.value,title:"刷新账号列表",type:"button",onClick:b},[e("i",{class:ne(["fas",R.value?"fa-spinner fa-spin":"fa-sync-alt","text-xs"])},null,2),e("span",null,v(R.value?"刷新中...":"刷新账号"),1)],8,nl)]),e("div",dl,[e("div",null,[s[98]||(s[98]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Claude 专属账号",-1)),c(ke,{modelValue:t.claudeAccountId,"onUpdate:modelValue":s[38]||(s[38]=f=>t.claudeAccountId=f),accounts:_.value.claude,"default-option-text":"使用共享账号池",disabled:t.permissions!=="all"&&t.permissions!=="claude",groups:_.value.claudeGroups,placeholder:"请选择Claude账号",platform:"claude"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[s[99]||(s[99]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Gemini 专属账号",-1)),c(ke,{modelValue:t.geminiAccountId,"onUpdate:modelValue":s[39]||(s[39]=f=>t.geminiAccountId=f),accounts:_.value.gemini,"default-option-text":"使用共享账号池",disabled:t.permissions!=="all"&&t.permissions!=="gemini",groups:_.value.geminiGroups,placeholder:"请选择Gemini账号",platform:"gemini"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[s[100]||(s[100]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"OpenAI 专属账号",-1)),c(ke,{modelValue:t.openaiAccountId,"onUpdate:modelValue":s[40]||(s[40]=f=>t.openaiAccountId=f),accounts:_.value.openai,"default-option-text":"使用共享账号池",disabled:t.permissions!=="all"&&t.permissions!=="openai",groups:_.value.openaiGroups,placeholder:"请选择OpenAI账号",platform:"openai"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[s[101]||(s[101]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Bedrock 专属账号",-1)),c(ke,{modelValue:t.bedrockAccountId,"onUpdate:modelValue":s[41]||(s[41]=f=>t.bedrockAccountId=f),accounts:_.value.bedrock,"default-option-text":"使用共享账号池",disabled:t.permissions!=="all"&&t.permissions!=="openai",groups:[],placeholder:"请选择Bedrock账号",platform:"bedrock"},null,8,["modelValue","accounts","disabled"])]),e("div",null,[s[102]||(s[102]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Droid 专属账号",-1)),c(ke,{modelValue:t.droidAccountId,"onUpdate:modelValue":s[42]||(s[42]=f=>t.droidAccountId=f),accounts:_.value.droid,"default-option-text":"使用共享账号池",disabled:t.permissions!=="all"&&t.permissions!=="droid",groups:_.value.droidGroups,placeholder:"请选择Droid账号",platform:"droid"},null,8,["modelValue","accounts","disabled","groups"])])]),s[103]||(s[103]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 选择专属账号后，此API Key将只使用该账号，不选择则使用共享账号池 ",-1))]),e("div",null,[e("div",ul,[B(e("input",{id:"enableModelRestriction","onUpdate:modelValue":s[43]||(s[43]=f=>t.enableModelRestriction=f),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[Se,t.enableModelRestriction]]),s[104]||(s[104]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"enableModelRestriction"}," 启用模型限制 ",-1))]),t.enableModelRestriction?(r(),y("div",cl,[e("div",null,[s[107]||(s[107]=e("label",{class:"mb-2 block text-sm font-medium text-gray-600"},"限制的模型列表",-1)),e("div",pl,[(r(!0),y(X,null,ie(t.restrictedModels,(f,te)=>(r(),y("span",{key:te,class:"inline-flex items-center rounded-full bg-red-100 px-3 py-1 text-sm text-red-800"},[E(v(f)+" ",1),e("button",{class:"ml-2 text-red-600 hover:text-red-800",type:"button",onClick:me=>C(te)},s[105]||(s[105]=[e("i",{class:"fas fa-times text-xs"},null,-1)]),8,ml)]))),128)),t.restrictedModels.length===0?(r(),y("span",gl," 暂无限制的模型 ")):F("",!0)]),e("div",yl,[e("div",fl,[(r(!0),y(X,null,ie(T.value,f=>(r(),y("button",{key:f,class:"flex-shrink-0 rounded-lg bg-gray-100 px-3 py-1 text-xs text-gray-700 transition-colors hover:bg-gray-200 sm:text-sm",type:"button",onClick:te=>ee(f)},v(f),9,bl))),128)),T.value.length===0?(r(),y("span",xl," 所有常用模型已在限制列表中 ")):F("",!0)]),e("div",vl,[B(e("input",{"onUpdate:modelValue":s[44]||(s[44]=f=>t.modelInput=f),class:"form-input flex-1",placeholder:"输入模型名称，按回车添加",type:"text",onKeydown:We(De(l,["prevent"]),["enter"])},null,40,kl),[[le,t.modelInput]]),e("button",{class:"rounded-lg bg-red-500 px-4 py-2 text-white transition-colors hover:bg-red-600",type:"button",onClick:l},s[106]||(s[106]=[e("i",{class:"fas fa-plus"},null,-1)]))])]),s[108]||(s[108]=e("p",{class:"mt-2 text-xs text-gray-500"}," 设置此API Key无法访问的模型，例如：claude-opus-4-20250514 ",-1))])])):F("",!0)]),e("div",null,[e("div",wl,[B(e("input",{id:"enableClientRestriction","onUpdate:modelValue":s[45]||(s[45]=f=>t.enableClientRestriction=f),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox"},null,512),[[Se,t.enableClientRestriction]]),s[109]||(s[109]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"enableClientRestriction"}," 启用客户端限制 ",-1))]),t.enableClientRestriction?(r(),y("div",Al,[e("div",null,[s[110]||(s[110]=e("label",{class:"mb-2 block text-xs font-medium text-gray-700 dark:text-gray-300"},"允许的客户端",-1)),e("div",$l,[(r(!0),y(X,null,ie(n.value,f=>(r(),y("div",{key:f.id,class:"flex items-start"},[B(e("input",{id:`client_${f.id}`,"onUpdate:modelValue":s[46]||(s[46]=te=>t.allowedClients=te),class:"mt-0.5 h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox",value:f.id},null,8,hl),[[Se,t.allowedClients]]),e("label",{class:"ml-2 flex-1 cursor-pointer",for:`client_${f.id}`},[e("span",Il,v(f.name),1),e("span",Kl,v(f.description),1)],8,Cl)]))),128))])])])):F("",!0)]),e("div",Ll,[e("button",{class:"flex-1 rounded-lg bg-gray-100 px-4 py-2.5 text-sm font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:s[47]||(s[47]=f=>U.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-4 py-2.5 text-sm font-semibold",disabled:M.value,type:"submit"},[M.value?(r(),y("div",_l)):(r(),y("i",Vl)),E(" "+v(M.value?"创建中...":"创建"),1)],8,Dl)])],32)])])]))}},Ml=xe(Sl,[["__scopeId","data-v-8e3bee51"]]),Rl={class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},El={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-4xl flex-col p-4 sm:p-6 md:p-8","element-loading-text":"加载中..."},Tl={class:"mb-4 flex items-center justify-between sm:mb-6"},Ul=["value"],Pl={key:0,class:"text-gray-500"},Ol={class:"space-y-4"},Gl={key:0},ql={class:"flex flex-wrap gap-2"},jl=["onClick"],Bl={key:1},zl={class:"flex flex-wrap gap-2"},Fl=["onClick"],Wl={class:"flex gap-2"},Nl=["onKeypress"],Hl={class:"rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-700 dark:bg-blue-900/20"},Yl={class:"space-y-2"},Ql={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},Jl={class:"space-y-2"},Zl={class:"space-y-3"},Xl={class:"flex gap-2"},er={class:"space-y-3"},tr={class:"flex gap-2"},ar={class:"space-y-3"},sr={class:"flex gap-2"},or={class:"mb-3 flex items-center"},lr={class:"flex gap-4"},rr={class:"flex cursor-pointer items-center"},ir={class:"flex cursor-pointer items-center"},nr={class:"flex cursor-pointer items-center"},dr={class:"flex cursor-pointer items-center"},ur={class:"flex cursor-pointer items-center"},cr={class:"mb-3 flex items-center justify-between"},pr=["disabled"],mr={class:"grid grid-cols-1 gap-3"},gr={class:"mb-3 flex items-center"},yr={key:0,class:"space-y-3"},fr={class:"mb-3 flex min-h-[32px] flex-wrap gap-2 rounded-lg border border-gray-200 bg-gray-50 p-2 dark:border-gray-600 dark:bg-gray-700"},br=["onClick"],xr={key:0,class:"text-sm text-gray-400 dark:text-gray-500"},vr={class:"space-y-3"},kr={class:"flex flex-wrap gap-2"},wr=["onClick"],Ar={key:0,class:"text-sm italic text-gray-400 dark:text-gray-500"},$r={class:"flex gap-2"},hr=["onKeydown"],Cr={class:"mb-3 flex items-center"},Ir={key:0,class:"space-y-3"},Kr={class:"space-y-2"},Lr=["id","value"],Dr=["for"],_r={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},Vr={class:"block text-xs text-gray-500 dark:text-gray-400"},Sr={class:"flex gap-3 pt-4"},Mr=["disabled"],Rr={key:0,class:"loading-spinner mr-2"},Er={key:1,class:"fas fa-save mr-2"},Tr={__name:"EditApiKeyModal",props:{apiKey:{type:Object,required:!0},accounts:{type:Object,default:()=>({claude:[],gemini:[],openai:[],bedrock:[],droid:[],claudeGroups:[],geminiGroups:[],openaiGroups:[],droidGroups:[],openaiResponses:[]})},availableTags:{type:Array,default:()=>[]}},emits:["close","success"],setup(m,{emit:O}){const o=m,S=O,I=Ht(),p=V(!1),M=V(!0),R=V(!1),_=V({claude:[],gemini:[],openai:[],bedrock:[],droid:[],claudeGroups:[],geminiGroups:[],openaiGroups:[],droidGroups:[]}),K=V([]),k=V([]),d=V(""),u=V([]),n=Q(()=>u.value.filter(x=>!t.tags.includes(x))),t=Pe({name:"",tokenLimit:"",rateLimitWindow:"",rateLimitRequests:"",rateLimitCost:"",concurrencyLimit:"",dailyCostLimit:"",totalCostLimit:"",weeklyOpusCostLimit:"",permissions:"all",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",droidAccountId:"",enableModelRestriction:!1,restrictedModels:[],modelInput:"",enableClientRestriction:!1,allowedClients:[],tags:[],isActive:!0,ownerId:""}),b=()=>{t.modelInput&&!t.restrictedModels.includes(t.modelInput)&&(t.restrictedModels.push(t.modelInput),t.modelInput="")},g=x=>{t.restrictedModels.splice(x,1)},q=V(["claude-opus-4-20250514","claude-opus-4-1-20250805"]),$=Q(()=>q.value.filter(x=>!t.restrictedModels.includes(x))),A=x=>{t.restrictedModels.includes(x)||t.restrictedModels.push(x)},l=()=>{if(d.value&&d.value.trim()){const x=d.value.trim();t.tags.includes(x)||t.tags.push(x),d.value=""}},C=x=>{t.tags.includes(x)||t.tags.push(x)},N=x=>{t.tags.splice(x,1)},T=async()=>{if(t.rateLimitWindow&&(!t.rateLimitCost||parseFloat(t.rateLimitCost)===0)){let x=!1;if(window.showConfirm?x=await window.showConfirm("费用限制提醒",`您设置了时间窗口但费用限制为0，这意味着不会有费用限制。

是否继续？`,"继续保存","返回修改"):x=confirm(`您设置了时间窗口但费用限制为0，这意味着不会有费用限制。
是否继续？`),!x)return}p.value=!0;try{const x={name:t.name,tokenLimit:0,rateLimitWindow:t.rateLimitWindow!==""&&t.rateLimitWindow!==null?parseInt(t.rateLimitWindow):0,rateLimitRequests:t.rateLimitRequests!==""&&t.rateLimitRequests!==null?parseInt(t.rateLimitRequests):0,rateLimitCost:t.rateLimitCost!==""&&t.rateLimitCost!==null?parseFloat(t.rateLimitCost):0,concurrencyLimit:t.concurrencyLimit!==""&&t.concurrencyLimit!==null?parseInt(t.concurrencyLimit):0,dailyCostLimit:t.dailyCostLimit!==""&&t.dailyCostLimit!==null?parseFloat(t.dailyCostLimit):0,totalCostLimit:t.totalCostLimit!==""&&t.totalCostLimit!==null?parseFloat(t.totalCostLimit):0,weeklyOpusCostLimit:t.weeklyOpusCostLimit!==""&&t.weeklyOpusCostLimit!==null?parseFloat(t.weeklyOpusCostLimit):0,dailyRequestsLimit:t.dailyRequestsLimit!==""&&t.dailyRequestsLimit!==null?parseInt(t.dailyRequestsLimit):0,permissions:t.permissions,tags:t.tags};t.claudeAccountId?t.claudeAccountId.startsWith("console:")?(x.claudeConsoleAccountId=t.claudeAccountId.substring(8),x.claudeAccountId=null):(t.claudeAccountId.startsWith("group:"),x.claudeAccountId=t.claudeAccountId,x.claudeConsoleAccountId=null):(x.claudeAccountId=null,x.claudeConsoleAccountId=null),t.geminiAccountId?x.geminiAccountId=t.geminiAccountId:x.geminiAccountId=null,t.openaiAccountId?x.openaiAccountId=t.openaiAccountId:x.openaiAccountId=null,t.bedrockAccountId?x.bedrockAccountId=t.bedrockAccountId:x.bedrockAccountId=null,t.droidAccountId?x.droidAccountId=t.droidAccountId:x.droidAccountId=null,x.enableModelRestriction=t.enableModelRestriction,x.restrictedModels=t.restrictedModels,x.enableClientRestriction=t.enableClientRestriction,x.allowedClients=t.allowedClients,x.isActive=t.isActive,t.ownerId!==void 0&&(x.ownerId=t.ownerId);const a=await oe.put(`/admin/api-keys/${o.apiKey.id}`,x);a.success?(S("success"),S("close")):W(a.message||"更新失败","error")}catch{W("更新失败","error")}finally{p.value=!1}},ee=async x=>{var a,L,i,Z,U,s,f,te;R.value=!0;try{const me=x||t.permissions||"all",ae=await oe.get("/admin/accounts/aggregated",{params:{platform:me||"all",compact:"true",fields:"summary"}});if(!(ae!=null&&ae.success))throw new Error("failed");const ye=[];(a=ae.data)!=null&&a.claudeAccounts&&ae.data.claudeAccounts.forEach(H=>{ye.push({...H,platform:"claude-oauth",isDedicated:H.accountType==="dedicated"})}),(L=ae.data)!=null&&L.claudeConsoleAccounts&&ae.data.claudeConsoleAccounts.forEach(H=>{ye.push({...H,platform:"claude-console",isDedicated:H.accountType==="dedicated"})}),_.value.claude=ye,(i=ae.data)!=null&&i.geminiAccounts&&(_.value.gemini=(ae.data.geminiAccounts||[]).map(H=>({...H,isDedicated:H.accountType==="dedicated"})));const ge=[];if((Z=ae.data)!=null&&Z.openaiAccounts&&(ae.data.openaiAccounts||[]).forEach(H=>{ge.push({...H,platform:"openai",isDedicated:H.accountType==="dedicated"})}),(U=ae.data)!=null&&U.openaiResponsesAccounts&&(ae.data.openaiResponsesAccounts||[]).forEach(H=>{ge.push({...H,platform:"openai-responses",isDedicated:H.accountType==="dedicated"})}),_.value.openai=ge,(s=ae.data)!=null&&s.bedrockAccounts&&(_.value.bedrock=(ae.data.bedrockAccounts||[]).map(H=>({...H,isDedicated:H.accountType==="dedicated"}))),(f=ae.data)!=null&&f.droidAccounts&&(_.value.droid=(ae.data.droidAccounts||[]).map(H=>({...H,platform:"droid",isDedicated:H.accountType==="dedicated"}))),(te=ae.data)!=null&&te.accountGroups){const H=ae.data.accountGroups||[];_.value.claudeGroups=H.filter(fe=>fe.platform==="claude"),_.value.geminiGroups=H.filter(fe=>fe.platform==="gemini"),_.value.openaiGroups=H.filter(fe=>fe.platform==="openai"),_.value.droidGroups=H.filter(fe=>fe.platform==="droid")}W("账号列表已刷新","success")}catch{W("刷新账号列表失败","error")}finally{R.value=!1}},se=async()=>{try{const x=await oe.get("/admin/users");x.success&&(k.value=x.data||[])}catch{k.value=[{id:"admin",username:"admin",displayName:"Admin",email:"",role:"admin"}]}};return Ue(async()=>{try{const[x,,a]=await Promise.all([I.loadSupportedClients(),se(),oe.get(`/admin/api-keys/${o.apiKey.id}`).catch(()=>({success:!1}))]);if(K.value=x||[],u.value=Array.isArray(o.availableTags)?o.availableTags:[],a&&a.success&&a.data){const L=a.data;t.name=L.name,t.tokenLimit=L.tokenLimit||"",t.rateLimitCost=L.rateLimitCost||"",t.rateLimitWindow=L.rateLimitWindow||"",t.rateLimitRequests=L.rateLimitRequests||"",t.concurrencyLimit=L.concurrencyLimit||"",t.dailyCostLimit=L.dailyCostLimit||"",t.totalCostLimit=L.totalCostLimit||"",t.weeklyOpusCostLimit=L.weeklyOpusCostLimit||"",t.dailyRequestsLimit=L.dailyRequestsLimit||"",t.permissions=L.permissions||"all",L.claudeConsoleAccountId?t.claudeAccountId=`console:${L.claudeConsoleAccountId}`:t.claudeAccountId=L.claudeAccountId||"",t.geminiAccountId=L.geminiAccountId||"",t.openaiAccountId=L.openaiAccountId||"",t.bedrockAccountId=L.bedrockAccountId||"",t.droidAccountId=L.droidAccountId||"",t.restrictedModels=Array.isArray(L.restrictedModels)?L.restrictedModels:[],t.allowedClients=Array.isArray(L.allowedClients)?L.allowedClients:[],t.tags=Array.isArray(L.tags)?L.tags:[],t.enableModelRestriction=!!L.enableModelRestriction,t.enableClientRestriction=!!L.enableClientRestriction,t.isActive=L.isActive!==void 0?!!L.isActive:!0,t.ownerId=L.userId||"admin"}else t.name=o.apiKey.name,t.tokenLimit=o.apiKey.tokenLimit||"",t.rateLimitCost=o.apiKey.rateLimitCost||"",t.rateLimitWindow=o.apiKey.rateLimitWindow||"",t.rateLimitRequests=o.apiKey.rateLimitRequests||"",t.concurrencyLimit=o.apiKey.concurrencyLimit||"",t.dailyCostLimit=o.apiKey.dailyCostLimit||"",t.totalCostLimit=o.apiKey.totalCostLimit||"",t.weeklyOpusCostLimit=o.apiKey.weeklyOpusCostLimit||"",t.dailyRequestsLimit=o.apiKey.dailyRequestsLimit||"",t.permissions=o.apiKey.permissions||"all",o.apiKey.claudeConsoleAccountId?t.claudeAccountId=`console:${o.apiKey.claudeConsoleAccountId}`:t.claudeAccountId=o.apiKey.claudeAccountId||"",t.geminiAccountId=o.apiKey.geminiAccountId||"",t.openaiAccountId=o.apiKey.openaiAccountId||"",t.bedrockAccountId=o.apiKey.bedrockAccountId||"",t.droidAccountId=o.apiKey.droidAccountId||"",t.restrictedModels=o.apiKey.restrictedModels||[],t.allowedClients=o.apiKey.allowedClients||[],t.tags=o.apiKey.tags||[],t.enableModelRestriction=o.apiKey.enableModelRestriction||!1,t.enableClientRestriction=o.apiKey.enableClientRestriction||!1,t.isActive=o.apiKey.isActive!==void 0?o.apiKey.isActive:!0,t.ownerId=o.apiKey.userId||"admin"}catch{K.value=[],u.value=[]}try{if(o.accounts){const x=[];(o.accounts.openai||[]).forEach(a=>x.push({...a,platform:"openai",isDedicated:a.accountType==="dedicated"})),(o.accounts.openaiResponses||[]).forEach(a=>x.push({...a,platform:"openai-responses",isDedicated:a.accountType==="dedicated"})),_.value={claude:(o.accounts.claude||[]).map(a=>({...a,platform:"claude-oauth",isDedicated:a.accountType==="dedicated"})),gemini:(o.accounts.gemini||[]).map(a=>({...a,isDedicated:a.accountType==="dedicated"})),openai:x,bedrock:(o.accounts.bedrock||[]).map(a=>({...a,isDedicated:a.accountType==="dedicated"})),droid:(o.accounts.droid||[]).map(a=>({...a,platform:"droid",isDedicated:a.accountType==="dedicated"})),claudeGroups:o.accounts.claudeGroups||[],geminiGroups:o.accounts.geminiGroups||[],openaiGroups:o.accounts.openaiGroups||[],droidGroups:o.accounts.droidGroups||[]}}}catch(x){console.log(x)}M.value=!1}),(x,a)=>{const L=it;return r(),J(he,{to:"body"},[e("div",Rl,[B((r(),y("div",El,[e("div",Tl,[a[41]||(a[41]=e("div",{class:"flex items-center gap-2 sm:gap-3"},[e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-edit text-sm text-white sm:text-base"})]),e("h3",{class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"}," 编辑 API Key ")],-1)),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",onClick:a[0]||(a[0]=i=>x.$emit("close"))},a[40]||(a[40]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)]))]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-4 sm:space-y-6",onSubmit:De(T,["prevent"])},[e("div",null,[a[42]||(a[42]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-3 sm:text-sm"},"名称",-1)),e("div",null,[B(e("input",{"onUpdate:modelValue":a[1]||(a[1]=i=>t.name=i),class:"form-input flex-1 border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",maxlength:"100",placeholder:"请输入API Key名称",required:"",type:"text"},null,512),[[le,t.name]])]),a[43]||(a[43]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400 sm:mt-2"}," 用于识别此 API Key 的用途 ",-1))]),e("div",null,[a[44]||(a[44]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-3 sm:text-sm"},"所有者",-1)),B(e("select",{"onUpdate:modelValue":a[2]||(a[2]=i=>t.ownerId=i),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200"},[(r(!0),y(X,null,ie(k.value,i=>(r(),y("option",{key:i.id,value:i.id},[E(v(i.displayName)+" ("+v(i.username)+") ",1),i.role==="admin"?(r(),y("span",Pl,"- 管理员")):F("",!0)],8,Ul))),128))],512),[[Ae,t.ownerId]]),a[45]||(a[45]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400 sm:mt-2"}," 分配此 API Key 给指定用户或管理员，管理员分配时不受用户 API Key 数量限制 ",-1))]),e("div",null,[a[53]||(a[53]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-3 sm:text-sm"},"标签",-1)),e("div",Ol,[t.tags.length>0?(r(),y("div",Gl,[a[47]||(a[47]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 已选择的标签: ",-1)),e("div",ql,[(r(!0),y(X,null,ie(t.tags,(i,Z)=>(r(),y("span",{key:"selected-"+Z,class:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"},[E(v(i)+" ",1),e("button",{class:"ml-1 hover:text-blue-900 dark:hover:text-blue-300",type:"button",onClick:U=>N(Z)},a[46]||(a[46]=[e("i",{class:"fas fa-times text-xs"},null,-1)]),8,jl)]))),128))])])):F("",!0),n.value.length>0?(r(),y("div",Bl,[a[49]||(a[49]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 点击选择已有标签: ",-1)),e("div",zl,[(r(!0),y(X,null,ie(n.value,i=>(r(),y("button",{key:"available-"+i,class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 transition-colors hover:bg-blue-100 hover:text-blue-700 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-blue-900/30 dark:hover:text-blue-400",type:"button",onClick:Z=>C(i)},[a[48]||(a[48]=e("i",{class:"fas fa-tag text-xs text-gray-500 dark:text-gray-400"},null,-1)),E(" "+v(i),1)],8,Fl))),128))])])):F("",!0),e("div",null,[a[51]||(a[51]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 创建新标签: ",-1)),e("div",Wl,[B(e("input",{"onUpdate:modelValue":a[3]||(a[3]=i=>d.value=i),class:"form-input flex-1 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"输入新标签名称",type:"text",onKeypress:We(De(l,["prevent"]),["enter"])},null,40,Nl),[[le,d.value]]),e("button",{class:"rounded-lg bg-green-500 px-4 py-2 text-white transition-colors hover:bg-green-600",type:"button",onClick:l},a[50]||(a[50]=[e("i",{class:"fas fa-plus"},null,-1)]))])]),a[52]||(a[52]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 用于标记不同团队或用途，方便筛选管理 ",-1))])]),e("div",Hl,[a[61]||(a[61]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-blue-500"},[e("i",{class:"fas fa-tachometer-alt text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"}," 速率限制设置 (可选) ")],-1)),e("div",Yl,[e("div",Ql,[e("div",null,[a[54]||(a[54]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"时间窗口 (分钟)",-1)),B(e("input",{"onUpdate:modelValue":a[4]||(a[4]=i=>t.rateLimitWindow=i),class:"form-input w-full border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"1",placeholder:"无限制",type:"number"},null,512),[[le,t.rateLimitWindow]]),a[55]||(a[55]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"时间段单位",-1))]),e("div",null,[a[56]||(a[56]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"请求次数限制",-1)),B(e("input",{"onUpdate:modelValue":a[5]||(a[5]=i=>t.rateLimitRequests=i),class:"form-input w-full border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"1",placeholder:"无限制",type:"number"},null,512),[[le,t.rateLimitRequests]]),a[57]||(a[57]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"窗口内最大请求",-1))]),e("div",null,[a[58]||(a[58]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"费用限制 (美元)",-1)),B(e("input",{"onUpdate:modelValue":a[6]||(a[6]=i=>t.rateLimitCost=i),class:"form-input w-full border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"无限制",step:"0.01",type:"number"},null,512),[[le,t.rateLimitCost]]),a[59]||(a[59]=e("p",{class:"ml-2 mt-0.5 text-xs text-gray-500 dark:text-gray-400"},"窗口内最大费用",-1))])]),a[60]||(a[60]=e("div",{class:"rounded-lg bg-blue-100 p-2 dark:bg-blue-900/30"},[e("h5",{class:"mb-1 text-xs font-semibold text-blue-800 dark:text-blue-400"}," 💡 使用示例 "),e("div",{class:"space-y-0.5 text-xs text-blue-700 dark:text-blue-300"},[e("div",null,[e("strong",null,"示例1:"),E(" 时间窗口=60，请求次数=1000 → 每60分钟最多1000次请求 ")]),e("div",null,[e("strong",null,"示例2:"),E(" 时间窗口=1，费用=0.1 → 每分钟最多$0.1费用")]),e("div",null,[e("strong",null,"示例3:"),E(" 窗口=30，请求=50，费用=5 → 每30分钟50次请求且不超$5费用 ")])])],-1))])]),e("div",null,[a[63]||(a[63]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"每日请求次数限制",-1)),e("div",Jl,[B(e("input",{"onUpdate:modelValue":a[7]||(a[7]=i=>t.dailyRequestsLimit=i),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示不限制",type:"number"},null,512),[[le,t.dailyRequestsLimit]]),a[62]||(a[62]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 设置此 API Key 每日请求次数上限，超过限制将返回 429；0 表示不限制 ",-1))])]),e("div",null,[a[65]||(a[65]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"每日费用限制 (美元)",-1)),e("div",Zl,[e("div",Xl,[e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[8]||(a[8]=i=>t.dailyCostLimit="50")}," $50 "),e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[9]||(a[9]=i=>t.dailyCostLimit="100")}," $100 "),e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[10]||(a[10]=i=>t.dailyCostLimit="200")}," $200 "),e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[11]||(a[11]=i=>t.dailyCostLimit="")}," 自定义 ")]),B(e("input",{"onUpdate:modelValue":a[12]||(a[12]=i=>t.dailyCostLimit=i),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示无限制",step:"0.01",type:"number"},null,512),[[le,t.dailyCostLimit]]),a[64]||(a[64]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 设置此 API Key 每日的费用限制，超过限制将拒绝请求，0 或留空表示无限制 ",-1))])]),e("div",null,[a[67]||(a[67]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"总费用限制 (美元)",-1)),e("div",er,[e("div",tr,[e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[13]||(a[13]=i=>t.totalCostLimit="100")}," $100 "),e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[14]||(a[14]=i=>t.totalCostLimit="500")}," $500 "),e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[15]||(a[15]=i=>t.totalCostLimit="1000")}," $1000 "),e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[16]||(a[16]=i=>t.totalCostLimit="")}," 自定义 ")]),B(e("input",{"onUpdate:modelValue":a[17]||(a[17]=i=>t.totalCostLimit=i),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示无限制",step:"0.01",type:"number"},null,512),[[le,t.totalCostLimit]]),a[66]||(a[66]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 设置此 API Key 的累计总费用限制，达到限制后将拒绝所有后续请求，0 或留空表示无限制 ",-1))])]),e("div",null,[a[69]||(a[69]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"Opus 模型周费用限制 (美元)",-1)),e("div",ar,[e("div",sr,[e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[18]||(a[18]=i=>t.weeklyOpusCostLimit="100")}," $100 "),e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[19]||(a[19]=i=>t.weeklyOpusCostLimit="500")}," $500 "),e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[20]||(a[20]=i=>t.weeklyOpusCostLimit="1000")}," $1000 "),e("button",{class:"rounded-lg bg-gray-100 px-3 py-1 text-sm font-medium hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[21]||(a[21]=i=>t.weeklyOpusCostLimit="")}," 自定义 ")]),B(e("input",{"onUpdate:modelValue":a[22]||(a[22]=i=>t.weeklyOpusCostLimit=i),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示无限制",step:"0.01",type:"number"},null,512),[[le,t.weeklyOpusCostLimit]]),a[68]||(a[68]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," 设置 Opus 模型的周费用限制（周一到周日），仅限 Claude 官方账户，0 或留空表示无限制 ",-1))])]),e("div",null,[a[70]||(a[70]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"并发限制",-1)),B(e("input",{"onUpdate:modelValue":a[23]||(a[23]=i=>t.concurrencyLimit=i),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",min:"0",placeholder:"0 表示无限制",type:"number"},null,512),[[le,t.concurrencyLimit]]),a[71]||(a[71]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 设置此 API Key 可同时处理的最大请求数 ",-1))]),e("div",null,[e("div",or,[B(e("input",{id:"editIsActive","onUpdate:modelValue":a[24]||(a[24]=i=>t.isActive=i),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"checkbox"},null,512),[[Se,t.isActive]]),a[72]||(a[72]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"editIsActive"}," 激活账号 ",-1))]),a[73]||(a[73]=e("p",{class:"mb-4 text-xs text-gray-500 dark:text-gray-400"}," 取消勾选将禁用此 API Key，暂停所有请求，客户端返回 401 错误 ",-1))]),e("div",null,[a[79]||(a[79]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"服务权限",-1)),e("div",lr,[e("label",rr,[B(e("input",{"onUpdate:modelValue":a[25]||(a[25]=i=>t.permissions=i),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"all"},null,512),[[ue,t.permissions]]),a[74]||(a[74]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"全部服务",-1))]),e("label",ir,[B(e("input",{"onUpdate:modelValue":a[26]||(a[26]=i=>t.permissions=i),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"claude"},null,512),[[ue,t.permissions]]),a[75]||(a[75]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Claude",-1))]),e("label",nr,[B(e("input",{"onUpdate:modelValue":a[27]||(a[27]=i=>t.permissions=i),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"gemini"},null,512),[[ue,t.permissions]]),a[76]||(a[76]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Gemini",-1))]),e("label",dr,[B(e("input",{"onUpdate:modelValue":a[28]||(a[28]=i=>t.permissions=i),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"openai"},null,512),[[ue,t.permissions]]),a[77]||(a[77]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 OpenAI",-1))]),e("label",ur,[B(e("input",{"onUpdate:modelValue":a[29]||(a[29]=i=>t.permissions=i),class:"mr-2 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"radio",value:"droid"},null,512),[[ue,t.permissions]]),a[78]||(a[78]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"仅 Droid",-1))])]),a[80]||(a[80]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 控制此 API Key 可以访问哪些服务 ",-1))]),e("div",null,[e("div",cr,[a[81]||(a[81]=e("label",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"专属账号绑定",-1)),e("button",{class:"flex items-center gap-1 text-sm text-blue-600 transition-colors hover:text-blue-800 disabled:cursor-not-allowed disabled:opacity-50 dark:text-blue-400 dark:hover:text-blue-300",disabled:R.value,title:"刷新账号列表",type:"button",onClick:ee},[e("i",{class:ne(["fas",R.value?"fa-spinner fa-spin":"fa-sync-alt","text-xs"])},null,2),e("span",null,v(R.value?"刷新中...":"刷新账号"),1)],8,pr)]),e("div",mr,[e("div",null,[a[82]||(a[82]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Claude 专属账号",-1)),c(ke,{modelValue:t.claudeAccountId,"onUpdate:modelValue":a[30]||(a[30]=i=>t.claudeAccountId=i),accounts:_.value.claude,"default-option-text":"使用共享账号池",disabled:t.permissions!=="all"&&t.permissions!=="claude",groups:_.value.claudeGroups,placeholder:"请选择Claude账号",platform:"claude"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[a[83]||(a[83]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Gemini 专属账号",-1)),c(ke,{modelValue:t.geminiAccountId,"onUpdate:modelValue":a[31]||(a[31]=i=>t.geminiAccountId=i),accounts:_.value.gemini,"default-option-text":"使用共享账号池",disabled:t.permissions!=="all"&&t.permissions!=="gemini",groups:_.value.geminiGroups,placeholder:"请选择Gemini账号",platform:"gemini"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[a[84]||(a[84]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"OpenAI 专属账号",-1)),c(ke,{modelValue:t.openaiAccountId,"onUpdate:modelValue":a[32]||(a[32]=i=>t.openaiAccountId=i),accounts:_.value.openai,"default-option-text":"使用共享账号池",disabled:t.permissions!=="all"&&t.permissions!=="openai",groups:_.value.openaiGroups,placeholder:"请选择OpenAI账号",platform:"openai"},null,8,["modelValue","accounts","disabled","groups"])]),e("div",null,[a[85]||(a[85]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Bedrock 专属账号",-1)),c(ke,{modelValue:t.bedrockAccountId,"onUpdate:modelValue":a[33]||(a[33]=i=>t.bedrockAccountId=i),accounts:_.value.bedrock,"default-option-text":"使用共享账号池",disabled:t.permissions!=="all"&&t.permissions!=="openai",groups:[],placeholder:"请选择Bedrock账号",platform:"bedrock"},null,8,["modelValue","accounts","disabled"])]),e("div",null,[a[86]||(a[86]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Droid 专属账号",-1)),c(ke,{modelValue:t.droidAccountId,"onUpdate:modelValue":a[34]||(a[34]=i=>t.droidAccountId=i),accounts:_.value.droid,"default-option-text":"使用共享账号池",disabled:t.permissions!=="all"&&t.permissions!=="droid",groups:_.value.droidGroups,placeholder:"请选择Droid账号",platform:"droid"},null,8,["modelValue","accounts","disabled","groups"])])]),a[87]||(a[87]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 修改绑定账号将影响此API Key的请求路由 ",-1))]),e("div",null,[e("div",gr,[B(e("input",{id:"editEnableModelRestriction","onUpdate:modelValue":a[35]||(a[35]=i=>t.enableModelRestriction=i),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"checkbox"},null,512),[[Se,t.enableModelRestriction]]),a[88]||(a[88]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"editEnableModelRestriction"}," 启用模型限制 ",-1))]),t.enableModelRestriction?(r(),y("div",yr,[e("div",null,[a[91]||(a[91]=e("label",{class:"mb-2 block text-sm font-medium text-gray-600 dark:text-gray-400"},"限制的模型列表",-1)),e("div",fr,[(r(!0),y(X,null,ie(t.restrictedModels,(i,Z)=>(r(),y("span",{key:Z,class:"inline-flex items-center rounded-full bg-red-100 px-3 py-1 text-sm text-red-800 dark:bg-red-900/30 dark:text-red-400"},[E(v(i)+" ",1),e("button",{class:"ml-2 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",type:"button",onClick:U=>g(Z)},a[89]||(a[89]=[e("i",{class:"fas fa-times text-xs"},null,-1)]),8,br)]))),128)),t.restrictedModels.length===0?(r(),y("span",xr," 暂无限制的模型 ")):F("",!0)]),e("div",vr,[e("div",kr,[(r(!0),y(X,null,ie($.value,i=>(r(),y("button",{key:i,class:"flex-shrink-0 rounded-lg bg-gray-100 px-3 py-1 text-xs text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 sm:text-sm",type:"button",onClick:Z=>A(i)},v(i),9,wr))),128)),$.value.length===0?(r(),y("span",Ar," 所有常用模型已在限制列表中 ")):F("",!0)]),e("div",$r,[B(e("input",{"onUpdate:modelValue":a[36]||(a[36]=i=>t.modelInput=i),class:"form-input flex-1 border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:placeholder-gray-400",placeholder:"输入模型名称，按回车添加",type:"text",onKeydown:We(De(b,["prevent"]),["enter"])},null,40,hr),[[le,t.modelInput]]),e("button",{class:"rounded-lg bg-red-500 px-4 py-2 text-white transition-colors hover:bg-red-600",type:"button",onClick:b},a[90]||(a[90]=[e("i",{class:"fas fa-plus"},null,-1)]))])]),a[92]||(a[92]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 设置此API Key无法访问的模型，例如：claude-opus-4-20250514 ",-1))])])):F("",!0)]),e("div",null,[e("div",Cr,[B(e("input",{id:"editEnableClientRestriction","onUpdate:modelValue":a[37]||(a[37]=i=>t.enableClientRestriction=i),class:"h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700",type:"checkbox"},null,512),[[Se,t.enableClientRestriction]]),a[93]||(a[93]=e("label",{class:"ml-2 cursor-pointer text-sm font-semibold text-gray-700 dark:text-gray-300",for:"editEnableClientRestriction"}," 启用客户端限制 ",-1))]),t.enableClientRestriction?(r(),y("div",Ir,[e("div",null,[a[94]||(a[94]=e("label",{class:"mb-2 block text-sm font-medium text-gray-600 dark:text-gray-400"},"允许的客户端",-1)),a[95]||(a[95]=e("p",{class:"mb-3 text-xs text-gray-500 dark:text-gray-400"}," 勾选允许使用此API Key的客户端 ",-1)),e("div",Kr,[(r(!0),y(X,null,ie(K.value,i=>(r(),y("div",{key:i.id,class:"flex items-start"},[B(e("input",{id:`edit_client_${i.id}`,"onUpdate:modelValue":a[38]||(a[38]=Z=>t.allowedClients=Z),class:"mt-0.5 h-4 w-4 rounded border-gray-300 bg-gray-100 text-blue-600 focus:ring-blue-500",type:"checkbox",value:i.id},null,8,Lr),[[Se,t.allowedClients]]),e("label",{class:"ml-2 flex-1 cursor-pointer",for:`edit_client_${i.id}`},[e("span",_r,v(i.name),1),e("span",Vr,v(i.description),1)],8,Dr)]))),128))])])])):F("",!0)]),e("div",Sr,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:a[39]||(a[39]=i=>x.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:p.value,type:"submit"},[p.value?(r(),y("div",Rr)):(r(),y("i",Er)),E(" "+v(p.value?"保存中...":"保存修改"),1)],8,Mr)])],32)])),[[L,M.value]])])])}}},Ur=xe(Tr,[["__scopeId","data-v-274d033f"]]),Pr={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},Or={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-md flex-col p-8"},Gr={class:"mb-6 flex items-center justify-between"},qr={class:"modal-scroll-content custom-scrollbar flex-1 space-y-6"},jr={class:"rounded-lg border border-blue-200 bg-blue-50 p-4"},Br={class:"flex items-start gap-3"},zr={class:"text-sm text-gray-700"},Fr={class:"mt-1 text-xs text-gray-600"},Wr={key:0,class:"mt-3"},Nr=["min"],Hr={key:1,class:"mt-2 text-xs text-gray-500"},Yr={class:"flex gap-3 pt-4"},Qr=["disabled"],Jr={key:0,class:"loading-spinner mr-2"},Zr={key:1,class:"fas fa-clock mr-2"},Xr={__name:"RenewApiKeyModal",props:{apiKey:{type:Object,required:!0}},emits:["close","success"],setup(m,{emit:O}){const o=m,S=O,I=V(!1),p=Pe({renewDuration:"30d",customExpireDate:"",newExpiresAt:null}),M=Q(()=>{const d=new Date;return o.apiKey.expiresAt&&new Date(o.apiKey.expiresAt)>d?new Date(o.apiKey.expiresAt).toISOString().slice(0,16):(d.setMinutes(d.getMinutes()+1),d.toISOString().slice(0,16))}),R=d=>new Date(d).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),_=()=>{if(!p.renewDuration){p.newExpiresAt=null;return}if(p.renewDuration==="permanent"){p.newExpiresAt=null;return}if(p.renewDuration==="custom")return;const d=o.apiKey.expiresAt&&new Date(o.apiKey.expiresAt)>new Date?new Date(o.apiKey.expiresAt):new Date,n=p.renewDuration.match(/(\d+)([dhmy])/);if(n){const[,t,b]=n,g=parseInt(t);switch(b){case"d":d.setDate(d.getDate()+g);break;case"h":d.setHours(d.getHours()+g);break;case"m":d.setMonth(d.getMonth()+g);break;case"y":d.setFullYear(d.getFullYear()+g);break}p.newExpiresAt=d.toISOString()}},K=()=>{p.customExpireDate&&(p.newExpiresAt=new Date(p.customExpireDate).toISOString())},k=async()=>{I.value=!0;try{const d={expiresAt:p.renewDuration==="permanent"?null:p.newExpiresAt},u=await oe.put(`/admin/api-keys/${o.apiKey.id}`,d);u.success?(W("API Key 续期成功","success"),S("success"),S("close")):W(u.message||"续期失败","error")}catch{W("续期失败","error")}finally{I.value=!1}};return _(),(d,u)=>(r(),J(he,{to:"body"},[e("div",Pr,[e("div",Or,[e("div",Gr,[u[5]||(u[5]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-green-600"},[e("i",{class:"fas fa-clock text-white"})]),e("h3",{class:"text-xl font-bold text-gray-900"},"续期 API Key")],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600",onClick:u[0]||(u[0]=n=>d.$emit("close"))},u[4]||(u[4]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",qr,[e("div",jr,[e("div",Br,[u[7]||(u[7]=e("div",{class:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-lg bg-blue-500"},[e("i",{class:"fas fa-info text-sm text-white"})],-1)),e("div",null,[u[6]||(u[6]=e("h4",{class:"mb-1 font-semibold text-gray-800"},"API Key 信息",-1)),e("p",zr,v(m.apiKey.name),1),e("p",Fr," 当前过期时间："+v(m.apiKey.expiresAt?R(m.apiKey.expiresAt):"永不过期"),1)])])]),e("div",null,[u[9]||(u[9]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700"},"续期时长",-1)),B(e("select",{"onUpdate:modelValue":u[1]||(u[1]=n=>p.renewDuration=n),class:"form-input w-full",onChange:_},u[8]||(u[8]=[e("option",{value:"7d"},"延长 7 天",-1),e("option",{value:"30d"},"延长 30 天",-1),e("option",{value:"90d"},"延长 90 天",-1),e("option",{value:"180d"},"延长 180 天",-1),e("option",{value:"365d"},"延长 365 天",-1),e("option",{value:"custom"},"自定义日期",-1),e("option",{value:"permanent"},"设为永不过期",-1)]),544),[[Ae,p.renewDuration]]),p.renewDuration==="custom"?(r(),y("div",Wr,[B(e("input",{"onUpdate:modelValue":u[2]||(u[2]=n=>p.customExpireDate=n),class:"form-input w-full",min:M.value,type:"datetime-local",onChange:K},null,40,Nr),[[le,p.customExpireDate]])])):F("",!0),p.newExpiresAt?(r(),y("p",Hr," 新的过期时间："+v(R(p.newExpiresAt)),1)):F("",!0)])]),e("div",Yr,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200",type:"button",onClick:u[3]||(u[3]=n=>d.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:I.value||!p.renewDuration,type:"button",onClick:k},[I.value?(r(),y("div",Jr)):(r(),y("i",Zr)),E(" "+v(I.value?"续期中...":"确认续期"),1)],8,Qr)])])])]))}},ei=xe(Xr,[["__scopeId","data-v-2fba52a3"]]),ti={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},ai={class:"modal-content custom-scrollbar mx-auto max-h-[90vh] w-full max-w-lg overflow-y-auto p-8"},si={class:"mb-6 space-y-4"},oi={class:"rounded-lg border border-gray-200 bg-gray-50 p-3 dark:border-gray-600 dark:bg-gray-800"},li={class:"font-medium text-gray-900 dark:text-gray-100"},ri={key:0},ii={class:"rounded-lg border border-gray-200 bg-gray-50 p-3 dark:border-gray-600 dark:bg-gray-800"},ni={class:"text-gray-700 dark:text-gray-300"},di={class:"relative"},ui={class:"flex min-h-[60px] items-center break-all rounded-lg border border-gray-700 bg-gray-900 p-4 pr-14 font-mono text-sm text-white dark:border-gray-600 dark:bg-gray-900"},ci={class:"absolute right-3 top-3"},pi=["title"],mi={__name:"NewApiKeyModal",props:{apiKey:{type:Object,required:!0}},emits:["close"],setup(m,{emit:O}){const o=m,S=O,I=V(!1),p=()=>{if(typeof window<"u"){const b=window.location.protocol,g=window.location.host;let q=b+"//"+g;const $=window.location.href,A=$.indexOf("/",8);return A!==-1&&(q=$.substring(0,A)),q}return""},M=Wt(),R=Q(()=>M.oemSettings||{}),_=Q(()=>{const b=(R.value.tutorialUrl||"").trim();return b||p()}),K=()=>{I.value=!I.value},k=()=>{const b=o.apiKey.apiKey||o.apiKey.key||"";return b?I.value||b.length<=12?b:b.substring(0,8)+"●".repeat(Math.max(0,b.length-12))+b.substring(b.length-4):""},d=b=>{const g=(R.value.copyInfoTemplate||"").trim(),q=_.value;return g?g.replace(/\{siteUrl\}/g,q).replace(/\{apiKey\}/g,b):`您可以通过访问 "${q}" 查看使用教程和查看您的使用情况。
您的API Key是：${b}`},u=async()=>{const b=o.apiKey.apiKey||o.apiKey.key||"";if(!b){W("API Key 不存在","error");return}const g=d(b);try{await navigator.clipboard.writeText(g),W("配置信息已复制到剪贴板","success")}catch{const $=document.createElement("textarea");$.value=g,document.body.appendChild($),$.select();try{document.execCommand("copy"),W("配置信息已复制到剪贴板","success")}catch{W("复制失败，请手动复制","error")}finally{document.body.removeChild($)}}},n=async()=>{window.showConfirm?await window.showConfirm("关闭提醒",`关闭后将无法再次查看完整的API Key，请确保已经妥善保存。

确定要关闭吗？`,"确定关闭","取消")&&S("close"):confirm(`关闭后将无法再次查看完整的API Key，请确保已经妥善保存。

确定要关闭吗？`)&&S("close")},t=async()=>{window.showConfirm?await window.showConfirm("确定要关闭吗？",`您还没有保存API Key，关闭后将无法再次查看。

建议您先复制API Key再关闭。`,"仍然关闭","返回复制")&&S("close"):confirm(`您还没有保存API Key，关闭后将无法再次查看。

确定要关闭吗？`)&&S("close")};return(b,g)=>(r(),J(he,{to:"body"},[e("div",ti,[e("div",ai,[e("div",{class:"mb-6 flex items-center justify-between"},[g[1]||(g[1]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-green-600"},[e("i",{class:"fas fa-check text-lg text-white"})]),e("div",null,[e("h3",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"API Key 创建成功"),e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"请妥善保存您的 API Key")])],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"直接关闭（不推荐）",onClick:t},g[0]||(g[0]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),g[7]||(g[7]=e("div",{class:"mb-6 border-l-4 border-amber-400 bg-amber-50 p-4 dark:border-amber-500 dark:bg-amber-900/20"},[e("div",{class:"flex items-start"},[e("div",{class:"mt-0.5 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-lg bg-amber-400 dark:bg-amber-500"},[e("i",{class:"fas fa-exclamation-triangle text-sm text-white"})]),e("div",{class:"ml-3"},[e("h5",{class:"mb-1 font-semibold text-amber-900 dark:text-amber-400"},"重要提醒"),e("p",{class:"text-sm text-amber-800 dark:text-amber-300"}," 这是您唯一能看到完整 API Key 的机会。关闭此窗口后，系统将不再显示完整的 API Key。请立即复制并妥善保存。 ")])])],-1)),e("div",si,[e("div",null,[g[2]||(g[2]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"API Key 名称",-1)),e("div",oi,[e("span",li,v(m.apiKey.name),1)])]),m.apiKey.description?(r(),y("div",ri,[g[3]||(g[3]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"备注",-1)),e("div",ii,[e("span",ni,v(m.apiKey.description||"无描述"),1)])])):F("",!0),e("div",null,[g[4]||(g[4]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"API Key",-1)),e("div",di,[e("div",ui,v(k()),1),e("div",ci,[e("button",{class:"btn-icon-sm bg-gray-700 hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600",title:I.value?"隐藏API Key":"显示完整API Key",type:"button",onClick:K},[e("i",{class:ne(["fas",I.value?"fa-eye-slash":"fa-eye","text-gray-300"])},null,2)],8,pi)])]),g[5]||(g[5]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 点击眼睛图标切换显示模式，使用下方按钮复制配置信息 ",-1))])]),e("div",{class:"flex gap-3"},[e("button",{class:"btn btn-primary flex flex-1 items-center justify-center gap-2 px-6 py-3 font-semibold",onClick:u},g[6]||(g[6]=[e("i",{class:"fas fa-copy"},null,-1),E(" 复制配置信息 ",-1)])),e("button",{class:"rounded-xl border border-gray-300 bg-gray-200 px-6 py-3 font-semibold text-gray-800 transition-colors hover:bg-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600",onClick:n}," 我已保存 ")])])])]))}},gi=xe(mi,[["__scopeId","data-v-68bfed1f"]]),yi={class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},fi={class:"modal-content custom-scrollbar mx-auto max-h-[90vh] w-full max-w-2xl overflow-y-auto p-8"},bi={class:"mb-6 flex items-center justify-between"},xi={class:"flex items-center gap-3"},vi={class:"text-sm text-gray-600"},ki={class:"mb-6 grid grid-cols-2 gap-4 md:grid-cols-4"},wi={class:"rounded-lg border border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100 p-4"},Ai={class:"flex items-center justify-between"},$i={class:"mt-1 text-2xl font-bold text-blue-900"},hi={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-green-100 p-4"},Ci={class:"flex items-center justify-between"},Ii={class:"mt-1 truncate text-lg font-bold text-green-900"},Ki={class:"rounded-lg border border-purple-200 bg-gradient-to-br from-purple-50 to-purple-100 p-4"},Li={class:"flex items-center justify-between"},Di={class:"mt-1 text-lg font-bold text-purple-900"},_i={class:"rounded-lg border border-orange-200 bg-gradient-to-br from-orange-50 to-orange-100 p-4"},Vi={class:"flex items-center justify-between"},Si={class:"mt-1 text-lg font-bold text-orange-900"},Mi={class:"mb-6"},Ri={class:"mb-3 flex items-center justify-between"},Ei={class:"flex items-center gap-2"},Ti={key:0,class:"custom-scrollbar max-h-48 overflow-y-auto rounded-lg bg-gray-900 p-4"},Ui={class:"font-mono text-xs text-gray-300"},Pi={__name:"BatchApiKeyModal",props:{apiKeys:{type:Array,required:!0}},emits:["close"],setup(m,{emit:O}){const o=m,S=O,I=V(!1),p=Q(()=>{if(o.apiKeys.length>0){const n=o.apiKeys[0],t=n.name.match(/^(.+)_\d+$/);return t?t[1]:n.name}return""}),M=()=>{if(o.apiKeys.length===0)return"未知";const n=o.apiKeys[0].permissions;return{all:"全部服务",claude:"仅 Claude",gemini:"仅 Gemini"}[n]||n},R=()=>{if(o.apiKeys.length===0)return"未知";const n=o.apiKeys[0].expiresAt;if(!n)return"永不过期";const t=new Date(n),g=Math.ceil((t-new Date)/(1e3*60*60*24));return g<=7?`${g}天`:g<=30?`${Math.ceil(g/7)}周`:g<=365?`${Math.ceil(g/30)}个月`:`${Math.ceil(g/365)}年`},_=()=>{I.value=!I.value},K=()=>{const t=o.apiKeys.slice(0,10).map(b=>`${b.name}: ${b.apiKey||b.key||""}`);return o.apiKeys.length>10&&t.push(`... 还有 ${o.apiKeys.length-10} 个 API Key`),t.join(`
`)},k=()=>{const n=o.apiKeys.map($=>`${$.name}: ${$.apiKey||$.key||""}`).join(`
`),t=new Blob([n],{type:"text/plain;charset=utf-8"}),b=URL.createObjectURL(t),g=document.createElement("a");g.href=b;const q=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);g.download=`api-keys-${p.value}-${q}.txt`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(b),W("API Keys 文件已下载","success")},d=async()=>{window.showConfirm?await window.showConfirm("关闭提醒",`关闭后将无法再次查看这些 API Key，请确保已经下载并妥善保存。

确定要关闭吗？`,"确定关闭","返回下载")&&S("close"):confirm(`关闭后将无法再次查看这些 API Key，请确保已经下载并妥善保存。

确定要关闭吗？`)&&S("close")},u=async()=>{window.showConfirm?await window.showConfirm("确定要关闭吗？",`您还没有下载 API Keys，关闭后将无法再次查看。

强烈建议您先下载保存。`,"仍然关闭","返回下载")&&S("close"):confirm(`您还没有下载 API Keys，关闭后将无法再次查看。

确定要关闭吗？`)&&S("close")};return(n,t)=>(r(),J(he,{to:"body"},[e("div",yi,[e("div",fi,[e("div",bi,[e("div",xi,[t[1]||(t[1]=e("div",{class:"flex h-12 w-12 items-center justify-center rounded-xl bg-gradient-to-br from-green-500 to-green-600"},[e("i",{class:"fas fa-layer-group text-lg text-white"})],-1)),e("div",null,[t[0]||(t[0]=e("h3",{class:"text-xl font-bold text-gray-900"},"批量创建成功",-1)),e("p",vi,"成功创建 "+v(m.apiKeys.length)+" 个 API Key",1)])]),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600",title:"直接关闭（不推荐）",onClick:u},t[2]||(t[2]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),t[14]||(t[14]=e("div",{class:"mb-6 border-l-4 border-amber-400 bg-amber-50 p-4"},[e("div",{class:"flex items-start"},[e("div",{class:"mt-0.5 flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-lg bg-amber-400"},[e("i",{class:"fas fa-exclamation-triangle text-sm text-white"})]),e("div",{class:"ml-3"},[e("h5",{class:"mb-1 font-semibold text-amber-900"},"重要提醒"),e("p",{class:"text-sm text-amber-800"}," 这是您唯一能看到所有 API Key 的机会。关闭此窗口后，系统将不再显示完整的 API Key。请立即下载并妥善保存。 ")])])],-1)),e("div",ki,[e("div",wi,[e("div",Ai,[e("div",null,[t[3]||(t[3]=e("p",{class:"text-xs font-medium text-blue-600"},"创建数量",-1)),e("p",$i,v(m.apiKeys.length),1)]),t[4]||(t[4]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-500 bg-opacity-20"},[e("i",{class:"fas fa-key text-blue-600"})],-1))])]),e("div",hi,[e("div",Ci,[e("div",null,[t[5]||(t[5]=e("p",{class:"text-xs font-medium text-green-600"},"基础名称",-1)),e("p",Ii,v(p.value),1)]),t[6]||(t[6]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-green-500 bg-opacity-20"},[e("i",{class:"fas fa-tag text-green-600"})],-1))])]),e("div",Ki,[e("div",Li,[e("div",null,[t[7]||(t[7]=e("p",{class:"text-xs font-medium text-purple-600"},"权限范围",-1)),e("p",Di,v(M()),1)]),t[8]||(t[8]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-purple-500 bg-opacity-20"},[e("i",{class:"fas fa-shield-alt text-purple-600"})],-1))])]),e("div",_i,[e("div",Vi,[e("div",null,[t[9]||(t[9]=e("p",{class:"text-xs font-medium text-orange-600"},"过期时间",-1)),e("p",Si,v(R()),1)]),t[10]||(t[10]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-orange-500 bg-opacity-20"},[e("i",{class:"fas fa-clock text-orange-600"})],-1))])])]),e("div",Mi,[e("div",Ri,[t[12]||(t[12]=e("label",{class:"text-sm font-semibold text-gray-700"},"API Keys 预览",-1)),e("div",Ei,[e("button",{class:"flex items-center gap-1 text-xs text-blue-600 hover:text-blue-800",type:"button",onClick:_},[e("i",{class:ne(["fas",I.value?"fa-eye-slash":"fa-eye"])},null,2),E(" "+v(I.value?"隐藏":"显示")+"预览 ",1)]),t[11]||(t[11]=e("span",{class:"text-xs text-gray-500"},"（最多显示前10个）",-1))])]),I.value?(r(),y("div",Ti,[e("pre",Ui,v(K()),1)])):F("",!0)]),e("div",{class:"flex gap-3"},[e("button",{class:"btn btn-primary flex flex-1 items-center justify-center gap-2 px-6 py-3 font-semibold",onClick:k},t[13]||(t[13]=[e("i",{class:"fas fa-download"},null,-1),E(" 下载所有 API Keys ",-1)])),e("button",{class:"rounded-xl border border-gray-300 bg-gray-200 px-6 py-3 font-semibold text-gray-800 transition-colors hover:bg-gray-300",onClick:d}," 我已保存 ")]),t[15]||(t[15]=e("div",{class:"mt-4 rounded-lg border border-blue-200 bg-blue-50 p-3"},[e("p",{class:"flex items-start text-xs text-blue-700"},[e("i",{class:"fas fa-info-circle mr-2 mt-0.5 flex-shrink-0"}),e("span",null," 下载的文件格式为文本文件（.txt），每行包含一个 API Key。 请将文件保存在安全的位置，避免泄露。 ")])],-1))])])]))}},Oi=xe(Pi,[["__scopeId","data-v-b0b904b9"]]),Gi={class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},qi={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-4xl flex-col p-4 sm:p-6 md:p-8"},ji={class:"mb-4 flex items-center justify-between sm:mb-6"},Bi={class:"flex items-center gap-2 sm:gap-3"},zi={class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"},Fi={class:"rounded-lg bg-blue-50 p-4 dark:bg-blue-900/20"},Wi={class:"flex items-start gap-3"},Ni={class:"mt-1 text-sm text-blue-700 dark:text-blue-400"},Hi={class:"space-y-4"},Yi={class:"flex flex-wrap gap-4"},Qi={class:"flex cursor-pointer items-center"},Ji={class:"flex cursor-pointer items-center"},Zi={class:"flex cursor-pointer items-center"},Xi={class:"flex cursor-pointer items-center"},en={key:0,class:"space-y-3"},tn={key:0},an={class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"},sn={class:"flex flex-wrap gap-2"},on=["onClick"],ln={key:1},rn={class:"flex flex-wrap gap-2"},nn=["onClick"],dn={class:"flex gap-2"},un=["onKeypress"],cn={class:"rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-700 dark:bg-blue-900/20"},pn={class:"space-y-2"},mn={class:"grid grid-cols-1 gap-2 lg:grid-cols-3"},gn={class:"mb-3 flex items-center gap-4"},yn={class:"flex gap-4"},fn={class:"flex cursor-pointer items-center"},bn={class:"flex cursor-pointer items-center"},xn={class:"flex cursor-pointer items-center"},vn={class:"flex flex-wrap gap-4"},kn={class:"flex cursor-pointer items-center"},wn={class:"flex cursor-pointer items-center"},An={class:"flex cursor-pointer items-center"},$n={class:"flex cursor-pointer items-center"},hn={class:"flex cursor-pointer items-center"},Cn={class:"flex cursor-pointer items-center"},In={class:"mb-3 flex items-center justify-between"},Kn=["disabled"],Ln={class:"grid grid-cols-1 gap-3"},Dn=["disabled"],_n={key:0,label:"账号分组"},Vn=["value"],Sn={key:1,label:"专属账号"},Mn=["value"],Rn=["disabled"],En={key:0,label:"账号分组"},Tn=["value"],Un={key:1,label:"专属账号"},Pn=["value"],On=["disabled"],Gn={key:0,label:"账号分组"},qn=["value"],jn={key:1,label:"专属账号"},Bn=["value"],zn=["disabled"],Fn={key:0,label:"专属账号"},Wn=["value"],Nn=["disabled"],Hn={key:0,label:"账号分组"},Yn=["value"],Qn={key:1,label:"专属账号"},Jn=["value"],Zn={class:"flex gap-3 pt-4"},Xn=["disabled"],ed={key:0,class:"loading-spinner mr-2"},td={key:1,class:"fas fa-save mr-2"},ad={__name:"BatchEditApiKeyModal",props:{selectedKeys:{type:Array,required:!0},accounts:{type:Object,default:()=>({claude:[],gemini:[],openai:[],bedrock:[],droid:[],claudeGroups:[],geminiGroups:[],openaiGroups:[],droidGroups:[]})}},emits:["close","success"],setup(m,{emit:O}){const o=m,S=O,I=Yt(),p=V(!1),M=V(!1),R=V({claude:[],gemini:[],openai:[],bedrock:[],droid:[],claudeGroups:[],geminiGroups:[],openaiGroups:[],droidGroups:[]}),_=V(""),K=V([]),k=V("none"),d=Q(()=>o.selectedKeys.length),u=Q(()=>K.value.filter(A=>!n.tags.includes(A))),n=Pe({rateLimitCost:"",rateLimitWindow:"",rateLimitRequests:"",concurrencyLimit:"",dailyCostLimit:"",totalCostLimit:"",weeklyOpusCostLimit:"",permissions:"",claudeAccountId:"",geminiAccountId:"",openaiAccountId:"",bedrockAccountId:"",droidAccountId:"",tags:[],isActive:null}),t=()=>{if(_.value&&_.value.trim()){const A=_.value.trim();n.tags.includes(A)||n.tags.push(A),_.value=""}},b=A=>{n.tags.includes(A)||n.tags.push(A)},g=A=>{n.tags.splice(A,1)},q=async()=>{var A,l,C,N,T,ee,se,x,a,L,i,Z;M.value=!0;try{if(o.accounts&&((A=o.accounts.claude)!=null&&A.length||(l=o.accounts.openai)!=null&&l.length||(C=o.accounts.gemini)!=null&&C.length||(N=o.accounts.bedrock)!=null&&N.length||(T=o.accounts.droid)!=null&&T.length)){const U=[];(o.accounts.openai||[]).forEach(s=>U.push({...s,platform:"openai",isDedicated:s.accountType==="dedicated"})),R.value={claude:(o.accounts.claude||[]).map(s=>({...s,isDedicated:s.accountType==="dedicated"})),gemini:(o.accounts.gemini||[]).map(s=>({...s,isDedicated:s.accountType==="dedicated"})),openai:U,bedrock:(o.accounts.bedrock||[]).map(s=>({...s,isDedicated:s.accountType==="dedicated"})),droid:(o.accounts.droid||[]).map(s=>({...s,platform:"droid",isDedicated:s.accountType==="dedicated"})),claudeGroups:o.accounts.claudeGroups||[],geminiGroups:o.accounts.geminiGroups||[],openaiGroups:o.accounts.openaiGroups||[],droidGroups:o.accounts.droidGroups||[]}}else{const U=await oe.get("/admin/accounts/aggregated",{params:{fields:"summary",compact:"true"}});if(!(U!=null&&U.success))throw new Error("failed");const s=[];if((ee=U.data)!=null&&ee.claudeAccounts&&U.data.claudeAccounts.forEach(f=>{s.push({...f,platform:"claude-oauth",isDedicated:f.accountType==="dedicated"})}),(se=U.data)!=null&&se.claudeConsoleAccounts&&U.data.claudeConsoleAccounts.forEach(f=>{s.push({...f,platform:"claude-console",isDedicated:f.accountType==="dedicated"})}),R.value.claude=s,(x=U.data)!=null&&x.geminiAccounts&&(R.value.gemini=(U.data.geminiAccounts||[]).map(f=>({...f,isDedicated:f.accountType==="dedicated"}))),(a=U.data)!=null&&a.openaiAccounts&&(R.value.openai=(U.data.openaiAccounts||[]).map(f=>({...f,isDedicated:f.accountType==="dedicated"}))),(L=U.data)!=null&&L.bedrockAccounts&&(R.value.bedrock=(U.data.bedrockAccounts||[]).map(f=>({...f,isDedicated:f.accountType==="dedicated"}))),(i=U.data)!=null&&i.droidAccounts&&(R.value.droid=(U.data.droidAccounts||[]).map(f=>({...f,platform:"droid",isDedicated:f.accountType==="dedicated"}))),(Z=U.data)!=null&&Z.accountGroups){const f=U.data.accountGroups||[];R.value.claudeGroups=f.filter(te=>te.platform==="claude"),R.value.geminiGroups=f.filter(te=>te.platform==="gemini"),R.value.openaiGroups=f.filter(te=>te.platform==="openai"),R.value.droidGroups=f.filter(te=>te.platform==="droid")}}W("账号列表已刷新","success")}catch{W("刷新账号列表失败","error")}finally{M.value=!1}},$=async()=>{p.value=!0;try{const A={};n.rateLimitCost!==""&&n.rateLimitCost!==null&&(A.rateLimitCost=parseFloat(n.rateLimitCost)),n.rateLimitWindow!==""&&n.rateLimitWindow!==null&&(A.rateLimitWindow=parseInt(n.rateLimitWindow)),n.rateLimitRequests!==""&&n.rateLimitRequests!==null&&(A.rateLimitRequests=parseInt(n.rateLimitRequests)),n.concurrencyLimit!==""&&n.concurrencyLimit!==null&&(A.concurrencyLimit=parseInt(n.concurrencyLimit)),n.dailyCostLimit!==""&&n.dailyCostLimit!==null&&(A.dailyCostLimit=parseFloat(n.dailyCostLimit)),n.totalCostLimit!==""&&n.totalCostLimit!==null&&(A.totalCostLimit=parseFloat(n.totalCostLimit)),n.weeklyOpusCostLimit!==""&&n.weeklyOpusCostLimit!==null&&(A.weeklyOpusCostLimit=parseFloat(n.weeklyOpusCostLimit)),n.permissions!==""&&(A.permissions=n.permissions),n.claudeAccountId!==""&&(n.claudeAccountId==="SHARED_POOL"?(A.claudeAccountId=null,A.claudeConsoleAccountId=null):n.claudeAccountId.startsWith("console:")?(A.claudeConsoleAccountId=n.claudeAccountId.substring(8),A.claudeAccountId=null):(n.claudeAccountId.startsWith("group:"),A.claudeAccountId=n.claudeAccountId,A.claudeConsoleAccountId=null)),n.geminiAccountId!==""&&(n.geminiAccountId==="SHARED_POOL"?A.geminiAccountId=null:A.geminiAccountId=n.geminiAccountId),n.openaiAccountId!==""&&(n.openaiAccountId==="SHARED_POOL"?A.openaiAccountId=null:A.openaiAccountId=n.openaiAccountId),n.bedrockAccountId!==""&&(n.bedrockAccountId==="SHARED_POOL"?A.bedrockAccountId=null:A.bedrockAccountId=n.bedrockAccountId),n.droidAccountId!==""&&(n.droidAccountId==="SHARED_POOL"?A.droidAccountId=null:A.droidAccountId=n.droidAccountId),n.isActive!==null&&(A.isActive=n.isActive),k.value!=="none"&&(A.tags=n.tags,A.tagOperation=k.value);const l=await oe.put("/admin/api-keys/batch",{keyIds:o.selectedKeys,updates:A});if(l.success){const{successCount:C,failedCount:N,errors:T}=l.data;if(C>0){if(W(`成功批量编辑 ${C} 个 API Keys`,"success"),N>0){const ee=T.map(se=>`${se.keyId}: ${se.error}`).join(`
`);W(`${N} 个编辑失败:
${ee}`,"warning")}}else W("所有 API Keys 编辑失败","error");S("success"),S("close")}else W(l.message||"批量编辑失败","error")}catch(A){W("批量编辑失败","error"),console.error("批量编辑 API Keys 失败:",A)}finally{p.value=!1}};return Ue(async()=>{K.value=await I.fetchTags(),o.accounts&&(R.value={claude:o.accounts.claude||[],gemini:o.accounts.gemini||[],openai:o.accounts.openai||[],bedrock:o.accounts.bedrock||[],droid:o.accounts.droid||[],claudeGroups:o.accounts.claudeGroups||[],geminiGroups:o.accounts.geminiGroups||[],openaiGroups:o.accounts.openaiGroups||[],droidGroups:o.accounts.droidGroups||[]})}),(A,l)=>(r(),J(he,{to:"body"},[e("div",Gi,[e("div",qi,[e("div",ji,[e("div",Bi,[l[28]||(l[28]=e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-edit text-sm text-white sm:text-base"})],-1)),e("h3",zi," 批量编辑 API Keys ("+v(d.value)+" 个) ",1)]),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600 dark:hover:text-gray-300",onClick:l[0]||(l[0]=C=>A.$emit("close"))},l[29]||(l[29]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)]))]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-4 sm:space-y-6",onSubmit:De($,["prevent"])},[e("div",Fi,[e("div",Wi,[l[31]||(l[31]=e("i",{class:"fas fa-info-circle mt-1 text-blue-500"},null,-1)),e("div",null,[l[30]||(l[30]=e("p",{class:"text-sm font-medium text-blue-800 dark:text-blue-300"},"批量编辑说明",-1)),e("p",Ni," 以下设置将应用到所选的 "+v(d.value)+" 个 API Key。只有填写或修改的字段才会被更新，空白字段将保持原值不变。 ",1)])])]),e("div",null,[l[41]||(l[41]=e("label",{class:"mb-1.5 block text-xs font-semibold text-gray-700 dark:text-gray-300 sm:mb-3 sm:text-sm"}," 标签 (批量操作) ",-1)),e("div",Hi,[e("div",Yi,[e("label",Qi,[B(e("input",{"onUpdate:modelValue":l[1]||(l[1]=C=>k.value=C),class:"mr-2",type:"radio",value:"replace"},null,512),[[ue,k.value]]),l[32]||(l[32]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"替换标签",-1))]),e("label",Ji,[B(e("input",{"onUpdate:modelValue":l[2]||(l[2]=C=>k.value=C),class:"mr-2",type:"radio",value:"add"},null,512),[[ue,k.value]]),l[33]||(l[33]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"添加标签",-1))]),e("label",Zi,[B(e("input",{"onUpdate:modelValue":l[3]||(l[3]=C=>k.value=C),class:"mr-2",type:"radio",value:"remove"},null,512),[[ue,k.value]]),l[34]||(l[34]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"移除标签",-1))]),e("label",Xi,[B(e("input",{"onUpdate:modelValue":l[4]||(l[4]=C=>k.value=C),class:"mr-2",type:"radio",value:"none"},null,512),[[ue,k.value]]),l[35]||(l[35]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"不修改标签",-1))])]),k.value!=="none"?(r(),y("div",en,[n.tags.length>0?(r(),y("div",tn,[e("div",an,v(k.value==="replace"?"新标签列表:":k.value==="add"?"要添加的标签:":"要移除的标签:"),1),e("div",sn,[(r(!0),y(X,null,ie(n.tags,(C,N)=>(r(),y("span",{key:"selected-"+N,class:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"},[E(v(C)+" ",1),e("button",{class:"ml-1 hover:text-blue-900",type:"button",onClick:T=>g(N)},l[36]||(l[36]=[e("i",{class:"fas fa-times text-xs"},null,-1)]),8,on)]))),128))])])):F("",!0),u.value.length>0?(r(),y("div",ln,[l[38]||(l[38]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 点击选择已有标签: ",-1)),e("div",rn,[(r(!0),y(X,null,ie(u.value,C=>(r(),y("button",{key:"available-"+C,class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 transition-colors hover:bg-blue-100 hover:text-blue-700 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-blue-900/30 dark:hover:text-blue-300",type:"button",onClick:N=>b(C)},[l[37]||(l[37]=e("i",{class:"fas fa-tag text-xs text-gray-500 dark:text-gray-400"},null,-1)),E(" "+v(C),1)],8,nn))),128))])])):F("",!0),e("div",null,[l[40]||(l[40]=e("div",{class:"mb-2 text-xs font-medium text-gray-600 dark:text-gray-400"}," 创建新标签: ",-1)),e("div",dn,[B(e("input",{"onUpdate:modelValue":l[5]||(l[5]=C=>_.value=C),class:"form-input flex-1 border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",placeholder:"输入新标签名称",type:"text",onKeypress:We(De(t,["prevent"]),["enter"])},null,40,un),[[le,_.value]]),e("button",{class:"rounded-lg bg-green-500 px-4 py-2 text-white transition-colors hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700",type:"button",onClick:t},l[39]||(l[39]=[e("i",{class:"fas fa-plus"},null,-1)]))])])])):F("",!0)])]),e("div",cn,[l[45]||(l[45]=e("div",{class:"mb-2 flex items-center gap-2"},[e("div",{class:"flex h-6 w-6 flex-shrink-0 items-center justify-center rounded bg-blue-500"},[e("i",{class:"fas fa-tachometer-alt text-xs text-white"})]),e("h4",{class:"text-sm font-semibold text-gray-800 dark:text-gray-200"},"速率限制设置")],-1)),e("div",pn,[e("div",mn,[e("div",null,[l[42]||(l[42]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"}," 时间窗口 (分钟) ",-1)),B(e("input",{"onUpdate:modelValue":l[6]||(l[6]=C=>n.rateLimitWindow=C),class:"form-input w-full border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"1",placeholder:"不修改",type:"number"},null,512),[[le,n.rateLimitWindow]])]),e("div",null,[l[43]||(l[43]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"请求次数限制",-1)),B(e("input",{"onUpdate:modelValue":l[7]||(l[7]=C=>n.rateLimitRequests=C),class:"form-input w-full border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"1",placeholder:"不修改",type:"number"},null,512),[[le,n.rateLimitRequests]])]),e("div",null,[l[44]||(l[44]=e("label",{class:"mb-1 block text-xs font-medium text-gray-700 dark:text-gray-300"},"费用限制 (美元)",-1)),B(e("input",{"onUpdate:modelValue":l[8]||(l[8]=C=>n.rateLimitCost=C),class:"form-input w-full border-gray-300 text-sm dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"0",placeholder:"不修改",step:"0.01",type:"number"},null,512),[[le,n.rateLimitCost]])])])])]),e("div",null,[l[46]||(l[46]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"}," 每日费用限制 (美元) ",-1)),B(e("input",{"onUpdate:modelValue":l[9]||(l[9]=C=>n.dailyCostLimit=C),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"0",placeholder:"不修改 (0 表示无限制)",step:"0.01",type:"number"},null,512),[[le,n.dailyCostLimit]])]),e("div",null,[l[47]||(l[47]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"}," 总费用限制 (美元) ",-1)),B(e("input",{"onUpdate:modelValue":l[10]||(l[10]=C=>n.totalCostLimit=C),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"0",placeholder:"不修改 (0 表示无限制)",step:"0.01",type:"number"},null,512),[[le,n.totalCostLimit]])]),e("div",null,[l[48]||(l[48]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"}," Opus 模型周费用限制 (美元) ",-1)),B(e("input",{"onUpdate:modelValue":l[11]||(l[11]=C=>n.weeklyOpusCostLimit=C),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"0",placeholder:"不修改 (0 表示无限制)",step:"0.01",type:"number"},null,512),[[le,n.weeklyOpusCostLimit]]),l[49]||(l[49]=e("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 设置 Opus 模型的周费用限制（周一到周日），仅限 Claude 官方账户 ",-1))]),e("div",null,[l[50]||(l[50]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"并发限制",-1)),B(e("input",{"onUpdate:modelValue":l[12]||(l[12]=C=>n.concurrencyLimit=C),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",min:"0",placeholder:"不修改 (0 表示无限制)",type:"number"},null,512),[[le,n.concurrencyLimit]])]),e("div",null,[e("div",gn,[l[54]||(l[54]=e("label",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"激活状态",-1)),e("div",yn,[e("label",fn,[B(e("input",{"onUpdate:modelValue":l[13]||(l[13]=C=>n.isActive=C),class:"mr-2",type:"radio",value:!0},null,512),[[ue,n.isActive]]),l[51]||(l[51]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"激活",-1))]),e("label",bn,[B(e("input",{"onUpdate:modelValue":l[14]||(l[14]=C=>n.isActive=C),class:"mr-2",type:"radio",value:!1},null,512),[[ue,n.isActive]]),l[52]||(l[52]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"禁用",-1))]),e("label",xn,[B(e("input",{"onUpdate:modelValue":l[15]||(l[15]=C=>n.isActive=C),class:"mr-2",type:"radio",value:null},null,512),[[ue,n.isActive]]),l[53]||(l[53]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"不修改",-1))])])])]),e("div",null,[l[61]||(l[61]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"服务权限",-1)),e("div",vn,[e("label",kn,[B(e("input",{"onUpdate:modelValue":l[16]||(l[16]=C=>n.permissions=C),class:"mr-2",type:"radio",value:""},null,512),[[ue,n.permissions]]),l[55]||(l[55]=e("span",{class:"text-sm text-gray-700"},"不修改",-1))]),e("label",wn,[B(e("input",{"onUpdate:modelValue":l[17]||(l[17]=C=>n.permissions=C),class:"mr-2",type:"radio",value:"all"},null,512),[[ue,n.permissions]]),l[56]||(l[56]=e("span",{class:"text-sm text-gray-700"},"全部服务",-1))]),e("label",An,[B(e("input",{"onUpdate:modelValue":l[18]||(l[18]=C=>n.permissions=C),class:"mr-2",type:"radio",value:"claude"},null,512),[[ue,n.permissions]]),l[57]||(l[57]=e("span",{class:"text-sm text-gray-700"},"仅 Claude",-1))]),e("label",$n,[B(e("input",{"onUpdate:modelValue":l[19]||(l[19]=C=>n.permissions=C),class:"mr-2",type:"radio",value:"gemini"},null,512),[[ue,n.permissions]]),l[58]||(l[58]=e("span",{class:"text-sm text-gray-700"},"仅 Gemini",-1))]),e("label",hn,[B(e("input",{"onUpdate:modelValue":l[20]||(l[20]=C=>n.permissions=C),class:"mr-2",type:"radio",value:"openai"},null,512),[[ue,n.permissions]]),l[59]||(l[59]=e("span",{class:"text-sm text-gray-700"},"仅 OpenAI",-1))]),e("label",Cn,[B(e("input",{"onUpdate:modelValue":l[21]||(l[21]=C=>n.permissions=C),class:"mr-2",type:"radio",value:"droid"},null,512),[[ue,n.permissions]]),l[60]||(l[60]=e("span",{class:"text-sm text-gray-700"},"仅 Droid",-1))])])]),e("div",null,[e("div",In,[l[62]||(l[62]=e("label",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"专属账号绑定",-1)),e("button",{class:"flex items-center gap-1 text-sm text-blue-600 transition-colors hover:text-blue-800 disabled:cursor-not-allowed disabled:opacity-50 dark:text-blue-400 dark:hover:text-blue-300",disabled:M.value,title:"刷新账号列表",type:"button",onClick:q},[e("i",{class:ne(["fas",M.value?"fa-spinner fa-spin":"fa-sync-alt","text-xs"])},null,2),e("span",null,v(M.value?"刷新中...":"刷新账号"),1)],8,Kn)]),e("div",Ln,[e("div",null,[l[65]||(l[65]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Claude 专属账号",-1)),B(e("select",{"onUpdate:modelValue":l[22]||(l[22]=C=>n.claudeAccountId=C),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:n.permissions&&!["all","claude"].includes(n.permissions)},[l[63]||(l[63]=e("option",{value:""},"不修改",-1)),l[64]||(l[64]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),R.value.claudeGroups.length>0?(r(),y("optgroup",_n,[(r(!0),y(X,null,ie(R.value.claudeGroups,C=>(r(),y("option",{key:C.id,value:`group:${C.id}`}," 分组 - "+v(C.name),9,Vn))),128))])):F("",!0),R.value.claude.length>0?(r(),y("optgroup",Sn,[(r(!0),y(X,null,ie(R.value.claude,C=>(r(),y("option",{key:C.id,value:C.platform==="claude-console"?`console:${C.id}`:C.id},v(C.name)+" ("+v(C.platform==="claude-console"?"Console":"OAuth")+") ",9,Mn))),128))])):F("",!0)],8,Dn),[[Ae,n.claudeAccountId]])]),e("div",null,[l[68]||(l[68]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Gemini 专属账号",-1)),B(e("select",{"onUpdate:modelValue":l[23]||(l[23]=C=>n.geminiAccountId=C),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:n.permissions&&!["all","gemini"].includes(n.permissions)},[l[66]||(l[66]=e("option",{value:""},"不修改",-1)),l[67]||(l[67]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),R.value.geminiGroups.length>0?(r(),y("optgroup",En,[(r(!0),y(X,null,ie(R.value.geminiGroups,C=>(r(),y("option",{key:C.id,value:`group:${C.id}`}," 分组 - "+v(C.name),9,Tn))),128))])):F("",!0),R.value.gemini.length>0?(r(),y("optgroup",Un,[(r(!0),y(X,null,ie(R.value.gemini,C=>(r(),y("option",{key:C.id,value:C.id},v(C.name),9,Pn))),128))])):F("",!0)],8,Rn),[[Ae,n.geminiAccountId]])]),e("div",null,[l[71]||(l[71]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"OpenAI 专属账号",-1)),B(e("select",{"onUpdate:modelValue":l[24]||(l[24]=C=>n.openaiAccountId=C),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:n.permissions&&!["all","openai"].includes(n.permissions)},[l[69]||(l[69]=e("option",{value:""},"不修改",-1)),l[70]||(l[70]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),R.value.openaiGroups.length>0?(r(),y("optgroup",Gn,[(r(!0),y(X,null,ie(R.value.openaiGroups,C=>(r(),y("option",{key:C.id,value:`group:${C.id}`}," 分组 - "+v(C.name),9,qn))),128))])):F("",!0),R.value.openai.length>0?(r(),y("optgroup",jn,[(r(!0),y(X,null,ie(R.value.openai,C=>(r(),y("option",{key:C.id,value:C.id},v(C.name),9,Bn))),128))])):F("",!0)],8,On),[[Ae,n.openaiAccountId]])]),e("div",null,[l[74]||(l[74]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Bedrock 专属账号",-1)),B(e("select",{"onUpdate:modelValue":l[25]||(l[25]=C=>n.bedrockAccountId=C),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:n.permissions&&!["all","openai"].includes(n.permissions)},[l[72]||(l[72]=e("option",{value:""},"不修改",-1)),l[73]||(l[73]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),R.value.bedrock.length>0?(r(),y("optgroup",Fn,[(r(!0),y(X,null,ie(R.value.bedrock,C=>(r(),y("option",{key:C.id,value:C.id},v(C.name),9,Wn))),128))])):F("",!0)],8,zn),[[Ae,n.bedrockAccountId]])]),e("div",null,[l[77]||(l[77]=e("label",{class:"mb-1 block text-sm font-medium text-gray-600 dark:text-gray-400"},"Droid 专属账号",-1)),B(e("select",{"onUpdate:modelValue":l[26]||(l[26]=C=>n.droidAccountId=C),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",disabled:n.permissions&&!["all","droid"].includes(n.permissions)},[l[75]||(l[75]=e("option",{value:""},"不修改",-1)),l[76]||(l[76]=e("option",{value:"SHARED_POOL"},"使用共享账号池",-1)),R.value.droidGroups.length>0?(r(),y("optgroup",Hn,[(r(!0),y(X,null,ie(R.value.droidGroups,C=>(r(),y("option",{key:C.id,value:`group:${C.id}`}," 分组 - "+v(C.name),9,Yn))),128))])):F("",!0),R.value.droid.length>0?(r(),y("optgroup",Qn,[(r(!0),y(X,null,ie(R.value.droid,C=>(r(),y("option",{key:C.id,value:C.id},v(C.name),9,Jn))),128))])):F("",!0)],8,Nn),[[Ae,n.droidAccountId]])])])]),e("div",Zn,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:l[27]||(l[27]=C=>A.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:p.value,type:"submit"},[p.value?(r(),y("div",ed)):(r(),y("i",td)),E(" "+v(p.value?"保存中...":"批量保存"),1)],8,Xn)])],32)])])]))}},sd=xe(ad,[["__scopeId","data-v-cd7fc1d8"]]),od={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-4"},ld={class:"modal-content relative mx-auto w-full max-w-lg p-8"},rd={class:"mb-6 flex items-center justify-between"},id={class:"flex items-center gap-3"},nd={class:"text-sm text-gray-600 dark:text-gray-400"},dd={class:"space-y-6"},ud={class:"rounded-lg border border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100 p-4 dark:border-gray-600 dark:from-gray-700 dark:to-gray-800"},cd={class:"flex items-center justify-between"},pd={class:"text-sm font-semibold text-gray-800 dark:text-gray-200"},md={class:"ml-2 text-xs font-normal text-gray-600"},gd={class:"flex h-12 w-12 items-center justify-center rounded-lg bg-white shadow-sm dark:bg-gray-700"},yd={key:0,class:"mb-4"},fd={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},bd={class:"mb-3 grid grid-cols-3 gap-2"},xd=["onClick"],vd={key:1,class:"animate-fadeIn"},kd=["min"],wd={key:2,class:"rounded-lg border border-blue-200 bg-gradient-to-r from-blue-50 to-indigo-50 p-4 dark:border-blue-700 dark:from-blue-900/20 dark:to-indigo-900/20"},Ad={class:"flex items-center justify-between"},$d={class:"text-sm font-semibold text-blue-900 dark:text-blue-200"},hd={class:"flex gap-3 pt-2"},Cd=["disabled"],Id={key:0,class:"loading-spinner mr-2"},Kd={key:1,class:"fas fa-save mr-2"},Ld={__name:"ExpiryEditModal",props:{show:{type:Boolean,required:!0},apiKey:{type:Object,required:!0}},emits:["close","save"],setup(m,{expose:O,emit:o}){const S=m,I=o,p=V(!1),M=Pe({expireDuration:"",customExpireDate:"",expiresAt:null}),R=[{value:"",label:"永不过期"},{value:"1d",label:"1 天"},{value:"7d",label:"7 天"},{value:"30d",label:"30 天"},{value:"90d",label:"90 天"},{value:"180d",label:"180 天"},{value:"365d",label:"1 年"},{value:"730d",label:"2 年"}],_=Q(()=>{const $=new Date;return $.setMinutes($.getMinutes()+1),$.toISOString().slice(0,16)});ce(()=>S.show,$=>{$&&K()}),ce(()=>{var $;return($=S.apiKey)==null?void 0:$.id},$=>{$&&S.show&&K()});const K=()=>{p.value=!1,S.apiKey.expiresAt?(M.expireDuration="custom",M.customExpireDate=new Date(S.apiKey.expiresAt).toISOString().slice(0,16),M.expiresAt=S.apiKey.expiresAt):(M.expireDuration="",M.customExpireDate="",M.expiresAt=null)},k=$=>{if(M.expireDuration=$,!$){M.expiresAt=null;return}if($==="custom")return;const A=new Date,l=$.match(/(\d+)([dhmy])/);if(l){const[,C,N]=l,T=parseInt(C);switch(N){case"d":A.setDate(A.getDate()+T);break;case"h":A.setHours(A.getHours()+T);break;case"m":A.setMonth(A.getMonth()+T);break;case"y":A.setFullYear(A.getFullYear()+T);break}M.expiresAt=A.toISOString()}},d=()=>{M.customExpireDate&&(M.expiresAt=new Date(M.customExpireDate).toISOString())},u=$=>$?new Date($).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",n=$=>$?new Date($)<new Date:!1,t=$=>{if(!$)return null;const A=new Date,C=new Date($)-A,N=Math.ceil(C/(1e3*60*60*24));return C<0?{text:"已过期",class:"text-red-600"}:N<=7?{text:`${N} 天后过期`,class:"text-orange-600"}:N<=30?{text:`${N} 天后过期`,class:"text-yellow-600"}:{text:`${Math.ceil(N/30)} 个月后过期`,class:"text-green-600"}},b=()=>{p.value=!0,I("save",{keyId:S.apiKey.id,expiresAt:M.expiresAt})},g=async()=>{let $=!0;window.showConfirm?$=await window.showConfirm("激活 API Key",`确定要立即激活此 API Key 吗？激活后将在 ${S.apiKey.activationDays||(S.apiKey.activationUnit==="hours"?24:30)} ${S.apiKey.activationUnit==="hours"?"小时":"天"}后自动过期。`,"确定激活","取消"):$=confirm(`确定要立即激活此 API Key 吗？激活后将在 ${S.apiKey.activationDays||(S.apiKey.activationUnit==="hours"?24:30)} ${S.apiKey.activationUnit==="hours"?"小时":"天"}后自动过期。`),$&&(p.value=!0,I("save",{keyId:S.apiKey.id,activateNow:!0}))};return O({resetSaving:()=>{p.value=!1}}),($,A)=>(r(),J(he,{to:"body"},[m.show?(r(),y("div",od,[e("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm",onClick:A[0]||(A[0]=l=>$.$emit("close"))}),e("div",ld,[e("div",rd,[e("div",id,[A[6]||(A[6]=e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-amber-500 to-orange-600"},[e("i",{class:"fas fa-clock text-white"})],-1)),e("div",null,[A[5]||(A[5]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"修改过期时间",-1)),e("p",nd,' 为 "'+v(m.apiKey.name||"API Key")+'" 设置新的过期时间 ',1)])]),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",onClick:A[1]||(A[1]=l=>$.$emit("close"))},A[7]||(A[7]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",dd,[e("div",ud,[e("div",cd,[e("div",null,[A[12]||(A[12]=e("p",{class:"mb-1 text-xs font-medium text-gray-600 dark:text-gray-400"},"当前状态",-1)),e("p",pd,[m.apiKey.expirationMode==="activation"&&!m.apiKey.isActivated?(r(),y(X,{key:0},[A[8]||(A[8]=e("i",{class:"fas fa-pause-circle mr-1 text-blue-500"},null,-1)),A[9]||(A[9]=E(" 未激活 ",-1)),e("span",md," (激活后 "+v(m.apiKey.activationDays||(m.apiKey.activationUnit==="hours"?24:30))+" "+v(m.apiKey.activationUnit==="hours"?"小时":"天")+"过期) ",1)],64)):m.apiKey.expiresAt?(r(),y(X,{key:1},[E(v(u(m.apiKey.expiresAt))+" ",1),t(m.apiKey.expiresAt)?(r(),y("span",{key:0,class:ne(["ml-2 text-xs font-normal",t(m.apiKey.expiresAt).class])}," ("+v(t(m.apiKey.expiresAt).text)+") ",3)):F("",!0)],64)):(r(),y(X,{key:2},[A[10]||(A[10]=e("i",{class:"fas fa-infinity mr-1 text-gray-500"},null,-1)),A[11]||(A[11]=E(" 永不过期 ",-1))],64))])]),e("div",gd,[e("i",{class:ne(["fas fa-hourglass-half text-lg",m.apiKey.expiresAt&&n(m.apiKey.expiresAt)?"text-red-500":"text-gray-400"])},null,2)])])]),m.apiKey.expirationMode==="activation"&&!m.apiKey.isActivated?(r(),y("div",yd,[e("button",{class:"w-full rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 px-4 py-3 font-semibold text-white transition-all hover:from-blue-600 hover:to-blue-700 hover:shadow-lg",onClick:g},[A[13]||(A[13]=e("i",{class:"fas fa-rocket mr-2"},null,-1)),E(" 立即激活 (激活后 "+v(m.apiKey.activationDays||(m.apiKey.activationUnit==="hours"?24:30))+" "+v(m.apiKey.activationUnit==="hours"?"小时":"天")+"过期) ",1)]),e("p",fd,[A[14]||(A[14]=e("i",{class:"fas fa-info-circle mr-1"},null,-1)),E(" 点击立即激活此 API Key，激活后将在 "+v(m.apiKey.activationDays||(m.apiKey.activationUnit==="hours"?24:30))+" "+v(m.apiKey.activationUnit==="hours"?"小时":"天")+"后过期 ",1)])])):F("",!0),e("div",null,[A[16]||(A[16]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"选择新的期限",-1)),e("div",bd,[(r(),y(X,null,ie(R,l=>e("button",{key:l.value,class:ne(["rounded-lg px-3 py-2 text-sm font-medium transition-all",M.expireDuration===l.value?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"]),onClick:C=>k(l.value)},v(l.label),11,xd)),64)),e("button",{class:ne(["rounded-lg px-3 py-2 text-sm font-medium transition-all",M.expireDuration==="custom"?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"]),onClick:A[2]||(A[2]=l=>k("custom"))},A[15]||(A[15]=[e("i",{class:"fas fa-calendar-alt mr-1"},null,-1),E(" 自定义 ",-1)]),2)])]),M.expireDuration==="custom"?(r(),y("div",vd,[A[17]||(A[17]=e("label",{class:"mb-2 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"选择日期和时间",-1)),B(e("input",{"onUpdate:modelValue":A[3]||(A[3]=l=>M.customExpireDate=l),class:"form-input w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200",min:_.value,type:"datetime-local",onChange:d},null,40,kd),[[le,M.customExpireDate]]),A[18]||(A[18]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 选择一个未来的日期和时间作为过期时间 ",-1))])):F("",!0),M.expiresAt!==m.apiKey.expiresAt?(r(),y("div",wd,[e("div",Ad,[e("div",null,[A[21]||(A[21]=e("p",{class:"mb-1 text-xs font-medium text-blue-700 dark:text-blue-400"},[e("i",{class:"fas fa-arrow-right mr-1"}),E(" 新的过期时间 ")],-1)),e("p",$d,[M.expiresAt?(r(),y(X,{key:0},[E(v(u(M.expiresAt))+" ",1),t(M.expiresAt)?(r(),y("span",{key:0,class:ne(["ml-2 text-xs font-normal",t(M.expiresAt).class])}," ("+v(t(M.expiresAt).text)+") ",3)):F("",!0)],64)):(r(),y(X,{key:1},[A[19]||(A[19]=e("i",{class:"fas fa-infinity mr-1"},null,-1)),A[20]||(A[20]=E(" 永不过期 ",-1))],64))])]),A[22]||(A[22]=e("div",{class:"flex h-12 w-12 items-center justify-center rounded-lg bg-white shadow-sm dark:bg-gray-700"},[e("i",{class:"fas fa-check text-lg text-green-500"})],-1))])])):F("",!0),e("div",hd,[e("button",{class:"flex-1 rounded-lg bg-gray-100 px-4 py-2.5 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",onClick:A[4]||(A[4]=l=>$.$emit("close"))}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-4 py-2.5 font-semibold",disabled:p.value||M.expiresAt===m.apiKey.expiresAt,onClick:b},[p.value?(r(),y("div",Id)):(r(),y("i",Kd)),E(" "+v(p.value?"保存中...":"保存更改"),1)],8,Cd)])])])])):F("",!0)]))}},Dd=xe(Ld,[["__scopeId","data-v-fb30c1d3"]]),_d={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},Vd={class:"modal-content relative mx-auto flex max-h-[90vh] w-[95%] max-w-5xl flex-col p-4 sm:w-full sm:p-6 md:p-8"},Sd={class:"mb-4 flex items-center justify-between sm:mb-6"},Md={class:"flex items-center gap-2 sm:gap-3"},Rd={class:"text-lg font-bold text-gray-900 dark:text-gray-100 sm:text-xl"},Ed={class:"modal-scroll-content custom-scrollbar flex-1 overflow-y-auto"},Td={class:"mb-6 grid grid-cols-1 gap-4 md:grid-cols-2"},Ud={class:"rounded-lg border border-blue-200 bg-gradient-to-br from-blue-50 to-blue-100 p-4 dark:border-blue-700 dark:from-blue-900/20 dark:to-blue-800/20"},Pd={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},Od={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},Gd={class:"rounded-lg border border-green-200 bg-gradient-to-br from-green-50 to-green-100 p-4 dark:border-green-700 dark:from-green-900/20 dark:to-green-800/20"},qd={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},jd={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},Bd={class:"rounded-lg border border-yellow-200 bg-gradient-to-br from-yellow-50 to-yellow-100 p-4 dark:border-yellow-700 dark:from-yellow-900/20 dark:to-yellow-800/20"},zd={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},Fd={class:"mt-1 text-xs text-gray-600 dark:text-gray-400"},Wd={class:"rounded-lg border border-purple-200 bg-gradient-to-br from-purple-50 to-purple-100 p-4 dark:border-purple-700 dark:from-purple-900/20 dark:to-purple-800/20"},Nd={class:"space-y-1 text-sm"},Hd={class:"flex justify-between"},Yd={class:"font-semibold text-gray-900 dark:text-gray-100"},Qd={class:"flex justify-between"},Jd={class:"font-semibold text-gray-900 dark:text-gray-100"},Zd={class:"mb-6"},Xd={class:"space-y-3 rounded-lg bg-gray-50 p-4 dark:bg-gray-700/50"},eu={class:"flex items-center justify-between"},tu={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},au={class:"flex items-center justify-between"},su={class:"text-sm font-semibold text-gray-900 dark:text-gray-100"},ou={key:0,class:"flex items-center justify-between"},lu={class:"text-sm font-semibold text-purple-600"},ru={key:1,class:"flex items-center justify-between"},iu={class:"text-sm font-semibold text-purple-600"},nu={key:0,class:"mb-6"},du={class:"space-y-3 rounded-lg bg-gray-50 p-4 dark:bg-gray-700/50"},uu={key:0,class:"space-y-1.5"},cu={class:"text-right text-xs text-gray-500 dark:text-gray-400"},pu={key:1,class:"space-y-1.5"},mu={class:"text-right text-xs text-gray-500 dark:text-gray-400"},gu={key:2,class:"space-y-1.5"},yu={class:"text-right text-xs text-gray-500 dark:text-gray-400"},fu={key:3,class:"flex items-center justify-between rounded-lg border border-purple-200/70 bg-white/60 px-3 py-2 text-sm shadow-sm dark:border-purple-500/40 dark:bg-purple-950/20"},bu={class:"font-semibold text-purple-600 dark:text-purple-300"},xu={key:4,class:"space-y-2"},vu={__name:"UsageDetailModal",props:{show:{type:Boolean,required:!0},apiKey:{type:Object,required:!0}},emits:["close"],setup(m,{emit:O}){const o=m,S=O,I=Q(()=>{var x,a;return((a=(x=o.apiKey.usage)==null?void 0:x.total)==null?void 0:a.requests)||0}),p=Q(()=>{var x,a;return((a=(x=o.apiKey.usage)==null?void 0:x.daily)==null?void 0:a.requests)||0}),M=Q(()=>{var x,a;return((a=(x=o.apiKey.usage)==null?void 0:x.total)==null?void 0:a.tokens)||0}),R=Q(()=>{var x,a;return((a=(x=o.apiKey.usage)==null?void 0:x.daily)==null?void 0:a.tokens)||0}),_=Q(()=>{var x,a;return((a=(x=o.apiKey.usage)==null?void 0:x.total)==null?void 0:a.cost)||0}),K=Q(()=>o.apiKey.dailyCost||0),k=Q(()=>o.apiKey.totalCostLimit||0),d=Q(()=>o.apiKey.weeklyOpusCost||0),u=Q(()=>o.apiKey.weeklyOpusCostLimit||0),n=Q(()=>{var x,a;return((a=(x=o.apiKey.usage)==null?void 0:x.total)==null?void 0:a.inputTokens)||0}),t=Q(()=>{var x,a;return((a=(x=o.apiKey.usage)==null?void 0:x.total)==null?void 0:a.outputTokens)||0}),b=Q(()=>{var x,a;return((a=(x=o.apiKey.usage)==null?void 0:x.total)==null?void 0:a.cacheCreateTokens)||0}),g=Q(()=>{var x,a;return((a=(x=o.apiKey.usage)==null?void 0:x.total)==null?void 0:a.cacheReadTokens)||0}),q=Q(()=>{var x,a;return((a=(x=o.apiKey.usage)==null?void 0:x.averages)==null?void 0:a.rpm)||0}),$=Q(()=>{var x,a;return((a=(x=o.apiKey.usage)==null?void 0:x.averages)==null?void 0:a.tpm)||0}),A=Q(()=>o.apiKey.dailyCostLimit>0||o.apiKey.totalCostLimit>0||o.apiKey.concurrencyLimit>0||o.apiKey.weeklyOpusCostLimit>0||o.apiKey.rateLimitWindow>0||o.apiKey.tokenLimit>0),l=Q(()=>!o.apiKey.dailyCostLimit||o.apiKey.dailyCostLimit===0?0:K.value/o.apiKey.dailyCostLimit*100),C=Q(()=>!k.value||k.value===0?0:_.value/k.value*100),N=Q(()=>!u.value||u.value===0?0:d.value/u.value*100),T=x=>!x&&x!==0?"0":x.toLocaleString("zh-CN"),ee=x=>x>=1e6?(x/1e6).toFixed(1)+"M":x>=1e3?(x/1e3).toFixed(1)+"K":x.toString(),se=()=>{S("close")};return(x,a)=>(r(),J(he,{to:"body"},[m.show?(r(),y("div",_d,[e("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm",onClick:se}),e("div",Vd,[e("div",Sd,[e("div",Md,[a[0]||(a[0]=e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 sm:h-10 sm:w-10 sm:rounded-xl"},[e("i",{class:"fas fa-chart-line text-sm text-white sm:text-base"})],-1)),e("h3",Rd," 使用统计详情 - "+v(m.apiKey.name),1)]),e("button",{class:"p-1 text-gray-400 transition-colors hover:text-gray-600",onClick:se},a[1]||(a[1]=[e("i",{class:"fas fa-times text-lg sm:text-xl"},null,-1)]))]),e("div",Ed,[e("div",Td,[e("div",Ud,[a[2]||(a[2]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"总请求数"),e("i",{class:"fas fa-paper-plane text-blue-500"})],-1)),e("div",Pd,v(T(I.value)),1),e("div",Od," 今日: "+v(T(p.value))+" 次 ",1)]),e("div",Gd,[a[3]||(a[3]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"总Token数"),e("i",{class:"fas fa-coins text-green-500"})],-1)),e("div",qd,v(ee(M.value)),1),e("div",jd," 今日: "+v(ee(R.value)),1)]),e("div",Bd,[a[4]||(a[4]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"总费用"),e("i",{class:"fas fa-dollar-sign text-yellow-600"})],-1)),e("div",zd," $"+v(_.value.toFixed(4)),1),e("div",Fd," 今日: $"+v(K.value.toFixed(4)),1)]),e("div",Wd,[a[7]||(a[7]=e("div",{class:"mb-3 flex items-center justify-between"},[e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"平均速率"),e("i",{class:"fas fa-tachometer-alt text-purple-500"})],-1)),e("div",Nd,[e("div",Hd,[a[5]||(a[5]=e("span",{class:"text-gray-600 dark:text-gray-400"},"RPM:",-1)),e("span",Yd,v(q.value),1)]),e("div",Qd,[a[6]||(a[6]=e("span",{class:"text-gray-600 dark:text-gray-400"},"TPM:",-1)),e("span",Jd,v($.value),1)])])])]),e("div",Zd,[a[12]||(a[12]=e("h4",{class:"mb-3 flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-chart-pie mr-2 text-indigo-500"}),E(" Token 使用分布 ")],-1)),e("div",Xd,[e("div",eu,[a[8]||(a[8]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-down mr-2 text-green-500"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"输入 Token")],-1)),e("span",tu,v(ee(n.value)),1)]),e("div",au,[a[9]||(a[9]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-arrow-up mr-2 text-blue-500"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"输出 Token")],-1)),e("span",su,v(ee(t.value)),1)]),b.value>0?(r(),y("div",ou,[a[10]||(a[10]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-save mr-2 text-purple-500"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"缓存创建 Token")],-1)),e("span",lu,v(ee(b.value)),1)])):F("",!0),g.value>0?(r(),y("div",ru,[a[11]||(a[11]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-download mr-2 text-purple-500"}),e("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"缓存读取 Token")],-1)),e("span",iu,v(ee(g.value)),1)])):F("",!0)])]),A.value?(r(),y("div",nu,[a[15]||(a[15]=e("h4",{class:"mb-3 flex items-center text-sm font-semibold text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-shield-alt mr-2 text-red-500"}),E(" 限制设置 ")],-1)),e("div",du,[m.apiKey.dailyCostLimit>0?(r(),y("div",uu,[c(Ct,{current:K.value,label:"每日费用限制",limit:m.apiKey.dailyCostLimit,"show-shine":!0,type:"daily"},null,8,["current","limit"]),e("div",cu," 已使用 "+v(Math.min(l.value,100).toFixed(1))+"% ",1)])):F("",!0),m.apiKey.weeklyOpusCostLimit>0?(r(),y("div",pu,[c(Ct,{current:d.value,label:"Opus 周费用限制",limit:m.apiKey.weeklyOpusCostLimit,"show-shine":!0,type:"opus"},null,8,["current","limit"]),e("div",mu," 已使用 "+v(Math.min(N.value,100).toFixed(1))+"% ",1)])):F("",!0),m.apiKey.totalCostLimit>0?(r(),y("div",gu,[c(Ct,{current:_.value,label:"总费用限制",limit:m.apiKey.totalCostLimit,"show-shine":!0,type:"total"},null,8,["current","limit"]),e("div",yu," 已使用 "+v(Math.min(C.value,100).toFixed(1))+"% ",1)])):F("",!0),m.apiKey.concurrencyLimit>0?(r(),y("div",fu,[a[13]||(a[13]=e("span",{class:"text-gray-600 dark:text-gray-300"},"并发限制",-1)),e("span",bu,v(m.apiKey.currentConcurrency||0)+" / "+v(m.apiKey.concurrencyLimit),1)])):F("",!0),m.apiKey.rateLimitWindow>0?(r(),y("div",xu,[a[14]||(a[14]=e("h5",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[e("i",{class:"fas fa-clock mr-1 text-blue-500"}),E(" 时间窗口限制 ")],-1)),c(va,{"cost-limit":m.apiKey.rateLimitCost,"current-cost":m.apiKey.currentWindowCost,"current-requests":m.apiKey.currentWindowRequests,"current-tokens":m.apiKey.currentWindowTokens,label:"窗口状态","rate-limit-window":m.apiKey.rateLimitWindow,"request-limit":m.apiKey.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":m.apiKey.tokenLimit,"window-end-time":m.apiKey.windowEndTime,"window-remaining-seconds":m.apiKey.windowRemainingSeconds,"window-start-time":m.apiKey.windowStartTime},null,8,["cost-limit","current-cost","current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"])])):F("",!0)])])):F("",!0)]),e("div",{class:"mt-4 flex justify-end gap-2 sm:mt-6 sm:gap-3"},[e("button",{class:"btn btn-secondary px-4 py-2 text-sm",type:"button",onClick:se}," 关闭 ")])])])):F("",!0)]))}},ku=xe(vu,[["__scopeId","data-v-da99842f"]]);function wu(){const m=Wt(),O=V([]),o=V(!1),S=V([]),I=V(!1),p=V(0),M=V(1),R=V(Number(localStorage.getItem("deletedApiKeysPageSize")||10)),_=[10,20,50,100],K=V([]),k=V(0),d=V("0"),u=V("0"),n=V(!1),t=V({type:"preset",preset:"today",customStart:"",customEnd:""}),b=V({claude:[],gemini:[],openai:[],openaiResponses:[],azureOpenai:[],bedrock:[],droid:[],claudeGroups:[],geminiGroups:[],openaiGroups:[],droidGroups:[]}),g=V(!1),q=Q(()=>{var h;return((h=m.oemSettings)==null?void 0:h.ldapEnabled)||!1}),$=V(""),A=V([]),l=V(""),C=V("apiKey"),N=V(""),T=Q(()=>{const h=[{value:"",label:"所有标签"}];return A.value.forEach(P=>h.push({value:P,label:P})),h}),ee=V("periodTokens"),se=V("desc"),x=V(1),a=V(Number(localStorage.getItem("apiKeysPageSize")||10)),L=[10,20,50,100],i=h=>{a.value=h,localStorage.setItem("apiKeysPageSize",String(h)),Re(),Ce(t.value,{reset:!0})},Z=h=>{R.value=h,localStorage.setItem("deletedApiKeysPageSize",String(h)),M.value=1,Ie()},U=V(!1),s=V([]),f=()=>{U.value=!U.value,U.value||(s.value=[])},te=h=>{if(!h)return"未知账户";if(h.startsWith("group:")){const ot=h.substring(6),Te=Zt=>Zt.find(Xt=>Xt.id===ot),Tt=Te(b.value.claudeGroups);if(Tt)return`分组-${Tt.name}`;const Ut=Te(b.value.geminiGroups);if(Ut)return`分组-${Ut.name}`;const Pt=Te(b.value.openaiGroups);if(Pt)return`分组-${Pt.name}`;const Ot=Te(b.value.droidGroups);return Ot?`分组-${Ot.name}`:`分组-${ot.substring(0,8)}`}const P=ot=>ot.find(Te=>Te.id===h),G=P(b.value.claude);if(G)return`${G.name}`;const j=P(b.value.gemini);if(j)return`${j.name}`;const z=P(b.value.openai);if(z)return`${z.name}`;const pe=P(b.value.openaiResponses);if(pe)return`${pe.name}`;const ze=P(b.value.bedrock);if(ze)return`${ze.name}`;const Fe=P(b.value.droid);return Fe?`${Fe.name}`:`${h.substring(0,8)}...`},me=h=>{if(h.claudeAccountId||h.claudeConsoleAccountId){const P=h.claudeAccountId||h.claudeConsoleAccountId,G=te(P);if(P.startsWith("group:"))return G;const j=b.value.claude.find(z=>z.id===P);return j?j.accountType==="dedicated"?`🔒 专属-${G}`:G:`⚠️ ${G} (账户不存在)`}return""},ae=h=>{if(h.geminiAccountId){const P=te(h.geminiAccountId);if(h.geminiAccountId.startsWith("group:"))return P;const G=b.value.gemini.find(j=>j.id===h.geminiAccountId);return G?G.accountType==="dedicated"?`🔒 专属-${P}`:P:`⚠️ ${P} (账户不存在)`}return""},ye=h=>{if(h.openaiAccountId){const P=te(h.openaiAccountId);if(h.openaiAccountId.startsWith("group:"))return P;let G=b.value.openai.find(j=>j.id===h.openaiAccountId);return G||(G=b.value.openaiResponses.find(j=>j.id===h.openaiAccountId)),G?G.accountType==="dedicated"?`🔒 专属-${P}`:P:`⚠️ ${P} (账户不存在)`}return""},ge=h=>{if(h.bedrockAccountId){const P=te(h.bedrockAccountId);if(h.bedrockAccountId.startsWith("group:"))return P;const G=b.value.bedrock.find(j=>j.id===h.bedrockAccountId);return G?G.accountType==="dedicated"?`🔒 专属-${P}`:P:`⚠️ ${P} (账户不存在)`}return""},H=h=>{if(h.droidAccountId){const P=te(h.droidAccountId);if(h.droidAccountId.startsWith("group:"))return P;const G=b.value.droid.find(j=>j.id===h.droidAccountId);return G?G.accountType==="dedicated"?`🔒 专属-${P}`:P:`⚠️ ${P} (账户不存在)`}return""},fe=h=>{const P=j=>typeof j=="string"?j.replace(/^⚠️\s*/,"").replace(/^🔒\s*/,"").trim():"",G=[];if(h.claudeAccountId||h.claudeConsoleAccountId){const j=P(me(h));G.push(j?`Claude ${j}`:"Claude")}if(h.geminiAccountId){const j=P(ae(h));G.push(j?`Gemini ${j}`:"Gemini")}if(h.openaiAccountId){const j=P(ye(h));G.push(j?`OpenAI ${j}`:"OpenAI")}if(h.bedrockAccountId){const j=P(ge(h));G.push(j?`Bedrock ${j}`:"Bedrock")}if(h.droidAccountId){const j=P(H(h));G.push(j?`Droid ${j}`:"Droid")}return!h.claudeAccountId&&!h.claudeConsoleAccountId&&!h.geminiAccountId&&!h.openaiAccountId&&!h.bedrockAccountId&&!h.droidAccountId&&G.push("共享池"),G},ve=Q(()=>{const h=[...O.value],P=ee.value,G=se.value==="asc"?1:-1,j=z=>{switch(P){case"name":return z.name||"";case"periodTokens":return _e(z).tokens||_e(z).allTokens||0;case"periodRequests":return _e(z).requests||0;case"lastUsedAt":return z.lastUsedAt?new Date(z.lastUsedAt).getTime():0;case"createdAt":return z.createdAt?new Date(z.createdAt).getTime():0;case"expiresAt":return z.expiresAt?new Date(z.expiresAt).getTime():0;default:return _e(z).tokens||0}};return h.sort((z,pe)=>{const ze=j(z),Fe=j(pe);return ze===Fe?0:ze>Fe?G:-G}),h}),re=Q(()=>{var P;if(k.value&&k.value>0)return k.value;const h=K.value[x.value];return h?h.finished?(x.value-1)*a.value+(((P=h.items)==null?void 0:P.length)||0):x.value*a.value+1:0}),be=Q(()=>Math.max(1,Math.ceil(re.value/a.value))),ut=Q(()=>ve.value),ct=h=>{ee.value===h?se.value=se.value==="asc"?"desc":"asc":(ee.value=h,se.value="asc")},Qe=async()=>{try{const h=await oe.get("/admin/accounts/aggregated",{params:{fields:"summary",compact:"true"}});if(!(h!=null&&h.success))return;const P=h.data||{},G=[];(P.claudeAccounts||[]).forEach(z=>{G.push({...z,platform:"claude-oauth",isDedicated:z.accountType==="dedicated"})}),(P.claudeConsoleAccounts||[]).forEach(z=>{G.push({...z,platform:"claude-console",isDedicated:z.accountType==="dedicated"})}),b.value.claude=G,b.value.gemini=(P.geminiAccounts||[]).map(z=>({...z,isDedicated:z.accountType==="dedicated"})),b.value.openai=(P.openaiAccounts||[]).map(z=>({...z,isDedicated:z.accountType==="dedicated"})),b.value.openaiResponses=(P.openaiResponsesAccounts||[]).map(z=>({...z,isDedicated:z.accountType==="dedicated"})),b.value.azureOpenai=(P.azureOpenaiAccounts||[]).map(z=>({...z,isDedicated:z.accountType==="dedicated"})),b.value.bedrock=(P.bedrockAccounts||[]).map(z=>({...z,isDedicated:z.accountType==="dedicated"})),b.value.droid=(P.droidAccounts||[]).map(z=>({...z,platform:"droid",isDedicated:z.accountType==="dedicated"}));const j=P.accountGroups||[];b.value.claudeGroups=j.filter(z=>z.platform==="claude"),b.value.geminiGroups=j.filter(z=>z.platform==="gemini"),b.value.openaiGroups=j.filter(z=>z.platform==="openai"),b.value.droidGroups=j.filter(z=>z.platform==="droid"),g.value=!0}catch{g.value=!0}},Me=async(h=!1)=>{(h||!g.value)&&await Qe()},pt=async(h,P={})=>{const G=P.forceAccounts||P.reset||!g.value,j=[];G&&j.push(Qe()),j.push(Ce(h,P)),await Promise.all(j)},mt=async()=>{try{const h=await oe.get("/admin/api-keys/tags");h.success&&(A.value=(h.data||[]).sort())}catch{}};function Re(){K.value=[],d.value="0",u.value="0",n.value=!1,O.value=[],x.value=1,k.value=0}const gt=async(h,P,G,{wantTotal:j=!1}={})=>{const z={pageNum:h,pageSize:P,includeDeleted:"false",search:l.value||"",tag:$.value||"",activated:N.value||"",includeUsage:"true",withTotal:j?"true":"false"};G&&(G.type==="custom"?(z.timeRange="custom",z.startDate=G.customStart,z.endDate=G.customEnd):G.preset?z.timeRange=G.preset==="30days"?"30days":G.preset:z.timeRange="today");const pe=await oe.get("/admin/api-keys/list",{params:z});if(!pe.success)throw new Error(pe.error||"Failed to list API keys");return pe.data},_e=h=>{const P=t.value||{type:"preset",preset:"today"},G=h.usage||{};switch(P.type==="custom"?"custom":P.preset||"today"){case"today":return G.today||G.daily||G.total||{};case"7days":return G.weekly||G.daily||G.total||{};case"30days":case"monthly":return G.monthly||G.total||{};case"all":case"custom":default:return G.total||{}}},Ce=async(h,P={})=>{o.value=!0;try{if(h&&(t.value={type:h.type,preset:h.preset,customStart:h.customStart,customEnd:h.customEnd}),P.reset&&Re(),K.value[x.value]){const G=K.value[x.value];O.value=[...G.items],d.value=G.cursor||"0",u.value=G.nextCursor||"0",n.value=!!G.finished}else{const G=x.value===1,j=await gt(x.value,a.value,t.value,{wantTotal:G}),z=j.items||[];G&&typeof j.total=="number"&&(k.value=j.total);const pe={cursor:j.cursor||"0",nextCursor:j.cursor||"0",finished:!!(typeof j.total=="number"?x.value*a.value>=j.total:j.finished),items:z,page:j.page||x.value,pageSize:j.pageSize||a.value,total:typeof j.total=="number"?j.total:void 0};K.value[x.value]=pe,O.value=[...z],d.value=pe.cursor,u.value=pe.nextCursor,n.value=pe.finished}}catch{W("加载 API Keys 失败","error")}finally{o.value=!1}},Ie=async()=>{I.value=!0;try{const h=await oe.get("/admin/api-keys/deleted",{params:{pageNum:M.value,pageSize:R.value}});h.success&&(S.value=h.apiKeys||[],p.value=h.total||0)}catch{W("加载已删除的 API Keys 失败","error")}finally{I.value=!1}},Oe=async()=>{await Me(),je.value=!0},Je=async h=>{Rt.value=h,Be.value=!0},yt=h=>{Et.value=h,at.value=!0},ft=async()=>{await Me(),Mt.value=!0},bt=async()=>{W("创建成功","success")},xt=async()=>{W("保存成功","success"),Re(),await Ce(t.value,{reset:!0})},vt=async()=>{W("续期成功","success")},kt=async()=>{W("批量创建成功","success")},wt=async()=>{W("批量编辑成功","success")},Ge=V(null),Ze=V(null),At=h=>{Ge.value={...h}},Ke=()=>{Ge.value=null},we=async()=>{W("已保存过期时间","success"),Ke()},Xe=V(!1),qe=V(null),$t=async h=>{qe.value={...h},Xe.value=!0;try{const P=await oe.get(`/admin/api-keys/${h.id}/usage`);if(P.success){const G=P.data||{};qe.value={...h,usage:G.usage||h.usage||{},dailyCost:G.dailyCost??h.dailyCost,weeklyOpusCost:G.weeklyOpusCost??h.weeklyOpusCost}}}catch{W("加载使用详情失败","error")}},et=async h=>{var P,G;try{let j=!1;if(window&&typeof window.confirm=="function"&&(j=window.confirm("确定要删除这个 API Key 吗？此操作不可恢复。")),!j)return;const z=await oe.delete(`/admin/api-keys/${h.id}`);z.success?(W("API Key 已删除","success"),O.value=O.value.filter(pe=>pe.id!==h.id)):W(z.error||"删除失败","error")}catch(j){W(((G=(P=j.response)==null?void 0:P.data)==null?void 0:G.error)||"删除失败","error")}},Ve=async()=>{const h=[...s.value];if(h.length===0)return;let P=!1;if(window&&typeof window.confirm=="function"&&(P=window.confirm(`确定要删除选中的 ${h.length} 个 API Key 吗？此操作不可恢复。`)),!P)return;let G=0;for(const j of h)try{(await oe.delete(`/admin/api-keys/${j}`)).success&&(G+=1,O.value=O.value.filter(pe=>pe.id!==j))}catch{}G>0&&W(`已删除 ${G} 个 API Key`,"success"),s.value=[]},Ee=async h=>{var P,G;try{let j=!1;if(window&&typeof window.confirm=="function"&&(j=window.confirm("确定要彻底删除这个 API Key 吗？此操作不可恢复。")),!j)return;I.value=!0;const z=await oe.delete(`/admin/api-keys/${h}/purge`);if(z.success){W("已彻底删除","success"),p.value=Math.max(0,(p.value||0)-1);const pe=Math.max(1,Math.ceil(p.value/R.value));M.value>pe&&(M.value=pe),await Ie()}else W(z.error||"删除失败","error")}catch(j){W(((G=(P=j.response)==null?void 0:P.data)==null?void 0:G.error)||"删除失败","error")}finally{I.value=!1}},ht=async()=>{var h,P;try{const G=S.value.length;let j=!1;if(window&&typeof window.confirm=="function"&&(j=window.confirm(`确定要彻底删除全部 ${G} 个已删除的 API Keys 吗？此操作不可恢复。`)),!j)return;I.value=!0;const z=await oe.delete("/admin/api-keys/deleted/clear-all");z.success?(W("已清空所有已删除的 API Keys","success"),S.value=[],p.value=0,M.value=1,await Ie()):W(z.error||"清空失败","error")}catch(G){W(((P=(h=G.response)==null?void 0:h.data)==null?void 0:P.error)||"清空失败","error")}finally{I.value=!1}},tt=async h=>{var P,G;try{let j=!1;if(window&&typeof window.confirm=="function"&&(j=window.confirm("确定要恢复这个 API Key 吗？恢复后可以重新使用。")),!j)return;I.value=!0;const z=await oe.post(`/admin/api-keys/${h}/restore`);if(z.success){W("API Key 已成功恢复","success"),p.value=Math.max(0,(p.value||0)-1);const pe=Math.max(1,Math.ceil(p.value/R.value));M.value>pe&&(M.value=pe),await Ie()}else W(z.error||"恢复失败","error")}catch(j){W(((G=(P=j.response)==null?void 0:P.data)==null?void 0:G.error)||"恢复失败","error")}finally{I.value=!1}},Y=async()=>{try{const h={search:l.value||"",tag:$.value||"",activated:N.value||""},P=await oe.get("/admin/api-keys/export",{params:h});if(!P||typeof P.blob!="function")throw new Error("Invalid export response");const G=await P.blob(),j=window.URL.createObjectURL(G),z=document.createElement("a");z.href=j,z.download="api-keys.csv",document.body.appendChild(z),z.click(),z.remove(),window.URL.revokeObjectURL(j)}catch{W("导出失败","error")}},je=V(!1),Be=V(!1),at=V(!1),st=V(!1),de=V(!1),Mt=V(!1),Rt=V(null),Et=V(null),Qt=V(null),Jt=V([]);return mt(),ce([$,l,C,N],()=>{Re(),Ce(t.value,{reset:!0})}),ce(x,async(h,P)=>{if(h!==P){o.value=!0;try{await Ce(t.value)}finally{o.value=!1}}}),ce(M,async(h,P)=>{if(h!==P){I.value=!0;try{await Ie()}finally{I.value=!1}}}),{apiKeys:O,apiKeysLoading:o,deletedApiKeys:S,deletedApiKeysLoading:I,deletedTotal:p,deletedCurrentPage:M,deletedPageSize:R,deletedPageSizeOptions:_,accounts:b,isLdapEnabled:q,selectedTagFilter:$,availableTags:A,searchKeyword:l,searchMode:C,activationFilter:N,tagOptions:T,apiKeysSortBy:ee,apiKeysSortOrder:se,currentPage:x,pageSize:a,pageSizeOptions:L,sortedApiKeys:ve,paginatedApiKeys:ut,totalPages:be,totalEstimated:re,onPageSizeChange:i,onDeletedPageSizeChange:Z,sortApiKeys:ct,showCheckboxes:U,selectedApiKeys:s,toggleSelectionMode:f,getBindingDisplayStrings:fe,showCreateApiKeyModal:je,showEditApiKeyModal:Be,showRenewApiKeyModal:at,showNewApiKeyModal:st,showBatchApiKeyModal:de,showBatchEditModal:Mt,editingApiKey:Rt,renewingApiKey:Et,newApiKeyData:Qt,batchApiKeyData:Jt,openCreateApiKeyModal:Oe,openEditApiKeyModal:Je,openRenewApiKeyModal:yt,openBatchEditModal:ft,handleCreateSuccess:bt,handleEditSuccess:xt,handleRenewSuccess:vt,handleBatchCreateSuccess:kt,handleBatchEditSuccess:wt,editingExpiryKey:Ge,expiryEditModalRef:Ze,startEditExpiry:At,closeExpiryEdit:Ke,handleSaveExpiry:we,showUsageDetailModal:Xe,selectedApiKeyForDetail:qe,showUsageDetails:$t,loadApiKeys:Ce,loadDeletedApiKeys:Ie,deleteApiKey:et,batchDeleteApiKeys:Ve,restoreApiKey:tt,purgeDeletedApiKey:Ee,clearAllDeletedApiKeys:ht,exportToExcel:Y,ensureAccountsLoaded:Me,refreshKeysAndAccounts:pt,accountsLoaded:g}}function Au(){const m=V("active"),O=V([new Date(2e3,1,1,0,0,0),new Date(2e3,2,1,23,59,59)]),o=Pe({type:"preset",preset:"today",customStart:"",customEnd:"",customRange:null});return{activeTab:m,defaultTime:O,globalDateFilter:o,onGlobalCustomDateRangeChange:p=>{o.customRange=p,Array.isArray(p)&&p.length===2?(o.customStart=p[0],o.customEnd=p[1],o.type="custom"):(o.customStart="",o.customEnd="",o.type="preset",o.preset="today")},handleTimeRangeChange:p=>{p==="custom"?o.type="custom":(o.type="preset",o.preset=p,o.customStart="",o.customEnd="",o.customRange=null)}}}const $u={class:"api-keys-view"},hu={class:"card p-4 sm:p-6"},Cu={key:0,class:"py-12 text-center"},Iu={key:1},Ku={class:"mt-4 flex items-center justify-between"},Lu={class:"text-xs text-gray-500 dark:text-gray-400"},Du={class:"mt-4 flex items-center justify-between"},_u={class:"text-xs text-gray-500 dark:text-gray-400"},qt=560,Vu={__name:"index",setup(m){const{apiKeysLoading:O,deletedApiKeys:o,deletedApiKeysLoading:S,deletedTotal:I,deletedCurrentPage:p,deletedPageSize:M,deletedPageSizeOptions:R,accounts:_,isLdapEnabled:K,selectedTagFilter:k,availableTags:d,searchKeyword:u,searchMode:n,activationFilter:t,tagOptions:b,currentPage:g,pageSize:q,pageSizeOptions:$,sortedApiKeys:A,paginatedApiKeys:l,totalPages:C,totalEstimated:N,onPageSizeChange:T,showCheckboxes:ee,selectedApiKeys:se,toggleSelectionMode:x,getBindingDisplayStrings:a,showCreateApiKeyModal:L,showEditApiKeyModal:i,showRenewApiKeyModal:Z,showNewApiKeyModal:U,showBatchApiKeyModal:s,showBatchEditModal:f,editingApiKey:te,renewingApiKey:me,newApiKeyData:ae,batchApiKeyData:ye,openCreateApiKeyModal:ge,openEditApiKeyModal:H,openRenewApiKeyModal:fe,openBatchEditModal:ve,handleCreateSuccess:re,handleEditSuccess:be,handleRenewSuccess:ut,handleBatchCreateSuccess:ct,handleBatchEditSuccess:Qe,editingExpiryKey:Me,expiryEditModalRef:pt,startEditExpiry:mt,closeExpiryEdit:Re,handleSaveExpiry:gt,showUsageDetailModal:_e,selectedApiKeyForDetail:Ce,showUsageDetails:Ie,loadApiKeys:Oe,loadDeletedApiKeys:Je,deleteApiKey:yt,restoreApiKey:ft,purgeDeletedApiKey:bt,clearAllDeletedApiKeys:xt,exportToExcel:vt,sortApiKeys:kt,batchDeleteApiKeys:wt,ensureAccountsLoaded:Ge,refreshKeysAndAccounts:Ze,onDeletedPageSizeChange:At}=wu(),{activeTab:Ke,globalDateFilter:we,defaultTime:Xe,onGlobalCustomDateRangeChange:qe,handleTimeRangeChange:$t}=Au(),et=Q(()=>O.value),Ve=V(!1),Ee=V(!1),ht=async()=>{await be()};return Ue(async()=>{await Ze(we,{reset:!1,forceAccounts:!0})}),ce(()=>Ke.value,async tt=>{tt==="deleted"&&await Je()}),(tt,Y)=>{const je=ya,Be=ga,at=pa,st=ma;return r(),y("div",$u,[e("div",hu,[Y[26]||(Y[26]=e("div",{class:"mb-4 sm:mb-6"},[e("h3",{class:"mb-1 text-lg font-bold text-gray-900 dark:text-gray-100 sm:mb-2 sm:text-xl"}," API Keys 管理 "),e("p",{class:"text-sm text-gray-600 dark:text-gray-400 sm:text-base"},"管理和监控您的 API 密钥")],-1)),c(at,{modelValue:D(Ke),"onUpdate:modelValue":Y[0]||(Y[0]=de=>Le(Ke)?Ke.value=de:null),class:"mb-4"},{default:w(()=>[c(Be,{name:"active"},{label:w(()=>[Y[23]||(Y[23]=e("span",null,"活跃 API Keys",-1)),D(N)?(r(),J(je,{key:0,value:D(N),class:"ml-2"},null,8,["value"])):F("",!0)]),_:1}),c(Be,{name:"deleted"},{label:w(()=>[Y[24]||(Y[24]=e("span",null,"已删除 API Keys",-1)),D(I)?(r(),J(je,{key:0,value:D(I),class:"ml-2"},null,8,["value"])):F("",!0)]),_:1})]),_:1},8,["modelValue"]),D(Ke)==="active"?(r(),y(X,{key:0},[c(ha,{"api-keys-loading":D(O),"tag-options":D(b),"selected-tag":D(k),"onUpdate:selectedTag":Y[1]||(Y[1]=de=>Le(k)?k.value=de:null),"search-keyword":D(u),"onUpdate:searchKeyword":Y[2]||(Y[2]=de=>Le(u)?u.value=de:null),"search-mode":D(n),"onUpdate:searchMode":Y[3]||(Y[3]=de=>Le(n)?n.value=de:null),"activation-filter":D(t),"onUpdate:activationFilter":Y[4]||(Y[4]=de=>Le(t)?t.value=de:null),"global-date-filter":D(we),"default-time":D(Xe),"show-checkboxes":D(ee),"selected-count":D(se).length,onChangeDateRange:Y[5]||(Y[5]=de=>{D($t)(de),D(Oe)(D(we),{reset:!0})}),onRefresh:Y[6]||(Y[6]=async()=>{await D(Ze)(D(we),{reset:!0,forceAccounts:!0})}),onToggleSelection:D(x),onExport:D(vt),onOpenCreate:D(ge),onOpenBatchEdit:D(ve),onOpenPackages:Y[7]||(Y[7]=async()=>{await D(Ge)(),Ve.value=!0}),onOpenEmailSearch:Y[8]||(Y[8]=de=>Ee.value=!0),onBatchDelete:D(wt),onUpdateCustomRange:Y[9]||(Y[9]=de=>{D(qe)(de),D(Oe)(D(we),{reset:!0})})},null,8,["api-keys-loading","tag-options","selected-tag","search-keyword","search-mode","activation-filter","global-date-filter","default-time","show-checkboxes","selected-count","onToggleSelection","onExport","onOpenCreate","onOpenBatchEdit","onBatchDelete"]),D(A).length===0&&!et.value?(r(),y("div",Cu,Y[25]||(Y[25]=[e("div",{class:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700"},[e("i",{class:"fas fa-key text-xl text-gray-400"})],-1),e("p",{class:"text-lg text-gray-500 dark:text-gray-400"},"暂无 API Keys",-1),e("p",{class:"mt-2 text-sm text-gray-400"},"点击上方按钮创建您的第一个 API Key",-1)]))):(r(),y("div",Iu,[c(Wa,{data:D(l),"is-ldap-enabled":D(K),"show-checkboxes":D(ee),selected:D(se),"onUpdate:selected":Y[10]||(Y[10]=de=>Le(se)?se.value=de:null),"get-binding-strings":D(a),"date-filter":D(we),loading:et.value,"table-height":qt,onSortChange:D(kt),onEdit:D(H),onRenew:D(fe),onDelete:D(yt),onDetail:D(Ie),onEditExpiry:D(mt)},null,8,["data","is-ldap-enabled","show-checkboxes","selected","get-binding-strings","date-filter","loading","onSortChange","onEdit","onRenew","onDelete","onDetail","onEditExpiry"]),e("div",Ku,[e("div",Lu," 约 "+v(D(N))+" 条，当前第 "+v(D(g))+" / "+v(D(C))+" 页 ",1),c(st,{background:"",layout:"prev, pager, next, sizes","page-size":D(q),"page-sizes":D($),total:D(N),"current-page":D(g),"onUpdate:currentPage":Y[11]||(Y[11]=de=>Le(g)?g.value=de:null),onSizeChange:D(T)},null,8,["page-size","page-sizes","total","current-page","onSizeChange"])])]))],64)):(r(),y(X,{key:1},[c(Ja,{data:D(o),total:D(I),loading:D(S),"table-height":qt,onRestore:D(ft),onPurge:D(bt),onClearAll:D(xt),onRefresh:D(Je)},null,8,["data","total","loading","onRestore","onPurge","onClearAll","onRefresh"]),e("div",Du,[e("div",_u," 共 "+v(D(I))+" 条，当前第 "+v(D(p))+" / "+v(Math.max(1,Math.ceil(D(I)/D(M))))+" 页 ",1),c(st,{background:"",layout:"prev, pager, next, sizes","page-size":D(M),"page-sizes":D(R),total:D(I),"current-page":D(p),"onUpdate:currentPage":Y[12]||(Y[12]=de=>Le(p)?p.value=de:null),onSizeChange:D(At)},null,8,["page-size","page-sizes","total","current-page","onSizeChange"])])],64))]),D(L)?(r(),J(Ml,{key:0,accounts:D(_),onBatchSuccess:D(ct),onClose:Y[13]||(Y[13]=de=>L.value=!1),onSuccess:D(re)},null,8,["accounts","onBatchSuccess","onSuccess"])):F("",!0),D(i)?(r(),J(Ur,{key:1,accounts:D(_),"available-tags":D(d),"api-key":D(te),onClose:Y[14]||(Y[14]=de=>i.value=!1),onSuccess:ht},null,8,["accounts","available-tags","api-key"])):F("",!0),D(Z)?(r(),J(ei,{key:2,"api-key":D(me),onClose:Y[15]||(Y[15]=de=>Z.value=!1),onSuccess:D(ut)},null,8,["api-key","onSuccess"])):F("",!0),D(U)?(r(),J(gi,{key:3,"api-key":D(ae),onClose:Y[16]||(Y[16]=de=>U.value=!1)},null,8,["api-key"])):F("",!0),D(s)?(r(),J(Oi,{key:4,"api-keys":D(ye),onClose:Y[17]||(Y[17]=de=>s.value=!1)},null,8,["api-keys"])):F("",!0),D(f)?(r(),J(sd,{key:5,accounts:D(_),"selected-keys":D(se),onClose:Y[18]||(Y[18]=de=>f.value=!1),onSuccess:D(Qe)},null,8,["accounts","selected-keys","onSuccess"])):F("",!0),Ve.value?(r(),J($s,{key:6,show:Ve.value,accounts:D(_),"tag-options":D(b),onClose:Y[19]||(Y[19]=de=>Ve.value=!1),onCreated:Y[20]||(Y[20]=()=>{Ve.value=!1,D(Oe)(D(we),{reset:!0})})},null,8,["show","accounts","tag-options"])):F("",!0),c(Dd,{ref_key:"expiryEditModalRef",ref:pt,"api-key":D(Me)||{id:null,expiresAt:null,name:""},show:!!D(Me),onClose:D(Re),onSave:D(gt)},null,8,["api-key","show","onClose","onSave"]),c(ku,{"api-key":D(Ce)||{},show:D(_e),onClose:Y[21]||(Y[21]=de=>_e.value=!1)},null,8,["api-key","show"]),Ee.value?(r(),J(Vs,{key:7,show:Ee.value,onClose:Y[22]||(Y[22]=de=>Ee.value=!1)},null,8,["show"])):F("",!0)])}}},Uu=xe(Vu,[["__scopeId","data-v-5ae08d7f"]]);export{Uu as default};
