import{c as H,r as M,q as gt,V as xt,x as n,y as l,z as t,R as F,L as U,I as ot,C as E,J as X,O as _,av as wt,Y as mt,aP as $t,aX as nt,P as o,u as e,K as pt,aq as vt,aa as bt,f as ft,Q as tt,ac as lt,B as it,o as ct,aW as St,aT as Ct}from"./vue-vendor-R8HMg95E.js";import{L as Tt}from"./LogoTitle-CX_-AgWK.js";import{T as Pt}from"./ThemeToggle-CIl26c0h.js";import{_ as at,s as kt,a as Kt}from"./index-CYC8e9-T.js";import{b as Lt,R as At}from"./vendor-DTV-MYIR.js";import{_ as It}from"./WindowCountdown-DF7xS2EZ.js";import Mt from"./TutorialView-46V8zUUx.js";import{x as qt,d as Dt,w as Ut,e as _t,G as ht}from"./element-plus-T7eq0npu.js";const Rt={class:"page-header fixed left-0 right-0 top-0 z-30"},Ot={class:"mx-auto flex max-w-7xl items-center justify-between gap-2 px-3 py-2 md:gap-4 md:px-4 md:py-3"},Et={class:"min-w-0 flex-1"},jt={class:"flex flex-shrink-0 items-center gap-2 md:gap-4"},Nt={class:"hidden items-center gap-1 md:flex"},Ft=["aria-expanded"],Bt={class:"flex items-center"},Wt={__name:"PublicHeader",props:{currentTab:{type:String,default:"products"},oemLoading:{type:Boolean,default:!1},oemSettings:{type:Object,default:()=>({})}},emits:["update:currentTab"],setup(T,{emit:y}){const s=T,p=y,x=H(()=>s.currentTab==="products"?"选择合适的套餐，立即使用":s.currentTab==="stats"?"API Key 使用统计":"使用教程"),f=w=>p("update:currentTab",w),u=M(!1),v=M(null),h=()=>{u.value=!u.value},I=w=>{u.value&&v.value&&!v.value.contains(w.target)&&(u.value=!1)},d=w=>{f(w),u.value=!1};return gt(()=>document.addEventListener("click",I)),xt(()=>document.removeEventListener("click",I)),(w,b)=>{const k=wt("router-link");return l(),n("header",Rt,[t("div",Ot,[t("div",Et,[F(Tt,{loading:T.oemLoading,"logo-src":T.oemSettings.siteIconData||T.oemSettings.siteIcon,subtitle:x.value,title:T.oemSettings.siteName,"title-class":"truncate","hide-subtitle-on-mobile":!0},null,8,["loading","logo-src","subtitle","title"])]),t("div",jt,[t("nav",Nt,[t("button",{class:E(["menu-link",{active:T.currentTab==="products"}]),onClick:b[0]||(b[0]=$=>f("products"))}," 产品 ",2),t("button",{class:E(["menu-link",{active:T.currentTab==="stats"}]),onClick:b[1]||(b[1]=$=>f("stats"))}," 统计查询 ",2),t("button",{class:E(["menu-link",{active:T.currentTab==="tutorial"}]),onClick:b[2]||(b[2]=$=>f("tutorial"))}," 使用教程 ",2),!T.oemLoading&&T.oemSettings.showAdminButton===!0?(l(),ot(k,{key:0,class:"menu-link",to:"/dashboard"},{default:X(()=>b[9]||(b[9]=[_("管理后台",-1)])),_:1,__:[9]})):U("",!0)]),t("button",{class:"mobile-menu-btn inline-flex h-9 w-9 items-center justify-center rounded-xl md:hidden","aria-label":"菜单","aria-expanded":u.value?"true":"false",onClick:mt(h,["stop"])},b[10]||(b[10]=[t("i",{class:"fas fa-ellipsis-v text-[15px]"},null,-1)]),8,Ft),t("div",Bt,[F(Pt,{mode:"dropdown"})]),u.value?(l(),n("div",{key:0,ref_key:"menuRef",ref:v,class:"mobile-menu-dropdown md:hidden",onClick:b[8]||(b[8]=mt(()=>{},["stop"]))},[t("button",{class:"mobile-menu-item",onClick:b[3]||(b[3]=$=>d("products"))},b[11]||(b[11]=[t("i",{class:"fas fa-store w-4"},null,-1),t("span",null,"产品",-1)])),t("button",{class:"mobile-menu-item",onClick:b[4]||(b[4]=$=>d("stats"))},b[12]||(b[12]=[t("i",{class:"fas fa-chart-line w-4"},null,-1),t("span",null,"统计查询",-1)])),t("button",{class:"mobile-menu-item",onClick:b[5]||(b[5]=$=>d("tutorial"))},b[13]||(b[13]=[t("i",{class:"fas fa-book w-4"},null,-1),t("span",null,"使用教程",-1)])),!T.oemLoading&&T.oemSettings.showAdminButton===!0?(l(),ot(k,{key:0,class:"mobile-menu-item",to:"/dashboard",onClick:b[6]||(b[6]=$=>u.value=!1)},{default:X(()=>b[14]||(b[14]=[t("i",{class:"fas fa-tools w-4"},null,-1),t("span",null,"管理后台",-1)])),_:1,__:[14]})):U("",!0),T.oemSettings.ldapEnabled?(l(),ot(k,{key:1,class:"mobile-menu-item",to:"/user-login",onClick:b[7]||(b[7]=$=>u.value=!1)},{default:X(()=>b[15]||(b[15]=[t("i",{class:"fas fa-user w-4"},null,-1),t("span",null,"用户登录",-1)])),_:1,__:[15]})):U("",!0)],512)):U("",!0)])])])}}},Vt=at(Wt,[["__scopeId","data-v-160a4bd2"]]);class zt{constructor(){this.baseURL=window.location.origin,this.isDev=!1}async request(y,s={}){try{const p=y.startsWith("/admin"),x=h=>`${this.baseURL}${h?"/webapi":""}${y}`,f=this.isDev&&p?x(!0):x(!1);let u=await fetch(f,{headers:{"Content-Type":"application/json",...s.headers},...s});if(u.status===404&&p){const h=f.includes("/webapi/")?x(!1):x(!0);u=await fetch(h,{headers:{"Content-Type":"application/json",...s.headers},...s})}const v=await u.json().catch(()=>({}));if(!u.ok)throw new Error(v.message||`请求失败: ${u.status}`);return v}catch(p){throw console.error("API Stats request error:",p),p}}async getKeyId(y){return this.request("/apiStats/api/get-key-id",{method:"POST",body:JSON.stringify({apiKey:y})})}async getUserStats(y){return this.request("/apiStats/api/user-stats",{method:"POST",body:JSON.stringify({apiId:y})})}async getUserModelStats(y,s="daily"){return this.request("/apiStats/api/user-model-stats",{method:"POST",body:JSON.stringify({apiId:y,period:s})})}async getOemSettings(){try{return await this.request("/admin/oem-settings")}catch(y){return console.error("Failed to load OEM settings:",y),{success:!0,data:{siteName:"AI Relay Service",siteIcon:"",siteIconData:""}}}}async getBatchStats(y){return this.request("/apiStats/api/batch-stats",{method:"POST",body:JSON.stringify({apiIds:y})})}async getBatchModelStats(y,s="daily"){return this.request("/apiStats/api/batch-model-stats",{method:"POST",body:JSON.stringify({apiIds:y,period:s})})}async getProductSettings(){return this.request("/admin/product-settings")}async queryXunhu(y){return this.request("/admin/xunhu/query",{method:"POST",body:JSON.stringify(y)})}async getOrder(y){return this.request(`/admin/orders/${encodeURIComponent(y)}`)}}const Y=new zt,dt=$t("apistats",()=>{const T=M(""),y=M(null),s=M(!1),p=M(!1),x=M(!0),f=M(""),u=M("daily"),v=M(null),h=M([]),I=M(null),d=M(null),w=M({siteName:"",siteIcon:"",siteIconData:"",showAdminButton:!1,ldapEnabled:!1}),b=M([]),k=M(!1),$=M([]),S=M([]),P=M(null),g=M([]),i=M([]),W=H(()=>{const c={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};return k.value&&P.value?u.value==="daily"?P.value.dailyUsage||c:P.value.monthlyUsage||c:u.value==="daily"?I.value||c:d.value||c}),K=H(()=>{if(!v.value||!W.value)return{tokenUsage:0,costUsage:0,requestUsage:0};const c=W.value,C=v.value.limits;return{tokenUsage:C.tokenLimit>0?Math.min(c.allTokens/C.tokenLimit*100,100):0,costUsage:C.dailyCostLimit>0?Math.min(c.cost/C.dailyCostLimit*100,100):0,requestUsage:C.rateLimitRequests>0?Math.min(c.requests/C.rateLimitRequests*100,100):0}});async function R(){if(k.value)return et();const c=T.value.trim();if(!c){f.value="请输入 API Key";return}if(c.length<10||c.length>512){f.value="API Key 格式无效：长度应在 10-512 个字符之间";return}s.value=!0,f.value="",v.value=null,h.value=[],y.value=null;try{const C=await Y.getKeyId(c);if(C.success){y.value=C.data.id;const D=await Y.getUserStats(y.value);if(D.success)v.value=D.data,await G(),f.value="",V();else throw new Error(D.message||"查询失败")}else throw new Error(C.message||"获取 API Key ID 失败")}catch(C){console.error("Query stats error:",C),f.value=C.message||"查询统计数据失败，请检查您的 API Key 是否正确",v.value=null,h.value=[],y.value=null}finally{s.value=!1}}async function G(){y.value&&(await Promise.all([O("daily"),O("monthly")]),await L(u.value))}async function O(c){try{const C=await Y.getUserModelStats(y.value,c);if(C.success){const D=C.data||[],N={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};D.forEach(J=>{var st;N.requests+=J.requests||0,N.inputTokens+=J.inputTokens||0,N.outputTokens+=J.outputTokens||0,N.cacheCreateTokens+=J.cacheCreateTokens||0,N.cacheReadTokens+=J.cacheReadTokens||0,N.allTokens+=J.allTokens||0,N.cost+=((st=J.costs)==null?void 0:st.total)||0}),N.formattedCost=q(N.cost),c==="daily"?I.value=N:d.value=N}else console.warn(`Failed to load ${c} stats:`,C.message)}catch(C){console.error(`Load ${c} stats error:`,C)}}async function L(c="daily"){if(y.value){p.value=!0;try{const C=await Y.getUserModelStats(y.value,c);if(C.success)h.value=C.data||[];else throw new Error(C.message||"加载模型统计失败")}catch(C){console.error("Load model stats error:",C),h.value=[]}finally{p.value=!1}}}async function j(c){if(!(u.value===c||p.value)){if(u.value=c,k.value&&S.value.length>0){await r(c);return}(c==="daily"&&!I.value||c==="monthly"&&!d.value)&&await O(c),await L(c)}}async function B(){var c,C;if(y.value){s.value=!0,f.value="",v.value=null,h.value=[];try{const D=await Y.getUserStats(y.value);if(D.success)v.value=D.data,console.log("API Stats - Full response:",D.data),console.log("API Stats - limits data:",D.data.limits),console.log("API Stats - weeklyOpusCostLimit:",(c=D.data.limits)==null?void 0:c.weeklyOpusCostLimit),console.log("API Stats - weeklyOpusCost:",(C=D.data.limits)==null?void 0:C.weeklyOpusCost),await G(),f.value="";else throw new Error(D.message||"查询失败")}catch(D){console.error("Load stats with apiId error:",D),f.value=D.message||"查询统计数据失败",v.value=null,h.value=[]}finally{s.value=!1}}}async function Q(){x.value=!0;try{const c=await Y.getOemSettings();c&&c.success&&c.data&&(w.value={...w.value,...c.data})}catch(c){console.error("Error loading OEM settings:",c),w.value={siteName:"AI Relay Service",siteIcon:"",siteIconData:"",showAdminButton:!1,ldapEnabled:!1}}finally{x.value=!1}}async function Z(){try{const c=await Y.getProductSettings();c&&c.success&&c.data&&Array.isArray(c.data.plans)?b.value=c.data.plans:b.value=[]}catch(c){console.error("Error loading product settings:",c),b.value=[]}}function q(c){return typeof c!="number"||c===0?"$0.000000":c>=1?"$"+c.toFixed(2):c>=.01?"$"+c.toFixed(4):"$"+c.toFixed(6)}function V(){if(y.value){const c=new URL(window.location);c.searchParams.set("apiId",y.value),window.history.pushState({},"",c)}}async function et(){const c=a();if(c.length===0){f.value="请输入至少一个有效的 API Key";return}s.value=!0,f.value="",P.value=null,g.value=[],i.value=[],h.value=[],$.value=c,S.value=[];try{const C=await Promise.allSettled(c.map(st=>Y.getKeyId(st))),D=[],N=[];if(C.forEach((st,ut)=>{st.status==="fulfilled"&&st.value.success?(D.push(st.value.data.id),N.push(c[ut])):i.value.push(c[ut])}),D.length===0)throw new Error("所有 API Key 都无效");S.value=D,$.value=N;const J=await Y.getBatchStats(D);if(J.success)P.value=J.data.aggregated,g.value=J.data.individual,v.value=J.data.aggregated,I.value=J.data.aggregated.dailyUsage||null,d.value=J.data.aggregated.monthlyUsage||null,await r(u.value),m();else throw new Error(J.message||"批量查询失败")}catch(C){console.error("Batch query error:",C),f.value=C.message||"批量查询统计数据失败",P.value=null,g.value=[]}finally{s.value=!1}}async function r(c="daily"){if(S.value.length!==0){p.value=!0;try{const C=await Y.getBatchModelStats(S.value,c);if(C.success)h.value=C.data||[];else throw new Error(C.message||"加载批量模型统计失败")}catch(C){console.error("Load batch model stats error:",C),h.value=[]}finally{p.value=!1}}}function a(){if(!T.value)return[];const c=T.value.split(/[,\n]+/).map(D=>D.trim()).filter(D=>D.length>=10&&D.length<=512);return[...new Set(c)].slice(0,30)}function m(){if(S.value.length>0){const c=new URL(window.location);c.searchParams.set("apiIds",S.value.join(",")),c.searchParams.set("batch","true"),window.history.pushState({},"",c)}}function A(){T.value=""}function z(){v.value=null,h.value=[],I.value=null,d.value=null,f.value="",u.value="daily",y.value=null,$.value=[],S.value=[],P.value=null,g.value=[],i.value=[]}function rt(){T.value="",k.value=!1,z()}return{apiKey:T,apiId:y,loading:s,modelStatsLoading:p,oemLoading:x,error:f,statsPeriod:u,statsData:v,modelStats:h,dailyStats:I,monthlyStats:d,oemSettings:w,productPlans:b,multiKeyMode:k,apiKeys:$,apiIds:S,aggregatedStats:P,individualStats:g,invalidKeys:i,currentPeriodData:W,usagePercentages:K,queryStats:R,queryBatchStats:et,loadAllPeriodStats:G,loadPeriodStats:O,loadModelStats:L,loadBatchModelStats:r,switchPeriod:j,loadStatsWithApiId:B,loadOemSettings:Q,loadProductSettings:Z,clearData:z,clearInput:A,reset:rt}}),Jt={class:"api-input-wide-card mb-8 rounded-3xl p-6 shadow-xl"},Yt={class:"mx-auto max-w-4xl"},Ht={class:"control-bar mb-4 flex flex-wrap items-center justify-between gap-3"},Xt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},Gt={class:"button-group flex items-center gap-2"},Qt={class:"mode-switch-group flex items-center rounded-lg bg-gray-100 p-1 dark:bg-gray-800"},Zt={key:0,class:"ml-1 rounded-full bg-white/20 px-1.5 py-0.5 text-xs font-semibold"},te={class:"api-input-grid grid grid-cols-1 gap-4 lg:grid-cols-4"},ee={class:"lg:col-span-3"},se=["disabled"],ae={key:1,class:"relative"},re=["disabled"],le={class:"lg:col-span-1"},ie=["disabled"],oe={key:0,class:"fas fa-spinner loading-spinner"},ne={key:1,class:"fas fa-search"},de={class:"security-notice mt-4"},ue={key:0,class:"mt-2 rounded-lg bg-blue-50 p-3 text-sm text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"},ce={__name:"ApiKeyInput",setup(T){const y=dt(),{apiKey:s,loading:p,multiKeyMode:x}=nt(y),{queryStats:f,clearInput:u}=y,v=H(()=>{if(!x.value||!s.value)return[];const I=s.value.split(/[,\n]+/).map(w=>w.trim()).filter(w=>w.length>0);return[...new Set(I)].slice(0,30)}),h=H(()=>x.value?v.value.length>0:s.value&&s.value.trim().length>0);return(I,d)=>(l(),n("div",Jt,[d[15]||(d[15]=t("div",{class:"wide-card-title mb-6"},[t("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[t("i",{class:"fas fa-chart-line mr-3"}),_(" 使用统计查询 ")]),t("p",{class:"text-base text-gray-600 dark:text-gray-400"},"查询您的 API Key 使用情况和统计数据")],-1)),t("div",Yt,[t("div",Ht,[t("label",Xt,[d[8]||(d[8]=t("i",{class:"fas fa-key mr-2"},null,-1)),_(" "+o(e(x)?"输入您的 API Keys（每行一个或用逗号分隔）":"输入您的 API Key"),1)]),t("div",Gt,[t("div",Qt,[t("button",{class:E(["mode-switch-btn",{active:!e(x)}]),title:"单一模式",onClick:d[0]||(d[0]=w=>x.value=!1)},d[9]||(d[9]=[t("i",{class:"fas fa-key"},null,-1),t("span",{class:"ml-2 hidden sm:inline"},"单一",-1)]),2),t("button",{class:E(["mode-switch-btn",{active:e(x)}]),title:"聚合模式",onClick:d[1]||(d[1]=w=>x.value=!0)},[d[10]||(d[10]=t("i",{class:"fas fa-layer-group"},null,-1)),d[11]||(d[11]=t("span",{class:"ml-2 hidden sm:inline"},"聚合",-1)),e(x)&&v.value.length>0?(l(),n("span",Zt,o(v.value.length),1)):U("",!0)],2)])])]),t("div",te,[t("div",ee,[e(x)?(l(),n("div",ae,[pt(t("textarea",{"onUpdate:modelValue":d[4]||(d[4]=w=>ft(s)?s.value=w:null),class:"wide-card-input w-full resize-y",disabled:e(p),placeholder:`请输入您的 API Keys，支持以下格式：
cr_xxx
cr_yyy
或
cr_xxx, cr_yyy`,rows:"4",onKeyup:d[5]||(d[5]=bt(mt((...w)=>e(f)&&e(f)(...w),["ctrl"]),["enter"]))},null,40,re),[[vt,e(s)]]),e(s)&&!e(p)?(l(),n("button",{key:0,class:"absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"清空输入",onClick:d[6]||(d[6]=(...w)=>e(u)&&e(u)(...w))},d[12]||(d[12]=[t("i",{class:"fas fa-times-circle"},null,-1)]))):U("",!0)])):pt((l(),n("input",{key:0,"onUpdate:modelValue":d[2]||(d[2]=w=>ft(s)?s.value=w:null),class:"wide-card-input w-full",disabled:e(p),placeholder:"请输入您的 API Key (cr_...)",type:"password",onKeyup:d[3]||(d[3]=bt((...w)=>e(f)&&e(f)(...w),["enter"]))},null,40,se)),[[vt,e(s)]])]),t("div",le,[t("button",{class:"btn btn-primary btn-query flex h-full w-full items-center justify-center gap-2",disabled:e(p)||!h.value,onClick:d[7]||(d[7]=(...w)=>e(f)&&e(f)(...w))},[e(p)?(l(),n("i",oe)):(l(),n("i",ne)),_(" "+o(e(p)?"查询中...":"查询统计"),1)],8,ie)])]),t("div",de,[d[13]||(d[13]=t("i",{class:"fas fa-shield-alt mr-2"},null,-1)),_(" "+o(e(x)?"您的 API Keys 仅用于查询统计数据，不会被存储。聚合模式下部分个体化信息将不显示。":"您的 API Key 仅用于查询自己的统计数据，不会被存储或用于其他用途"),1)]),e(x)?(l(),n("div",ue,d[14]||(d[14]=[t("i",{class:"fas fa-lightbulb mr-2"},null,-1),t("span",null,"提示：最多支持同时查询 30 个 API Keys。使用 Ctrl+Enter 快速查询。",-1)]))):U("",!0)])]))}},me=at(ce,[["__scopeId","data-v-11e74200"]]),fe={class:"space-y-6 md:space-y-8"},ge={class:"grid grid-cols-1 items-stretch gap-4 md:gap-6 xl:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)]"},xe={class:"card-section"},ye={class:"section-header"},pe={class:"header-title"},ve={key:0,class:"info-grid"},be={class:"info-item"},ke={class:"info-value"},_e={class:"info-item"},he={class:"info-value text-green-600 dark:text-emerald-400"},we={key:0,class:"info-item"},$e={class:"info-value text-red-500 dark:text-red-400"},Se={class:"info-item"},Ce={class:"info-value"},Te={class:"info-item"},Pe={class:"info-value"},Ke={class:"info-item"},Le={class:"info-value text-indigo-600 dark:text-indigo-300"},Ae={key:1,class:"info-item xl:col-span-2"},Ie={class:"space-y-2"},Me={class:"truncate"},qe={class:"font-semibold"},De={key:1,class:"info-grid"},Ue={class:"info-item"},Re={class:"info-value break-all"},Oe={class:"info-item"},Ee={class:"info-item"},je={class:"info-value"},Ne={class:"info-item"},Fe={class:"info-value break-all"},Be={class:"info-item xl:col-span-2"},We={class:"info-value"},Ve={class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},ze={key:0,class:"text-red-500 dark:text-red-400"},Je={key:1,class:"text-orange-500 dark:text-orange-400"},Ye={key:2},He={key:2,class:"text-gray-400 dark:text-gray-500"},Xe={class:"card-section"},Ge={class:"section-header"},Qe={class:"header-tag"},Ze={class:"metric-grid"},ts={class:"metric-card"},es={class:"metric-value text-green-600 dark:text-emerald-300"},ss={class:"metric-label"},as={class:"metric-card"},rs={class:"metric-value text-blue-600 dark:text-sky-300"},ls={class:"metric-label"},is={class:"metric-card"},os={class:"metric-value text-purple-600 dark:text-violet-300"},ns={class:"metric-label"},ds={class:"metric-card"},us={class:"metric-value text-amber-500 dark:text-amber-300"},cs={class:"metric-label"},ms={key:0,class:"card-section"},fs={class:"flex items-center justify-between gap-3"},gs={class:"flex items-center gap-3"},xs={class:"account-name"},ys={class:"account-sub"},ps={key:0,class:"mt-3 space-y-2"},vs={class:"progress-row"},bs={class:"progress-track"},ks={class:"progress-value"},_s={class:"flex flex-wrap items-center gap-2 text-xs text-gray-600 dark:text-gray-300"},hs={key:0,class:"font-medium text-indigo-600 dark:text-indigo-400"},ws={key:1,class:"mt-3"},$s={key:0,class:"space-y-2"},Ss={class:"quota-header"},Cs={class:"quota-percent"},Ts={class:"progress-track"},Ps={class:"quota-foot"},Ks={key:1,class:"rounded-xl bg-slate-100 px-3 py-2 text-xs text-slate-500 dark:bg-slate-800 dark:text-slate-300"},Ls={__name:"StatsOverview",setup(T){const y=dt(),{statsData:s,statsPeriod:p,currentPeriodData:x,multiKeyMode:f,aggregatedStats:u,individualStats:v,invalidKeys:h}=nt(y),I=H(()=>!v.value||v.value.length===0?[]:[...v.value].sort((r,a)=>{var m,A;return(((m=a.usage)==null?void 0:m.allTokens)||0)-(((A=r.usage)==null?void 0:A.allTokens)||0)}).slice(0,3)),d=r=>{var m;return!u.value||!u.value.usage.allTokens?0:((((m=r.usage)==null?void 0:m.allTokens)||0)/u.value.usage.allTokens*100).toFixed(1)},w=r=>{if(!r)return"无";try{return Lt(r).format("YYYY年MM月DD日 HH:mm")}catch{return"格式错误"}},b=r=>r?new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",k=r=>r?new Date(r)<new Date:!1,$=r=>{if(!r)return!1;const A=(new Date(r)-new Date)/(1e3*60*60*24);return A>0&&A<=7},S=r=>(typeof r!="number"&&(r=parseInt(r)||0),r===0?"0":r>=1e6?(r/1e6).toFixed(1)+"M":r>=1e3?(r/1e3).toFixed(1)+"K":r.toLocaleString()),P=r=>({claude:"Claude",gemini:"Gemini",all:"全部模型"})[r]||r||"未知",g=H(()=>{var m,A;const r=(A=(m=s.value)==null?void 0:m.accounts)==null?void 0:A.details;if(!r)return[];const a=[];return r.claude&&r.claude.accountType==="dedicated"&&a.push({key:"claude",...r.claude}),r.openai&&r.openai.accountType==="dedicated"&&a.push({key:"openai",...r.openai}),a}),i=H(()=>{const r=g.value.length;return r<=1?"md:grid-cols-1 lg:grid-cols-1":r===2?"md:grid-cols-2":"md:grid-cols-2 xl:grid-cols-3"}),W=r=>r?r.platform==="openai"?"OpenAI 专属账号":"Claude 专属账号":"专属账号",K=r=>{if(!r||r<=0)return"";const a=Math.floor(r),m=Math.floor(a/1440),A=Math.floor(a%1440/60),z=a%60;return m>0?A>0?`${m}天${A}小时`:`${m}天`:A>0?z>0?`${A}小时${z}分钟`:`${A}小时`:`${z}分钟`},R=r=>{if(!r)return{text:"状态未知",class:"text-gray-400"};if(r.isRateLimited){const a=K(r.minutesRemaining);return{text:`限流中${a?` · 剩余约 ${a}`:""}`,class:"text-red-500 dark:text-red-400"}}return{text:"未限流",class:"text-green-600 dark:text-emerald-400"}},G=(r,a)=>{if(!r||!a)return"暂无时间窗口信息";const m=new Date(r),A=new Date(a),z=rt=>`${`${rt.getHours()}`.padStart(2,"0")}:${`${rt.getMinutes()}`.padStart(2,"0")}`;return`${z(m)} - ${z(A)}`},O=r=>{if(!r||r<=0)return"";const a=Math.floor(r/60),m=r%60;return a>0?`${a}小时${m}分钟`:`${m}分钟`},L=(r,a)=>{var A;if(!r)return"bg-gradient-to-r from-blue-500 to-indigo-500";if((A=a==null?void 0:a.rateLimitStatus)!=null&&A.isRateLimited)return"bg-gradient-to-r from-red-500 to-red-600";const m=String(r).toLowerCase();return m==="rejected"?"bg-gradient-to-r from-red-500 to-red-600":m==="allowed_warning"?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-blue-500 to-indigo-500"},j=r=>{if(!r)return null;const a=typeof r.usedPercent=="number"&&!Number.isNaN(r.usedPercent)?r.usedPercent:null,m=typeof r.resetAfterSeconds=="number"&&!Number.isNaN(r.resetAfterSeconds)?r.resetAfterSeconds:null,A=typeof r.remainingSeconds=="number"?r.remainingSeconds:null,z=r.resetAt?Date.parse(r.resetAt):null;return m!==null&&(A!==null&&A<=0||z!==null&&!Number.isNaN(z)&&Date.now()>=z)?0:a===null?null:Math.max(0,Math.min(100,a))},B=r=>{const a=j(r);return a===null?"bg-gradient-to-r from-gray-300 to-gray-400":a>=90?"bg-gradient-to-r from-red-500 to-red-600":a>=75?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-emerald-500 to-teal-500"},Q=r=>{const a=j(r);return a===null?"0%":`${a}%`},Z=r=>{const a=j(r);return a===null?"--":`${a.toFixed(1)}%`},q=r=>{if(!r)return"--";if(r.resetAt){const m=Date.parse(r.resetAt);if(!Number.isNaN(m)){const A=Math.max(0,Math.floor((m-Date.now())/1e3));return V(A)}}let a=r.remainingSeconds;return a==null&&(a=r.resetAfterSeconds),a==null||Number.isNaN(Number(a))?"--":(a=Math.max(0,Math.floor(Number(a))),V(a))},V=r=>{const a=Math.floor(r/86400),m=Math.floor(r%86400/3600),A=Math.floor(r%3600/60),z=r%60;return a>0?m>0?`${a}天${m}小时`:`${a}天`:m>0?A>0?`${m}小时${A}分钟`:`${m}小时`:A>0?`${A}分钟`:`${z}秒`},et=r=>r==="secondary"?"周限":"5h";return(r,a)=>(l(),n("div",fe,[t("div",ge,[t("div",xe,[t("header",ye,[t("i",{class:E(["header-icon",e(f)?"fas fa-layer-group text-purple-500":"fas fa-info-circle text-blue-500"])},null,2),t("h3",pe,o(e(f)?"批量查询概要":"API Key 信息"),1)]),e(f)&&e(u)?(l(),n("div",ve,[t("div",be,[a[0]||(a[0]=t("p",{class:"info-label"},"查询 Keys 数",-1)),t("p",ke,o(e(u).totalKeys)+" 个",1)]),t("div",_e,[a[2]||(a[2]=t("p",{class:"info-label"},"有效 Keys 数",-1)),t("p",he,[a[1]||(a[1]=t("i",{class:"fas fa-check-circle mr-1"},null,-1)),_(o(e(u).activeKeys)+" 个 ",1)])]),e(h).length>0?(l(),n("div",we,[a[4]||(a[4]=t("p",{class:"info-label"},"无效 Keys 数",-1)),t("p",$e,[a[3]||(a[3]=t("i",{class:"fas fa-times-circle mr-1"},null,-1)),_(o(e(h).length)+" 个 ",1)])])):U("",!0),t("div",Se,[a[5]||(a[5]=t("p",{class:"info-label"},"总请求数",-1)),t("p",Ce,o(S(e(u).usage.requests)),1)]),t("div",Te,[a[6]||(a[6]=t("p",{class:"info-label"},"总 Token 数",-1)),t("p",Pe,o(S(e(u).usage.allTokens)),1)]),t("div",Ke,[a[7]||(a[7]=t("p",{class:"info-label"},"总费用",-1)),t("p",Le,o(e(u).usage.formattedCost),1)]),e(v).length>1?(l(),n("div",Ae,[a[8]||(a[8]=t("p",{class:"info-label"},"Top 3 贡献占比",-1)),t("div",Ie,[(l(!0),n(tt,null,lt(I.value,m=>(l(),n("div",{key:m.apiId,class:"contributor-item"},[t("span",Me,o(m.name),1),t("span",qe,o(d(m))+"%",1)]))),128))])])):U("",!0)])):(l(),n("div",De,[t("div",Ue,[a[9]||(a[9]=t("p",{class:"info-label"},"名称",-1)),t("p",Re,o(e(s).name),1)]),t("div",Oe,[a[10]||(a[10]=t("p",{class:"info-label"},"状态",-1)),t("p",{class:E(["info-value font-semibold",e(s).isActive?"text-green-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"])},[t("i",{class:E(["mr-1",e(s).isActive?"fas fa-check-circle":"fas fa-times-circle"])},null,2),_(" "+o(e(s).isActive?"活跃":"已停用"),1)],2)]),t("div",Ee,[a[11]||(a[11]=t("p",{class:"info-label"},"权限",-1)),t("p",je,o(P(e(s).permissions)),1)]),t("div",Ne,[a[12]||(a[12]=t("p",{class:"info-label"},"创建时间",-1)),t("p",Fe,o(w(e(s).createdAt)),1)]),t("div",Be,[a[17]||(a[17]=t("p",{class:"info-label"},"过期时间",-1)),t("div",We,[e(s).expirationMode==="activation"&&!e(s).isActivated?(l(),n(tt,{key:0},[a[13]||(a[13]=t("span",{class:"text-amber-600 dark:text-amber-400"},[t("i",{class:"fas fa-pause-circle mr-1"}),_("未激活 ")],-1)),t("span",Ve," 首次使用后 "+o(e(s).activationDays||(e(s).activationUnit==="hours"?24:30))+" "+o(e(s).activationUnit==="hours"?"小时":"天")+"过期 ",1)],64)):e(s).expiresAt?(l(),n(tt,{key:1},[k(e(s).expiresAt)?(l(),n("span",ze,a[14]||(a[14]=[t("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),_("已过期 ",-1)]))):$(e(s).expiresAt)?(l(),n("span",Je,[a[15]||(a[15]=t("i",{class:"fas fa-clock mr-1"},null,-1)),_(o(b(e(s).expiresAt)),1)])):(l(),n("span",Ye,o(b(e(s).expiresAt)),1))],64)):(l(),n("span",He,a[16]||(a[16]=[t("i",{class:"fas fa-infinity mr-1"},null,-1),_("永不过期 ",-1)])))])])]))]),t("div",Xe,[t("header",Ge,[a[18]||(a[18]=t("i",{class:"header-icon fas fa-chart-bar text-green-500"},null,-1)),a[19]||(a[19]=t("h3",{class:"header-title"},"使用统计概览",-1)),t("span",Qe,o(e(p)==="daily"?"今日":"本月"),1)]),t("div",Ze,[t("div",ts,[t("p",es,o(S(e(x).requests)),1),t("p",ss,o(e(p)==="daily"?"今日":"本月")+"请求数",1)]),t("div",as,[t("p",rs,o(S(e(x).allTokens)),1),t("p",ls,o(e(p)==="daily"?"今日":"本月")+"Token 数",1)]),t("div",is,[t("p",os,o(e(x).formattedCost||"$0.000000"),1),t("p",ns,o(e(p)==="daily"?"今日":"本月")+"费用",1)]),t("div",ds,[t("p",us,o(S(e(x).inputTokens)),1),t("p",cs,o(e(p)==="daily"?"今日":"本月")+"输入 Token",1)])])])]),!e(f)&&g.value.length>0?(l(),n("div",ms,[a[21]||(a[21]=t("header",{class:"section-header"},[t("i",{class:"header-icon fas fa-plug text-indigo-500"}),t("h3",{class:"header-title"},"专属账号运行状态"),t("span",{class:"header-tag"},"实时更新")],-1)),t("div",{class:E(["grid grid-cols-1 gap-4",i.value])},[(l(!0),n(tt,null,lt(g.value,m=>{var A,z,rt,c,C,D;return l(),n("div",{key:m.id||m.key,class:"account-card"},[t("div",fs,[t("div",gs,[t("span",{class:E(["account-icon",m.platform==="claude"?"icon-claude":"icon-openai"])},[t("i",{class:E(m.platform==="claude"?"fas fa-meteor":"fas fa-robot")},null,2)],2),t("div",null,[t("p",xs,o(W(m)),1),t("p",ys,o(m.platform==="claude"?"会话窗口":"额度窗口"),1)])]),R(m.rateLimitStatus)?(l(),n("div",{key:0,class:E(["rate-badge",R(m.rateLimitStatus).class])},[a[20]||(a[20]=t("i",{class:"fas fa-tachometer-alt mr-1"},null,-1)),_(" "+o(R(m.rateLimitStatus).text),1)],2)):U("",!0)]),m.platform==="claude"?(l(),n("div",ps,[t("div",vs,[t("div",bs,[t("div",{class:E(["progress-bar",L((A=m.sessionWindow)==null?void 0:A.sessionWindowStatus,m)]),style:it({width:`${Math.min(100,Math.max(0,((z=m.sessionWindow)==null?void 0:z.progress)||0))}%`})},null,6)]),t("span",ks,o(Math.min(100,Math.max(0,Math.round(((rt=m.sessionWindow)==null?void 0:rt.progress)||0))))+"% ",1)]),t("div",_s,[t("span",null,o(G((c=m.sessionWindow)==null?void 0:c.windowStart,(C=m.sessionWindow)==null?void 0:C.windowEnd)),1),((D=m.sessionWindow)==null?void 0:D.remainingTime)>0?(l(),n("span",hs," 剩余 "+o(O(m.sessionWindow.remainingTime)),1)):U("",!0)])])):m.platform==="openai"?(l(),n("div",ws,[m.codexUsage?(l(),n("div",$s,[(l(),n(tt,null,lt(["primary","secondary"],N=>{var J,st,ut,yt;return t("div",{key:`${m.key}-${N}`,class:"quota-row"},[t("div",Ss,[t("span",{class:E(["quota-tag",N==="primary"?"tag-indigo":"tag-blue"])},o(et(N)),3),t("span",Cs,o(Z((J=m.codexUsage)==null?void 0:J[N])),1)]),t("div",Ts,[t("div",{class:E(["progress-bar",B((st=m.codexUsage)==null?void 0:st[N])]),style:it({width:Q((ut=m.codexUsage)==null?void 0:ut[N])})},null,6)]),t("div",Ps," 重置剩余 "+o(q((yt=m.codexUsage)==null?void 0:yt[N])),1)])}),64))])):(l(),n("p",Ks," 暂无额度使用数据 "))])):U("",!0)])}),128))],2)])):U("",!0)]))}},As=at(Ls,[["__scopeId","data-v-9d2116ba"]]),Is={class:"card p-4 md:p-6"},Ms={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},qs={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Ds={class:"space-y-2 md:space-y-3"},Us={class:"flex items-center justify-between"},Rs={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Os={class:"flex items-center justify-between"},Es={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},js={class:"flex items-center justify-between"},Ns={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Fs={class:"flex items-center justify-between"},Bs={class:"text-sm font-medium text-gray-900 dark:text-gray-100 md:text-base"},Ws={class:"mt-3 border-t border-gray-200 pt-3 dark:border-gray-700 md:mt-4 md:pt-4"},Vs={class:"flex items-center justify-between font-bold text-gray-900 dark:text-gray-100"},zs={class:"text-sm md:text-base"},Js={class:"text-lg md:text-xl"},Ys={__name:"TokenDistribution",setup(T){const y=dt(),{statsPeriod:s,currentPeriodData:p}=nt(y),x=f=>(typeof f!="number"&&(f=parseInt(f)||0),f===0?"0":f>=1e6?(f/1e6).toFixed(1)+"M":f>=1e3?(f/1e3).toFixed(1)+"K":f.toLocaleString());return(f,u)=>(l(),n("div",Is,[t("h3",Ms,[u[0]||(u[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-coins mr-2 text-sm text-yellow-500 md:mr-3 md:text-base"}),_(" Token 使用分布 ")],-1)),t("span",qs,"("+o(e(s)==="daily"?"今日":"本月")+")",1)]),t("div",Ds,[t("div",Us,[u[1]||(u[1]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-right mr-1 text-xs text-green-500 md:mr-2 md:text-sm"}),_(" 输入 Token ")],-1)),t("span",Rs,o(x(e(p).inputTokens)),1)]),t("div",Os,[u[2]||(u[2]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-arrow-left mr-1 text-xs text-blue-500 md:mr-2 md:text-sm"}),_(" 输出 Token ")],-1)),t("span",Es,o(x(e(p).outputTokens)),1)]),t("div",js,[u[3]||(u[3]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-save mr-1 text-xs text-purple-500 md:mr-2 md:text-sm"}),_(" 缓存创建 Token ")],-1)),t("span",Ns,o(x(e(p).cacheCreateTokens)),1)]),t("div",Fs,[u[4]||(u[4]=t("span",{class:"flex items-center text-sm text-gray-600 dark:text-gray-400 md:text-base"},[t("i",{class:"fas fa-download mr-1 text-xs text-orange-500 md:mr-2 md:text-sm"}),_(" 缓存读取 Token ")],-1)),t("span",Bs,o(x(e(p).cacheReadTokens)),1)])]),t("div",Ws,[t("div",Vs,[t("span",zs,o(e(s)==="daily"?"今日":"本月")+"总计",1),t("span",Js,o(x(e(p).allTokens)),1)])])]))}},Hs=at(Ys,[["__scopeId","data-v-d9e5c1dd"]]),Xs={class:"flex h-full flex-col gap-4 md:gap-6"},Gs={class:"card flex h-full flex-col p-4 md:p-6"},Qs={class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},Zs={key:0,class:"space-y-4"},ta={class:"rounded-lg bg-gradient-to-r from-blue-50 to-indigo-50 p-4 dark:from-blue-900/20 dark:to-indigo-900/20"},ea={class:"mb-3 flex items-center justify-between"},sa={class:"rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-700 dark:bg-blue-800 dark:text-blue-200"},aa={class:"grid grid-cols-2 gap-3"},ra={class:"text-center"},la={class:"text-lg font-bold text-gray-900 dark:text-gray-100"},ia={class:"text-center"},oa={class:"text-lg font-bold text-green-600"},na={class:"rounded-lg bg-gradient-to-r from-purple-50 to-pink-50 p-4 dark:from-purple-900/20 dark:to-pink-900/20"},da={class:"space-y-2"},ua={class:"flex items-center justify-between"},ca={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},ma={class:"flex items-center justify-between"},fa={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},ga={class:"flex items-center justify-between"},xa={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},ya={key:0,class:"rounded-lg bg-red-50 p-3 text-sm dark:bg-red-900/20"},pa={class:"text-red-700 dark:text-red-300"},va={key:1,class:"space-y-4 md:space-y-5"},ba={class:"mb-2 flex items-center justify-between"},ka={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},_a={key:0},ha={key:1,class:"flex items-center gap-1"},wa={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},$a={key:1,class:"h-2 w-full rounded-full bg-gray-200"},Sa={class:"mt-2"},Ca={class:"mb-2 flex items-center justify-between"},Ta={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},Pa={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Ka={key:1,class:"h-2 w-full rounded-full bg-gray-200"},La={class:"mb-2 flex items-center justify-between"},Aa={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},Ia={key:0},Ma={key:1,class:"flex items-center gap-1"},qa={key:0,class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},Da={key:1,class:"h-2 w-full rounded-full bg-gray-200"},Ua={key:0},Ra={class:"mb-2 flex items-center justify-between"},Oa={class:"text-xs text-gray-500 dark:text-gray-400 md:text-sm"},Ea={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},ja={key:1},Na={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},Fa={key:0},Ba={key:1},Wa={key:2},Va={class:"space-y-4 border-t border-gray-100 pt-3 dark:border-gray-700"},za={class:"flex items-center justify-between"},Ja={class:"text-sm font-medium text-gray-900 md:text-base"},Ya={key:0},Ha={key:1,class:"flex items-center gap-1"},Xa={class:"flex items-center justify-between"},Ga={class:"text-sm font-medium text-gray-900 md:text-base"},Qa={key:0,class:"text-orange-600"},Za={key:1,class:"text-green-600"},tr={class:"space-y-2"},er={class:"flex items-center justify-between"},sr={class:"text-sm font-medium text-gray-900 md:text-base"},ar={key:0,class:"text-orange-600"},rr={key:1,class:"text-green-600"},lr={key:0,class:"flex flex-wrap gap-2 rounded-lg bg-blue-50 p-2 dark:bg-blue-900/20 md:p-3"},ir={key:0,class:"card p-4 md:p-6"},or={class:"rounded-lg border border-amber-200 bg-amber-50 p-3 dark:border-amber-800 dark:bg-amber-900/20 md:p-4"},nr={class:"space-y-1 md:space-y-2"},dr={class:"break-all text-gray-800 dark:text-gray-200"},ur={__name:"LimitConfig",setup(T){const y=dt(),{statsData:s,multiKeyMode:p,aggregatedStats:x,invalidKeys:f}=nt(y),u=H(()=>{var i;const g=(i=s.value)==null?void 0:i.restrictions;return g?g.enableModelRestriction===!0&&Array.isArray(g.restrictedModels)&&g.restrictedModels.length>0:!1}),v=H(()=>{var i;const g=(i=s.value)==null?void 0:i.restrictions;return g?g.enableClientRestriction===!0&&Array.isArray(g.allowedClients)&&g.allowedClients.length>0:!1}),h=()=>{if(!s.value.limits.dailyCostLimit||s.value.limits.dailyCostLimit===0)return 0;const g=s.value.limits.currentDailyCost/s.value.limits.dailyCostLimit*100;return Math.min(g,100)},I=()=>{const g=h();return g>=100?"bg-red-500":g>=80?"bg-yellow-500":"bg-green-500"},d=()=>{if(!s.value.limits.totalCostLimit||s.value.limits.totalCostLimit===0)return 0;const g=s.value.limits.currentTotalCost/s.value.limits.totalCostLimit*100;return Math.min(g,100)},w=()=>{const g=d();return g>=100?"bg-red-500":g>=80?"bg-yellow-500":"bg-blue-500"},b=()=>{const g=s.value.limits.dailyRequestsLimit||0;if(!g)return 0;const i=s.value.limits.currentDailyRequests||0;return Math.min(i/g*100,100)},k=()=>{const g=b();return g>=100?"bg-red-500":g>=80?"bg-yellow-500":"bg-green-500"},$=()=>{if(!s.value.limits.weeklyOpusCostLimit||s.value.limits.weeklyOpusCostLimit===0)return 0;const g=s.value.limits.weeklyOpusCost/s.value.limits.weeklyOpusCostLimit*100;return Math.min(g,100)},S=()=>{const g=$();return g>=100?"bg-red-500":g>=80?"bg-yellow-500":"bg-indigo-500"},P=g=>(typeof g!="number"&&(g=parseInt(g)||0),g===0?"0":g>=1e6?(g/1e6).toFixed(1)+"M":g>=1e3?(g/1e3).toFixed(1)+"K":g.toLocaleString());return(g,i)=>(l(),n("div",Xs,[t("div",Gs,[t("h3",Qs,[i[0]||(i[0]=t("i",{class:"fas fa-shield-alt mr-2 text-sm text-red-500 md:mr-3 md:text-base"},null,-1)),_(" "+o(e(p)?"限制配置（聚合查询模式）":"限制配置"),1)]),e(p)&&e(x)?(l(),n("div",Zs,[t("div",ta,[t("div",ea,[i[1]||(i[1]=t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},[t("i",{class:"fas fa-layer-group mr-2 text-blue-500"}),_(" API Keys 概况 ")],-1)),t("span",sa,o(e(x).activeKeys)+"/"+o(e(x).totalKeys),1)]),t("div",aa,[t("div",ra,[t("div",la,o(e(x).totalKeys),1),i[2]||(i[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"总计 Keys",-1))]),t("div",ia,[t("div",oa,o(e(x).activeKeys),1),i[3]||(i[3]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400"},"激活 Keys",-1))])])]),t("div",na,[i[7]||(i[7]=t("div",{class:"mb-3 flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-purple-500"}),t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"聚合统计摘要")],-1)),t("div",da,[t("div",ua,[i[4]||(i[4]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-database mr-1 text-gray-400"}),_(" 总请求数 ")],-1)),t("span",ca,o(P(e(x).usage.requests)),1)]),t("div",ma,[i[5]||(i[5]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-coins mr-1 text-yellow-500"}),_(" 总 Tokens ")],-1)),t("span",fa,o(P(e(x).usage.allTokens)),1)]),t("div",ga,[i[6]||(i[6]=t("span",{class:"text-xs text-gray-600 dark:text-gray-400"},[t("i",{class:"fas fa-dollar-sign mr-1 text-green-500"}),_(" 总费用 ")],-1)),t("span",xa,o(e(x).usage.formattedCost),1)])])]),e(f)&&e(f).length>0?(l(),n("div",ya,[i[8]||(i[8]=t("i",{class:"fas fa-exclamation-triangle mr-2 text-red-600 dark:text-red-400"},null,-1)),t("span",pa,o(e(f).length)+" 个无效的 API Key ",1)])):U("",!0),i[9]||(i[9]=t("div",{class:"rounded-lg bg-gray-50 p-3 text-xs text-gray-600 dark:bg-gray-800 dark:text-gray-400"},[t("i",{class:"fas fa-info-circle mr-1"}),_(" 每个 API Key 有独立的限制设置，聚合模式下不显示单个限制配置 ")],-1))])):U("",!0),e(p)?U("",!0):(l(),n("div",va,[t("div",null,[t("div",ba,[i[11]||(i[11]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"每日费用限制",-1)),t("span",ka,[e(s).limits.dailyCostLimit>0?(l(),n("span",_a," $"+o(e(s).limits.currentDailyCost.toFixed(4))+" / $"+o(e(s).limits.dailyCostLimit.toFixed(2)),1)):(l(),n("span",ha,[_(" $"+o(e(s).limits.currentDailyCost.toFixed(4))+" / ",1),i[10]||(i[10]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(s).limits.dailyCostLimit>0?(l(),n("div",wa,[t("div",{class:E(["h-2 rounded-full transition-all duration-300",I()]),style:it({width:h()+"%"})},null,6)])):(l(),n("div",$a,i[12]||(i[12]=[t("div",{class:"h-2 rounded-full bg-green-500",style:{width:"0%"}},null,-1)])))]),t("div",Sa,[t("div",Ca,[i[15]||(i[15]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"每日请求限制",-1)),t("span",Ta,[e(s).limits.dailyRequestsLimit>0?(l(),n(tt,{key:0},[_(o(P(e(s).limits.currentDailyRequests))+" / "+o(P(e(s).limits.dailyRequestsLimit))+" 次 ",1)],64)):(l(),n(tt,{key:1},[i[13]||(i[13]=t("i",{class:"fas fa-infinity text-gray-400"},null,-1)),i[14]||(i[14]=_(" 不限制 ",-1))],64))])]),e(s).limits.dailyRequestsLimit>0?(l(),n("div",Pa,[t("div",{class:E(["h-2 rounded-full transition-all duration-300",k()]),style:it({width:b()+"%"})},null,6)])):(l(),n("div",Ka,i[16]||(i[16]=[t("div",{class:"h-2 rounded-full bg-green-500",style:{width:"0%"}},null,-1)])))]),t("div",null,[t("div",La,[i[18]||(i[18]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"总费用限制",-1)),t("span",Aa,[e(s).limits.totalCostLimit>0?(l(),n("span",Ia," $"+o(e(s).limits.currentTotalCost.toFixed(4))+" / $"+o(e(s).limits.totalCostLimit.toFixed(2)),1)):(l(),n("span",Ma,[_(" $"+o(e(s).limits.currentTotalCost.toFixed(4))+" / ",1),i[17]||(i[17]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),e(s).limits.totalCostLimit>0?(l(),n("div",qa,[t("div",{class:E(["h-2 rounded-full transition-all duration-300",w()]),style:it({width:d()+"%"})},null,6)])):(l(),n("div",Da,i[19]||(i[19]=[t("div",{class:"h-2 rounded-full bg-blue-500",style:{width:"0%"}},null,-1)])))]),e(s).limits.weeklyOpusCostLimit>0?(l(),n("div",Ua,[t("div",Ra,[i[20]||(i[20]=t("span",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 md:text-base"},"Opus 模型周费用限制",-1)),t("span",Oa," $"+o(e(s).limits.weeklyOpusCost.toFixed(4))+" / $"+o(e(s).limits.weeklyOpusCostLimit.toFixed(2)),1)]),t("div",Ea,[t("div",{class:E(["h-2 rounded-full transition-all duration-300",S()]),style:it({width:$()+"%"})},null,6)])])):U("",!0),e(s).limits.rateLimitWindow>0&&(e(s).limits.rateLimitRequests>0||e(s).limits.tokenLimit>0||e(s).limits.rateLimitCost>0)?(l(),n("div",ja,[F(It,{"cost-limit":e(s).limits.rateLimitCost,"current-cost":e(s).limits.currentWindowCost,"current-requests":e(s).limits.currentWindowRequests,"current-tokens":e(s).limits.currentWindowTokens,label:"时间窗口限制","rate-limit-window":e(s).limits.rateLimitWindow,"request-limit":e(s).limits.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":e(s).limits.tokenLimit,"window-end-time":e(s).limits.windowEndTime,"window-remaining-seconds":e(s).limits.windowRemainingSeconds,"window-start-time":e(s).limits.windowStartTime},null,8,["cost-limit","current-cost","current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"]),t("div",Na,[i[21]||(i[21]=t("i",{class:"fas fa-info-circle mr-1"},null,-1)),e(s).limits.rateLimitCost>0?(l(),n("span",Fa,' 请求次数和费用限制为"或"的关系，任一达到限制即触发限流 ')):e(s).limits.tokenLimit>0?(l(),n("span",Ba,' 请求次数和Token使用量为"或"的关系，任一达到限制即触发限流 ')):(l(),n("span",Wa," 仅限制请求次数 "))])])):U("",!0),t("div",Va,[t("div",za,[i[23]||(i[23]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"并发限制",-1)),t("span",Ja,[e(s).limits.concurrencyLimit>0?(l(),n("span",Ya,o(e(s).limits.concurrencyLimit),1)):(l(),n("span",Ha,i[22]||(i[22]=[t("i",{class:"fas fa-infinity text-gray-400"},null,-1)])))])]),t("div",Xa,[i[26]||(i[26]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"模型限制",-1)),t("span",Ga,[u.value?(l(),n("span",Qa,[i[24]||(i[24]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),_(" 限制 "+o(e(s).restrictions.restrictedModels.length)+" 个模型 ",1)])):(l(),n("span",Za,i[25]||(i[25]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),_(" 允许所有模型 ",-1)])))])]),t("div",tr,[t("div",er,[i[29]||(i[29]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"客户端限制",-1)),t("span",sr,[v.value?(l(),n("span",ar,[i[27]||(i[27]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs md:text-sm"},null,-1)),_(" 限 "+o(e(s).restrictions.allowedClients.length)+" 种客户端使用 ",1)])):(l(),n("span",rr,i[28]||(i[28]=[t("i",{class:"fas fa-check-circle mr-1 text-xs md:text-sm"},null,-1),_(" 允许所有客户端 ",-1)])))])]),v.value?(l(),n("div",lr,[(l(!0),n(tt,null,lt(e(s).restrictions.allowedClients,W=>(l(),n("span",{key:W,class:"flex items-center gap-1 rounded-full bg-white px-2 py-1 text-xs text-blue-700 shadow-sm dark:bg-slate-900 dark:text-blue-300 md:text-sm"},[i[30]||(i[30]=t("i",{class:"fas fa-id-badge"},null,-1)),_(" "+o(W),1)]))),128))])):U("",!0)])])]))]),u.value?(l(),n("div",ir,[i[34]||(i[34]=t("h3",{class:"mb-3 flex items-center text-lg font-bold text-gray-900 dark:text-gray-100 md:mb-4 md:text-xl"},[t("i",{class:"fas fa-list-alt mr-2 text-sm text-amber-500 md:mr-3 md:text-base"}),_(" 详细限制信息 ")],-1)),t("div",or,[i[32]||(i[32]=t("h4",{class:"mb-2 flex items-center text-sm font-bold text-amber-800 dark:text-amber-300 md:mb-3 md:text-base"},[t("i",{class:"fas fa-robot mr-1 text-xs md:mr-2 md:text-sm"}),_(" 受限模型列表 ")],-1)),t("div",nr,[(l(!0),n(tt,null,lt(e(s).restrictions.restrictedModels,W=>(l(),n("div",{key:W,class:"rounded border border-amber-200 bg-white px-2 py-1 text-xs dark:border-amber-700 dark:bg-gray-800 md:px-3 md:py-2 md:text-sm"},[i[31]||(i[31]=t("i",{class:"fas fa-ban mr-1 text-xs text-red-500 md:mr-2"},null,-1)),t("span",dr,o(W),1)]))),128))]),i[33]||(i[33]=t("p",{class:"mt-2 text-xs text-amber-700 dark:text-amber-400 md:mt-3"},[t("i",{class:"fas fa-info-circle mr-1"}),_(" 此 API Key 不能访问以上列出的模型 ")],-1))])])):U("",!0)]))}},cr=at(ur,[["__scopeId","data-v-98371c00"]]),mr={class:"card h-full p-4 md:p-6"},fr={class:"mb-3 flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:mb-4 md:text-xl"},gr={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},xr={key:0,class:"space-y-2 md:space-y-3"},yr={class:"mb-1 flex items-center justify-between text-sm"},pr={class:"truncate font-medium text-gray-700 dark:text-gray-300"},vr={class:"text-xs text-gray-600 dark:text-gray-400"},br={class:"h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700"},kr={class:"mt-1 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},_r={key:0,class:"border-t border-gray-200 pt-2 dark:border-gray-700"},hr={class:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400"},wr={key:1,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},$r={key:2,class:"flex h-32 items-center justify-center text-sm text-gray-500 dark:text-gray-400"},Sr={__name:"AggregatedStatsCard",setup(T){const y=dt(),{aggregatedStats:s,individualStats:p,statsPeriod:x,multiKeyMode:f}=nt(y),u=k=>k?x.value==="daily"?k.dailyUsage||k.usage:k.monthlyUsage||k.usage:null,v=H(()=>!p.value||p.value.length===0?[]:[...p.value].sort((k,$)=>{const S=u(k),P=u($);return((P==null?void 0:P.cost)||0)-((S==null?void 0:S.cost)||0)}).slice(0,5)),h=H(()=>p.value?Math.max(0,p.value.length-5):0),I=H(()=>{var P,g;if(!p.value||!s.value)return 0;const k=v.value.reduce((i,W)=>{const K=u(W);return i+((K==null?void 0:K.cost)||0)},0),$=x.value==="daily"?((P=s.value.dailyUsage)==null?void 0:P.cost)||0:((g=s.value.monthlyUsage)==null?void 0:g.cost)||0;if($===0)return 0;const S=$-k;return Math.max(0,Math.round(S/$*100))}),d=k=>{var g,i;if(!s.value)return 0;const $=x.value==="daily"?((g=s.value.dailyUsage)==null?void 0:g.cost)||0:((i=s.value.monthlyUsage)==null?void 0:i.cost)||0;if($===0)return 0;const S=u(k),P=((S==null?void 0:S.cost)||0)/$*100;return Math.round(P)},w=k=>["bg-blue-500","bg-green-500","bg-purple-500","bg-yellow-500","bg-pink-500"][k]||"bg-gray-400",b=k=>(typeof k!="number"&&(k=parseInt(k)||0),k===0?"0":k>=1e6?(k/1e6).toFixed(1)+"M":k>=1e3?(k/1e3).toFixed(1)+"K":k.toLocaleString());return(k,$)=>(l(),n("div",mr,[t("h3",fr,[$[0]||($[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-chart-pie mr-2 text-sm text-orange-500 md:mr-3 md:text-base"}),_(" 使用占比 ")],-1)),t("span",gr,"("+o(e(x)==="daily"?"今日":"本月")+")",1)]),e(s)&&e(p).length>0?(l(),n("div",xr,[(l(!0),n(tt,null,lt(v.value,(S,P)=>{var g,i;return l(),n("div",{key:S.apiId,class:"relative"},[t("div",yr,[t("span",pr,o(S.name||`Key ${P+1}`),1),t("span",vr,o(d(S))+"% ",1)]),t("div",br,[t("div",{class:E(["h-2 rounded-full transition-all duration-300",w(P)]),style:it({width:d(S)+"%"})},null,6)]),t("div",kr,[t("span",null,o(b(((g=u(S))==null?void 0:g.requests)||0))+"次",1),t("span",null,o(((i=u(S))==null?void 0:i.formattedCost)||"$0.00"),1)])])}),128)),h.value>0?(l(),n("div",_r,[t("div",hr,[t("span",null,"其他 "+o(h.value)+" 个Keys",1),t("span",null,o(I.value)+"%",1)])])):U("",!0)])):e(f)?(l(),n("div",$r,$[2]||($[2]=[t("i",{class:"fas fa-chart-pie mr-2"},null,-1),_(" 暂无数据 ",-1)]))):(l(),n("div",wr,$[1]||($[1]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-chart-pie mb-2 text-2xl"}),t("p",null,"使用占比仅在多Key查询时显示")],-1)])))]))}},Cr=at(Sr,[["__scopeId","data-v-39572a8e"]]),Tr={class:"card p-4 md:p-6"},Pr={class:"mb-4 md:mb-6"},Kr={class:"flex flex-col text-lg font-bold text-gray-900 dark:text-gray-100 sm:flex-row sm:items-center md:text-xl"},Lr={class:"text-xs font-normal text-gray-600 dark:text-gray-400 sm:ml-2 md:text-sm"},Ar={key:0,class:"py-6 text-center md:py-8"},Ir={key:1,class:"space-y-3 md:space-y-4"},Mr={class:"mb-2 flex items-start justify-between md:mb-3"},qr={class:"min-w-0 flex-1"},Dr={class:"break-all text-base font-bold text-gray-900 dark:text-gray-100 md:text-lg"},Ur={class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},Rr={class:"ml-3 flex-shrink-0 text-right"},Or={class:"text-base font-bold text-green-600 md:text-lg"},Er={class:"grid grid-cols-2 gap-2 text-xs md:grid-cols-4 md:gap-3 md:text-sm"},jr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Nr={class:"font-medium text-gray-900 dark:text-gray-100"},Fr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Br={class:"font-medium text-gray-900 dark:text-gray-100"},Wr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Vr={class:"font-medium text-gray-900 dark:text-gray-100"},zr={class:"rounded bg-gray-50 p-2 dark:bg-gray-700"},Jr={class:"font-medium text-gray-900 dark:text-gray-100"},Yr={key:2,class:"py-6 text-center text-gray-500 dark:text-gray-400 md:py-8"},Hr={class:"text-sm md:text-base"},Xr={__name:"ModelUsageStats",setup(T){const y=dt(),{statsPeriod:s,modelStats:p,modelStatsLoading:x}=nt(y),f=u=>(typeof u!="number"&&(u=parseInt(u)||0),u===0?"0":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e3?(u/1e3).toFixed(1)+"K":u.toLocaleString());return(u,v)=>(l(),n("div",Tr,[t("div",Pr,[t("h3",Kr,[v[0]||(v[0]=t("span",{class:"flex items-center"},[t("i",{class:"fas fa-robot mr-2 text-sm text-indigo-500 md:mr-3 md:text-base"}),_(" 模型使用统计 ")],-1)),t("span",Lr,"("+o(e(s)==="daily"?"今日":"本月")+")",1)])]),e(x)?(l(),n("div",Ar,v[1]||(v[1]=[t("i",{class:"fas fa-spinner loading-spinner mb-2 text-xl text-gray-600 dark:text-gray-400 md:text-2xl"},null,-1),t("p",{class:"text-sm text-gray-600 dark:text-gray-400 md:text-base"},"加载模型统计数据中...",-1)]))):e(p).length>0?(l(),n("div",Ir,[(l(!0),n(tt,null,lt(e(p),(h,I)=>{var d;return l(),n("div",{key:I,class:"model-usage-item"},[t("div",Mr,[t("div",qr,[t("h4",Dr,o(h.model),1),t("p",Ur,o(h.requests)+" 次请求 ",1)]),t("div",Rr,[t("div",Or,o(((d=h.formatted)==null?void 0:d.total)||"$0.000000"),1),v[2]||(v[2]=t("div",{class:"text-xs text-gray-600 dark:text-gray-400 md:text-sm"},"总费用",-1))])]),t("div",Er,[t("div",jr,[v[3]||(v[3]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输入 Token",-1)),t("div",Nr,o(f(h.inputTokens)),1)]),t("div",Fr,[v[4]||(v[4]=t("div",{class:"text-gray-600 dark:text-gray-400"},"输出 Token",-1)),t("div",Br,o(f(h.outputTokens)),1)]),t("div",Wr,[v[5]||(v[5]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存创建",-1)),t("div",Vr,o(f(h.cacheCreateTokens)),1)]),t("div",zr,[v[6]||(v[6]=t("div",{class:"text-gray-600 dark:text-gray-400"},"缓存读取",-1)),t("div",Jr,o(f(h.cacheReadTokens)),1)])])])}),128))])):(l(),n("div",Yr,[v[7]||(v[7]=t("i",{class:"fas fa-chart-pie mb-3 text-2xl md:text-3xl"},null,-1)),t("p",Hr," 暂无"+o(e(s)==="daily"?"今日":"本月")+"模型使用数据 ",1)]))]))}},Gr=at(Xr,[["__scopeId","data-v-b3b8dc5f"]]),Qr={key:0},Zr={class:"mb-3 text-sm text-gray-600"},tl={key:1},el={key:0,class:"mb-2 text-sm font-semibold text-gray-800 dark:text-gray-200"},sl={class:"text-green-600 dark:text-green-400"},al={class:"flex items-center justify-center py-3"},rl=["src"],ll={__name:"PurchaseDialog",props:{show:{type:Boolean,default:!1},plan:{type:Object,default:null}},emits:["close","issued"],setup(T,{emit:y}){const s=T,p=y,x=M(!1);ct(()=>s.show,O=>x.value=O,{immediate:!0}),ct(()=>x.value,O=>{O||p("close")});const f=M(),u=M({email:""}),v={email:[{validator:(O,L,j)=>{if(!L||typeof L!="string")return j(new Error("请输入邮箱"));const B=L.trim();if(B.length<5||B.length>128)return j(new Error("邮箱长度需在 5-128 之间"));if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(B))return j(new Error("请输入有效的邮箱地址"));j()},trigger:["blur","change"]}]},h=M(!1),I=M(!1),d=M(""),w=M(""),b=M(""),k=M(""),$=M(!1);let S=null;const P=M(!1),g=()=>{try{P.value=window.matchMedia("(max-width: 640px)").matches}catch{P.value=!1}};gt(()=>{g(),window.addEventListener("resize",g)}),xt(()=>{window.removeEventListener("resize",g)});async function i(){var O,L,j,B,Q;try{if(!await(((L=(O=f.value)==null?void 0:O.validate)==null?void 0:L.call(O))||Promise.resolve(!1)))return;h.value=!0;const q=await Y.request("/admin/xunhu/create",{method:"POST",body:JSON.stringify({planId:((j=s.plan)==null?void 0:j.id)||s.plan,email:u.value.email})});if(q!=null&&q.success&&((B=q.data)!=null&&B.payUrl)&&((Q=q.data)!=null&&Q.orderId)){d.value=q.data.orderId,w.value=q.data.payUrl,k.value=String(q.data.price||"").trim(),I.value=!0;try{q.data.qrUrl?b.value=q.data.qrUrl:b.value=await At(q.data.payUrl)}catch{b.value=""}W()}}finally{h.value=!1}}function W(){K(),$.value=!0;let O=0;const L=async()=>{O++;try{if(O%3===1&&d.value)try{await Y.queryXunhu({out_trade_order:d.value})}catch{}const j=await Y.getOrder(d.value),B=j==null?void 0:j.data;if(B&&B.status==="OD"&&B.apiKeyPlain){p("issued",B.apiKeyPlain),K(),G();return}}catch{}O<100?S=setTimeout(L,3e3):$.value=!1};L()}function K(){$.value=!1,S&&(clearTimeout(S),S=null)}async function R(){if(d.value)try{await Y.queryXunhu({out_trade_order:d.value})}catch{}}function G(){K(),x.value=!1}return(O,L)=>{const j=Dt,B=qt,Q=Ut,Z=_t,q=ht;return l(),ot(q,{modelValue:x.value,"onUpdate:modelValue":L[1]||(L[1]=V=>x.value=V),title:"订购套餐",width:P.value?"100%":"520px",fullscreen:P.value,"align-center":"","append-to-body":"",class:E(["purchase-dialog",{mobile:P.value}]),onClosed:L[2]||(L[2]=V=>O.$emit("close"))},{default:X(()=>{var V,et;return[I.value?(l(),n("div",tl,[L[9]||(L[9]=t("div",{class:"mb-1 text-sm text-gray-600"},"请使用微信扫描二维码完成支付",-1)),k.value?(l(),n("div",el,[L[6]||(L[6]=_(" 支付金额：",-1)),t("span",sl,"¥"+o(k.value),1)])):U("",!0),t("div",al,[b.value?(l(),n("img",{key:0,src:b.value,alt:"支付二维码",class:"qr-img"},null,8,rl)):U("",!0)]),t("div",{class:E(["dialog-actions",{mobile:P.value}])},[F(Z,{class:"action-btn",onClick:G},{default:X(()=>L[7]||(L[7]=[_("关闭",-1)])),_:1,__:[7]}),F(Z,{class:"action-btn",type:"success",loading:$.value,onClick:R},{default:X(()=>L[8]||(L[8]=[_("我已完成支付",-1)])),_:1,__:[8]},8,["loading"])],2)])):(l(),n("div",Qr,[t("div",Zr,[L[3]||(L[3]=_("您选择的套餐：",-1)),t("b",null,o(((V=T.plan)==null?void 0:V.name)||((et=T.plan)==null?void 0:et.id)),1)]),F(Q,{ref_key:"formRef",ref:f,model:u.value,rules:v,"label-width":"100px"},{default:X(()=>[F(B,{label:"联系邮箱",prop:"email",required:""},{default:X(()=>[F(j,{modelValue:u.value.email,"onUpdate:modelValue":L[0]||(L[0]=r=>u.value.email=r),placeholder:"请输入常用邮箱（用于查找与接收密钥）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),t("div",{class:E(["dialog-actions",{mobile:P.value}])},[F(Z,{class:"action-btn",onClick:G},{default:X(()=>L[4]||(L[4]=[_("取消",-1)])),_:1,__:[4]}),F(Z,{class:"action-btn",type:"primary",loading:h.value,onClick:i},{default:X(()=>L[5]||(L[5]=[_("下一步",-1)])),_:1,__:[5]},8,["loading"])],2)]))]}),_:1},8,["modelValue","width","fullscreen","class"])}}},il=at(ll,[["__scopeId","data-v-6dcb5631"]]),ol={class:"space-y-3"},nl={class:"rounded-lg border border-green-500/40 bg-green-50 p-3 dark:bg-green-900/20"},dl={class:"flex items-center gap-2"},ul={class:"flex-1 truncate rounded bg-white p-2 text-base font-mono font-semibold text-gray-800 dark:bg-gray-900 dark:text-gray-100"},cl={key:0,class:"rounded-lg border border-gray-200 bg-white p-3 dark:border-gray-700 dark:bg-gray-800"},ml={class:"whitespace-pre-wrap break-words text-sm text-gray-700 dark:text-gray-300"},fl={class:"mt-2 text-right"},gl={__name:"KeyIssuedDialog",props:{show:{type:Boolean,default:!1},apiKey:{type:String,required:!0},oemSettings:{type:Object,default:()=>({})}},emits:["close"],setup(T,{emit:y}){const s=T,p=y,x=M(!1);ct(()=>s.show,I=>x.value=I,{immediate:!0}),ct(()=>x.value,I=>{I||p("close")});const f=window.location.origin,u=H(()=>{var d;const I=((d=s.oemSettings)==null?void 0:d.copyInfoTemplate)||"";return I?I.replaceAll("{siteUrl}",f).replaceAll("{apiKey}",s.apiKey):`您可以通过访问${f}查看教程和您的api使用情况；
您的API KEY是：${s.apiKey}`});function v(I){try{navigator.clipboard.writeText(I),kt("已复制到剪贴板","success")}catch{kt("复制失败，请手动复制","error")}}function h(){x.value=!1}return(I,d)=>{const w=_t,b=ht;return l(),ot(b,{modelValue:x.value,"onUpdate:modelValue":d[2]||(d[2]=k=>x.value=k),title:"开通成功",width:"560px","append-to-body":"",onClosed:d[3]||(d[3]=k=>I.$emit("close"))},{footer:X(()=>[F(w,{type:"primary",onClick:h},{default:X(()=>d[8]||(d[8]=[_("完成",-1)])),_:1,__:[8]})]),default:X(()=>[t("div",ol,[t("div",nl,[d[5]||(d[5]=t("div",{class:"mb-1 text-sm font-semibold text-green-800 dark:text-green-200"},"您的 API Key",-1)),t("div",dl,[t("code",ul,o(T.apiKey),1),F(w,{size:"small",onClick:d[0]||(d[0]=k=>v(T.apiKey))},{default:X(()=>d[4]||(d[4]=[_("复制",-1)])),_:1,__:[4]})])]),u.value?(l(),n("div",cl,[d[7]||(d[7]=t("div",{class:"mb-1 text-sm font-medium text-gray-700 dark:text-gray-200"},"使用说明",-1)),t("pre",ml,o(u.value),1),t("div",fl,[F(w,{size:"small",onClick:d[1]||(d[1]=k=>v(u.value))},{default:X(()=>d[6]||(d[6]=[_("复制说明",-1)])),_:1,__:[6]})])])):U("",!0)])]),_:1},8,["modelValue"])}}};function xl(){const T=St(),y=dt(),s=Kt(),p=M("products"),x=H(()=>y.productPlans||[]),f=M(!1),u=M(null),v=M(!1),h=M(""),I=q=>{u.value=x.value.find(V=>V.id===q)||{id:q},f.value=!0},d=q=>{h.value=q||"",f.value=!1,v.value=!0},w=H(()=>s.isDarkMode),{apiKey:b,apiId:k,loading:$,modelStatsLoading:S,oemLoading:P,error:g,statsPeriod:i,statsData:W,oemSettings:K,multiKeyMode:R}=nt(y),{queryStats:G,switchPeriod:O,loadStatsWithApiId:L,loadOemSettings:j,loadProductSettings:B,reset:Q}=y,Z=q=>{(q.ctrlKey||q.metaKey)&&q.key==="Enter"&&(!$.value&&b.value.trim()&&G(),q.preventDefault()),q.key==="Escape"&&Q()};return gt(()=>{s.initTheme(),j(),B();const q=T.query.apiId,V=T.query.apiKey,et=T.query.order;if((q||V)&&(p.value="stats"),q&&/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i.test(q)?(k.value=q,L()):V&&V.length>10&&(b.value=V),et){p.value="products";let r=0;const a=async()=>{r++;try{const m=await Y.getOrder(et),A=m==null?void 0:m.data;if(A&&A.status==="OD"){A.apiKeyPlain&&alert(`支付成功！
您的 API Key：
${A.apiKeyPlain}`);return}}catch{}if(r<10){try{await Y.queryXunhu({out_trade_order:et})}catch{}setTimeout(a,3e3)}};a()}document.addEventListener("keydown",Z)}),xt(()=>{document.removeEventListener("keydown",Z)}),ct(b,q=>{q||y.clearData()}),{currentTab:p,plans:x,showPurchase:f,selectedPlan:u,showKeyDialog:v,issuedApiKey:h,goPurchase:I,onKeyIssued:d,isDarkMode:w,apiKey:b,apiId:k,loading:$,modelStatsLoading:S,oemLoading:P,error:g,statsPeriod:i,statsData:W,oemSettings:K,multiKeyMode:R,queryStats:G,switchPeriod:O,loadStatsWithApiId:L,loadOemSettings:j,loadProductSettings:B,reset:Q}}const yl={class:"mx-auto max-w-7xl"},pl={key:0,class:"tab-content"},vl={class:"glass-strong rounded-3xl p-4 shadow-xl md:p-6"},bl={class:"grid grid-cols-1 gap-4 md:grid-cols-2 md:gap-6 xl:grid-cols-3"},kl={class:"mb-2 flex items-center justify-between"},_l={class:"text-lg font-bold text-gray-900 dark:text-white"},hl={key:0,class:"rounded-full bg-blue-100 px-2 py-0.5 text-xs font-medium text-blue-600 dark:bg-blue-900/40 dark:text-blue-200"},wl={class:"mb-4 text-sm text-gray-600 dark:text-gray-300"},$l={class:"mb-4 flex items-end gap-2"},Sl={class:"text-2xl font-extrabold text-gray-900 dark:text-white"},Cl={class:"text-xs text-gray-500 dark:text-gray-400"},Tl={class:"mb-5 space-y-2 text-sm text-gray-700 dark:text-gray-300"},Pl={class:"flex items-center gap-2"},Kl={class:"flex items-center gap-2"},Ll=["onClick"],Al={key:1,class:"tab-content"},Il={key:0,class:"mb-6 md:mb-8"},Ml={class:"rounded-xl border border-red-500/30 bg-red-500/20 p-3 text-sm text-red-800 backdrop-blur-sm dark:border-red-500/20 dark:bg-red-500/10 dark:text-red-200 md:p-4 md:text-base"},ql={key:1,class:"fade-in"},Dl={class:"glass-strong rounded-3xl p-4 shadow-xl md:p-6"},Ul={class:"mb-4 border-b border-gray-200 pb-4 dark:border-gray-700 md:mb-6 md:pb-6"},Rl={class:"flex flex-col items-start justify-between gap-3 md:flex-row md:items-center md:gap-4"},Ol={class:"flex w-full gap-2 md:w-auto"},El=["disabled"],jl=["disabled"],Nl={class:"mb-6 mt-6 grid grid-cols-1 gap-4 md:mb-8 md:mt-8 md:gap-6 xl:grid-cols-2 xl:items-stretch"},Fl={key:2,class:"tab-content"},Bl={class:"glass-strong rounded-3xl shadow-xl"},Wl={__name:"index",setup(T){const{currentTab:y,plans:s,showPurchase:p,selectedPlan:x,showKeyDialog:f,issuedApiKey:u,goPurchase:v,onKeyIssued:h,isDarkMode:I,loading:d,modelStatsLoading:w,oemLoading:b,error:k,statsPeriod:$,statsData:S,oemSettings:P,multiKeyMode:g,switchPeriod:i}=xl();return(W,K)=>(l(),n("div",{class:E(["min-h-screen px-4 pb-6 pt-24 md:px-6 md:pt-28",e(I)?"gradient-bg-dark":"gradient-bg"])},[F(Vt,{"current-tab":e(y),"onUpdate:currentTab":K[0]||(K[0]=R=>ft(y)?y.value=R:null),"oem-loading":e(b),"oem-settings":e(P)},null,8,["current-tab","oem-loading","oem-settings"]),t("div",yl,[t("div",null,[e(y)==="products"?(l(),n("div",pl,[t("div",vl,[K[7]||(K[7]=Ct('<div class="mb-6 flex items-center justify-between md:mb-8" data-v-9956da7b><div class="flex items-center gap-2 md:gap-3" data-v-9956da7b><i class="fas fa-store text-base text-blue-500 md:text-lg" data-v-9956da7b></i><span class="text-base font-semibold text-gray-800 dark:text-gray-100 md:text-lg" data-v-9956da7b>套餐选择</span></div></div><div class="mb-5 rounded-xl border border-gray-200/70 bg-white/70 p-4 text-sm text-gray-700 backdrop-blur-sm dark:border-gray-700/60 dark:bg-gray-800/50 dark:text-gray-200" data-v-9956da7b><p class="m-0" data-v-9956da7b><i class="fas fa-rocket mr-2 text-blue-500" data-v-9956da7b></i><span data-v-9956da7b>我们是 Codex 的官方中转，采用最优网络线路极速直连，包月无忧，官方授权，</span><span data-v-9956da7b>远超 OpenAI 官方 Plus 会员体验。</span></p></div>',2)),t("div",bl,[(l(!0),n(tt,null,lt(e(s),R=>(l(),n("div",{key:R.id,class:"relative flex flex-col justify-between rounded-2xl border p-5 shadow-sm transition-all duration-200 hover:shadow-md dark:border-gray-700/60 dark:bg-gray-800/60"},[t("div",null,[t("div",kl,[t("h3",_l,o(R.name),1),R.tag?(l(),n("span",hl,o(R.tag),1)):U("",!0)]),t("p",wl,o(R.description),1),t("div",$l,[t("span",Sl,"¥"+o(R.price),1),t("span",Cl,o(R.priceNote),1)]),t("ul",Tl,[t("li",Pl,[K[5]||(K[5]=t("i",{class:"fas fa-clock w-4 text-blue-500"},null,-1)),_(" "+o(R.durationDesc),1)]),t("li",Kl,[K[6]||(K[6]=t("i",{class:"fas fa-bolt w-4 text-yellow-500"},null,-1)),_(" 每天 "+o(R.dailyLimit)+" 次请求 ",1)])])]),t("button",{class:"mt-2 w-full rounded-xl bg-gradient-to-r from-blue-500 to-blue-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:from-blue-600 hover:to-blue-700 disabled:cursor-not-allowed disabled:opacity-60",onClick:G=>e(v)(R.id)}," 订购 ",8,Ll)]))),128))]),K[8]||(K[8]=t("p",{class:"mt-4 text-center text-xs text-gray-500 dark:text-gray-400"}," 点击订购后填写邮箱并扫码支付，成功后自动发放 API Key。 ",-1))])])):U("",!0),e(y)==="stats"?(l(),n("div",Al,[F(me),e(k)?(l(),n("div",Il,[t("div",Ml,[K[9]||(K[9]=t("i",{class:"fas fa-exclamation-triangle mr-2"},null,-1)),_(" "+o(e(k)),1)])])):U("",!0),e(S)?(l(),n("div",ql,[t("div",Dl,[t("div",Ul,[t("div",Rl,[K[12]||(K[12]=t("div",{class:"flex items-center gap-2 md:gap-3"},[t("i",{class:"fas fa-clock text-base text-blue-500 md:text-lg"}),t("span",{class:"text-base font-medium text-gray-700 dark:text-gray-200 md:text-lg"},"统计时间范围")],-1)),t("div",Ol,[t("button",{class:E(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e($)==="daily"}]]),disabled:e(d)||e(w),onClick:K[1]||(K[1]=R=>e(i)("daily"))},K[10]||(K[10]=[t("i",{class:"fas fa-calendar-day text-xs md:text-sm"},null,-1),_(" 今日 ",-1)]),10,El),t("button",{class:E(["flex flex-1 items-center justify-center gap-1 px-4 py-2 text-xs font-medium md:flex-none md:gap-2 md:px-6 md:text-sm",["period-btn",{active:e($)==="monthly"}]]),disabled:e(d)||e(w),onClick:K[2]||(K[2]=R=>e(i)("monthly"))},K[11]||(K[11]=[t("i",{class:"fas fa-calendar-alt text-xs md:text-sm"},null,-1),_(" 本月 ",-1)]),10,jl)])])]),F(As),t("div",Nl,[F(Hs,{class:"h-full"}),e(g)?(l(),ot(Cr,{key:0,class:"h-full"})):(l(),ot(cr,{key:1,class:"h-full"}))]),F(Gr)])])):U("",!0)])):e(y)==="tutorial"?(l(),n("div",Fl,[t("div",Bl,[F(Mt)])])):U("",!0)])]),F(il,{show:e(p),plan:e(x),onClose:K[3]||(K[3]=R=>p.value=!1),onIssued:e(h)},null,8,["show","plan","onIssued"]),F(gl,{show:e(f),"api-key":e(u),"oem-settings":e(P),onClose:K[4]||(K[4]=R=>f.value=!1)},null,8,["show","api-key","oem-settings"])],2))}},Zl=at(Wl,[["__scopeId","data-v-9956da7b"]]);export{Zl as default};
