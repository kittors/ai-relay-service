import{c as y,r as P,_ as K,q as D,V as I,x as d,y as u,z as e,L as U,R as v,P as w,C as T,Y as A,K as k,aq as _,O as q,Q as C,aU as L,ac as S,o as z,av as B,aW as E,D as O}from"./vue-vendor-R8HMg95E.js";import{_ as M,u as $,s as x,c as R}from"./index-CYC8e9-T.js";import{L as F}from"./LogoTitle-CX_-AgWK.js";import{T as H}from"./ThemeToggle-CIl26c0h.js";import"./element-plus-T7eq0npu.js";import"./vendor-DTV-MYIR.js";const Q={class:"glass-strong mb-4 rounded-xl p-3 shadow-xl sm:mb-6 sm:rounded-2xl sm:p-4 md:mb-8 md:rounded-3xl md:p-6",style:{"z-index":"10",position:"relative"}},W={class:"flex flex-col items-center justify-between gap-3 sm:flex-row sm:gap-4"},Y={class:"flex w-full items-center justify-center gap-2 sm:w-auto sm:justify-start sm:gap-3 md:gap-4"},G={class:"flex items-center gap-2 sm:gap-4"},J={class:"flex items-center"},X={class:"user-menu-container relative"},Z={class:"hidden sm:inline"},ee={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},te={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-md flex-col p-4 sm:p-6 md:p-8"},se=["value"],ae={class:"flex gap-3 pt-4"},oe=["disabled"],re={key:0,class:"loading-spinner mr-2"},ne={key:1,class:"fas fa-save mr-2"},le={__name:"AppHeader",setup(h){const c=L(),m=$(),i=y(()=>m.user||{username:"Admin"}),o=y(()=>m.oemSettings||{}),a=y(()=>m.oemLoading),l=P(!1),b=P(!1),r=P(!1),s=K({currentPassword:"",newPassword:"",confirmPassword:"",newUsername:""}),n=()=>{s.currentPassword="",s.newPassword="",s.confirmPassword="",s.newUsername="",b.value=!0,l.value=!1},g=()=>{b.value=!1},V=async()=>{if(s.newPassword!==s.confirmPassword){x("两次输入的密码不一致","error");return}if(s.newPassword.length<8){x("新密码长度至少8位","error");return}r.value=!0;try{const f=await R.post("/web/auth/change-password",{currentPassword:s.currentPassword,newPassword:s.newPassword,newUsername:s.newUsername||void 0});if(f.success){const t=s.newUsername?"账户信息修改成功，请重新登录":"密码修改成功，请重新登录";x(t,"success"),g(),setTimeout(()=>{m.logout(),c.push("/login")},1500)}else x(f.message||"修改失败","error")}catch{x("修改密码失败","error")}finally{r.value=!1}},j=()=>{confirm("确定要退出登录吗？")&&(m.logout(),c.push("/login"),x("已安全退出","success")),l.value=!1},N=f=>{!f.target.closest(".user-menu-container")&&l.value&&(l.value=!1)};return D(()=>{document.addEventListener("click",N)}),I(()=>{document.removeEventListener("click",N)}),(f,t)=>(u(),d(C,null,[e("div",Q,[e("div",W,[e("div",Y,[v(F,{loading:a.value,"logo-src":o.value.siteIconData||o.value.siteIcon,subtitle:"管理后台",title:o.value.siteName,"title-class":"text-white dark:text-gray-100"},null,8,["loading","logo-src","title"])]),e("div",G,[e("div",J,[v(H,{mode:"dropdown"})]),t[10]||(t[10]=e("div",{class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},null,-1)),e("div",X,[e("button",{class:"user-menu-button flex items-center gap-2 rounded-2xl bg-gradient-to-r from-blue-500 to-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-lg transition-all duration-200 hover:scale-105 hover:shadow-xl active:scale-95 sm:px-4 sm:py-2.5",onClick:t[0]||(t[0]=p=>l.value=!l.value)},[t[6]||(t[6]=e("i",{class:"fas fa-user-circle text-sm sm:text-base"},null,-1)),e("span",Z,w(i.value.username||"Admin"),1),e("i",{class:T(["fas fa-chevron-down ml-1 text-xs transition-transform duration-200",{"rotate-180":l.value}])},null,2)]),l.value?(u(),d("div",{key:0,class:"user-menu-dropdown absolute right-0 top-full mt-2 w-48 rounded-xl border border-gray-200 bg-white py-2 shadow-xl dark:border-gray-700 dark:bg-gray-800 sm:w-56",style:{"z-index":"999999"},onClick:t[1]||(t[1]=A(()=>{},["stop"]))},[e("button",{class:"flex w-full items-center gap-3 px-4 py-3 text-left text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:n},t[7]||(t[7]=[e("i",{class:"fas fa-key text-blue-500"},null,-1),e("span",null,"修改账户信息",-1)])),t[9]||(t[9]=e("hr",{class:"my-2 border-gray-200 dark:border-gray-700"},null,-1)),e("button",{class:"flex w-full items-center gap-3 px-4 py-3 text-left text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:j},t[8]||(t[8]=[e("i",{class:"fas fa-sign-out-alt text-red-500"},null,-1),e("span",null,"退出登录",-1)]))])):U("",!0)])])])]),b.value?(u(),d("div",ee,[e("div",te,[e("div",{class:"mb-6 flex items-center justify-between"},[t[12]||(t[12]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-key text-white"})]),e("h3",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"修改账户信息")],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600 dark:hover:text-gray-300",onClick:g},t[11]||(t[11]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-6",onSubmit:A(V,["prevent"])},[e("div",null,[t[13]||(t[13]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"当前用户名",-1)),e("input",{class:"form-input w-full cursor-not-allowed bg-gray-100 dark:bg-gray-700 dark:text-gray-300",disabled:"",type:"text",value:i.value.username||"Admin"},null,8,se),t[14]||(t[14]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 当前用户名，输入新用户名以修改 ",-1))]),e("div",null,[t[15]||(t[15]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"新用户名",-1)),k(e("input",{"onUpdate:modelValue":t[2]||(t[2]=p=>s.newUsername=p),class:"form-input w-full",placeholder:"输入新用户名（留空保持不变）",type:"text"},null,512),[[_,s.newUsername]]),t[16]||(t[16]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},"留空表示不修改用户名",-1))]),e("div",null,[t[17]||(t[17]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"当前密码",-1)),k(e("input",{"onUpdate:modelValue":t[3]||(t[3]=p=>s.currentPassword=p),class:"form-input w-full",placeholder:"请输入当前密码",required:"",type:"password"},null,512),[[_,s.currentPassword]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"新密码",-1)),k(e("input",{"onUpdate:modelValue":t[4]||(t[4]=p=>s.newPassword=p),class:"form-input w-full",placeholder:"请输入新密码",required:"",type:"password"},null,512),[[_,s.newPassword]]),t[19]||(t[19]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},"密码长度至少8位",-1))]),e("div",null,[t[20]||(t[20]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"确认新密码",-1)),k(e("input",{"onUpdate:modelValue":t[5]||(t[5]=p=>s.confirmPassword=p),class:"form-input w-full",placeholder:"请再次输入新密码",required:"",type:"password"},null,512),[[_,s.confirmPassword]])]),e("div",ae,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:g}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:r.value,type:"submit"},[r.value?(u(),d("div",re)):(u(),d("i",ne)),q(" "+w(r.value?"保存中...":"保存修改"),1)],8,oe)])],32)])])):U("",!0)],64))}},ie=M(le,[["__scopeId","data-v-b74d9e93"]]),de={class:"mb-4 sm:mb-6"},ue={class:"block rounded-xl bg-white/10 p-2 backdrop-blur-sm dark:bg-gray-800/20 sm:hidden"},ce=["value"],me=["value"],ge={class:"hidden flex-wrap gap-2 rounded-2xl bg-white/10 p-2 backdrop-blur-sm dark:bg-gray-800/20 sm:flex"},pe=["onClick"],fe={class:"hidden md:inline"},xe={class:"md:hidden"},be={__name:"TabBar",props:{activeTab:{type:String,required:!0}},emits:["tab-change"],setup(h){const c=$(),m=y(()=>{var o;const i=[{key:"dashboard",name:"仪表板",shortName:"仪表板",icon:"fas fa-tachometer-alt"},{key:"apiKeys",name:"API Keys",shortName:"API",icon:"fas fa-key"},{key:"accounts",name:"账户管理",shortName:"账户",icon:"fas fa-user-circle"}];return(o=c.oemSettings)!=null&&o.ldapEnabled&&i.push({key:"userManagement",name:"用户管理",shortName:"用户",icon:"fas fa-users"}),i.push({key:"tutorial",name:"使用教程",shortName:"教程",icon:"fas fa-graduation-cap"},{key:"settings",name:"系统设置",shortName:"设置",icon:"fas fa-cogs"}),i});return(i,o)=>(u(),d("div",de,[e("div",ue,[e("select",{class:"focus:ring-primary-color w-full rounded-lg bg-white/90 px-4 py-3 font-semibold text-gray-700 focus:outline-none focus:ring-2 dark:bg-gray-800/90 dark:text-gray-200 dark:focus:ring-indigo-400",value:h.activeTab,onChange:o[0]||(o[0]=a=>i.$emit("tab-change",a.target.value))},[(u(!0),d(C,null,S(m.value,a=>(u(),d("option",{key:a.key,value:a.key},w(a.name),9,me))),128))],40,ce)]),e("div",ge,[(u(!0),d(C,null,S(m.value,a=>(u(),d("button",{key:a.key,class:T(["tab-btn flex-1 px-3 py-2 text-xs font-semibold transition-all duration-300 sm:px-4 sm:py-3 sm:text-sm md:px-6",h.activeTab===a.key?"active":"text-gray-700 hover:bg-white/10 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-gray-700/30 dark:hover:text-gray-100"]),onClick:l=>i.$emit("tab-change",a.key)},[e("i",{class:T(a.icon+" mr-1 sm:mr-2")},null,2),e("span",fe,w(a.name),1),e("span",xe,w(a.shortName||a.name),1)],10,pe))),128))])]))}},ye=M(be,[["__scopeId","data-v-bc8f3d44"]]),ve={class:"min-h-screen p-3 sm:p-4 md:p-6"},we={class:"glass-strong rounded-xl p-3 shadow-xl sm:rounded-2xl sm:p-4 md:rounded-3xl md:p-6",style:{"z-index":"1","min-height":"calc(100vh - 120px)"}},he={class:"tab-content"},ke={__name:"MainLayout",setup(h){const c=E(),m=L(),i=$(),o=P("dashboard"),a=y(()=>{var s;const r={dashboard:"/dashboard",apiKeys:"/api-keys",accounts:"/accounts",tutorial:"/tutorial",settings:"/settings"};return(s=i.oemSettings)!=null&&s.ldapEnabled&&(r.userManagement="/user-management"),r}),l=()=>{const r=c.path,s=Object.keys(a.value).find(n=>a.value[n]===r);if(s)o.value=s;else{const n=c.name,g={Dashboard:"dashboard",ApiKeys:"apiKeys",Accounts:"accounts",Tutorial:"tutorial",Settings:"settings"};n&&g[n]?o.value=g[n]:o.value="dashboard"}};l(),z(()=>c.path,r=>{const s=Object.keys(a.value).find(n=>a.value[n]===r);if(s)o.value=s;else{const n=c.name,g={Dashboard:"dashboard",ApiKeys:"apiKeys",Accounts:"accounts",Tutorial:"tutorial",Settings:"settings"};n&&g[n]&&(o.value=g[n])}});const b=async r=>{if(a.value[r]!==c.path){o.value=r;try{await m.push(a.value[r]),await O()}catch(s){s.name!=="NavigationDuplicated"&&(console.error("路由切换失败:",s),l())}}};return(r,s)=>{const n=B("router-view");return u(),d("div",ve,[v(ie),e("div",we,[v(ye,{"active-tab":o.value,onTabChange:b},null,8,["active-tab"]),e("div",he,[v(n)])])])}}},Ne=M(ke,[["__scopeId","data-v-4d6bba6e"]]);export{Ne as default};
